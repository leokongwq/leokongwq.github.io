<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æˆ’ä¿®-æ²‰è¿·æŠ€æœ¯çš„å°æ²™å¼¥</title>
  <subtitle>æˆ‘å–œæ¬¢GO</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://leokongwq.github.io/"/>
  <updated>2018-11-21T15:48:09.849Z</updated>
  <id>https://leokongwq.github.io/</id>
  
  <author>
    <name>kongwenqiang</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>RestTemplateè¶…æ—¶å¼•å‘çš„è¡€æ¡ˆ</title>
    <link href="https://leokongwq.github.io/2018/11/21/springboot-resttempate-timout.html"/>
    <id>https://leokongwq.github.io/2018/11/21/springboot-resttempate-timout.html</id>
    <published>2018-11-21T15:01:05.000Z</published>
    <updated>2018-11-21T15:48:09.849Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æœ€è¿‘çº¿ä¸Šå‡ºäº†ä¸€æ¬¡æ•…éšœï¼Œæ”¶é“¶å°ç³»ç»Ÿæ‰€æœ‰æœåŠ¡å…¨éƒ¨å‡æ­»ã€‚è®¢å•é‡ç¬æ—¶ä¸‹é™ï¼Œé€ æˆå¾ˆå¤§æŸå¤±ã€‚</p>
<p>æ•…éšœæ€»ç»“ï¼Œå¯¼è‡´é—®é¢˜çš„åŸå› æœ‰ä¸¤æ–¹é¢ï¼š</p>
<ol>
<li>æ•°æ®åº“æ…¢æŸ¥è¯¢</li>
<li>RestTemplateè¶…æ—¶æ—¶é—´è®¾ç½®ä¸ç”Ÿæ•ˆã€‚</li>
<li>spring-webä¸åŒç‰ˆæœ¬è®¾ç½®RestTemplateæ–¹å¼ä¸å®Œå…¨ä¸€æ ·ã€‚</li>
</ol>
<a id="more"></a>
<h3 id="é»˜è®¤è¶…æ—¶è®¾ç½®"><a href="#é»˜è®¤è¶…æ—¶è®¾ç½®" class="headerlink" title="é»˜è®¤è¶…æ—¶è®¾ç½®"></a>é»˜è®¤è¶…æ—¶è®¾ç½®</h3><p>é»˜è®¤æƒ…å†µä¸‹æ˜¯æ²¡æœ‰è¶…æ—¶è®¾ç½®çš„ï¼Œæ­¤æ—¶è¶…æ—¶ä¾èµ–ä¸¤æ–¹é¢ï¼š</p>
<ol>
<li>ä¾èµ–TCPè¿æ¥æœ¬èº«çš„è¶…æ—¶æ—¶é—´ï¼ˆtcpç©ºé—²è¿æ¥ï¼Œè¶…è¿‡ä¸€å®šæ—¶é—´ï¼Œè¿æ¥ä¼šè¢«å…³é—­ï¼‰ã€‚</li>
<li>è¯·æ±‚æ‰€ç»è¿‡çš„ç½‘ç»œèŠ‚ç‚¹çš„è¶…æ—¶æ—¶é—´ã€‚e.g. ä¸­é—´ç»è¿‡nginx, nginxé»˜è®¤è¯»å–åç«¯æœåŠ¡çš„è¶…æ—¶æ—¶é—´æ˜¯60sï¼Œæ‰€ä»¥è¶…æ—¶æ—¶é—´åœ¨60så·¦å³ï¼ˆæ—¥å¿—æ˜¾ç¤ºç¨å¾®å¤§ä¸€ç‚¹ï¼Œä¸ä¼šå¤§å¾ˆå¤šï¼‰ã€‚</li>
</ol>
<h4 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><figure class="highlight java"><figcaption><span>ä¾‹å­</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> start = System.currentTimeMillis();</span>
<span class="line"><span class="keyword">try</span> &#123;</span>
<span class="line">    RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate();</span>
<span class="line">    Map responseObject = restTemplate.getForObject(url, Map.class);</span>
<span class="line">    System.out.println(responseObject);</span>
<span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span>
<span class="line">    Assert.assertNotNull(e);</span>
<span class="line">    System.out.println(<span class="string">"timeout = "</span> + (System.currentTimeMillis() - start));</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>åŸå› ï¼š</p>
<p><code>RestTemplate</code> ç»§æ‰¿è‡ª <code>HttpAccessor</code>, é»˜è®¤ä½¿ç”¨çš„<code>ClientHttpRequestFactory</code>æ˜¯<code>SimpleClientHttpRequestFactory</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpAccessor</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">	<span class="comment">/**</span>
<span class="line">	 * Logger available to subclasses.</span>
<span class="line">	 */</span></span>
<span class="line">	<span class="keyword">protected</span> <span class="keyword">final</span> Log logger = LogFactory.getLog(getClass());</span>
<span class="line"></span>
<span class="line">	<span class="keyword">private</span> ClientHttpRequestFactory requestFactory = <span class="keyword">new</span> SimpleClientHttpRequestFactory();</span>
<span class="line">&#125;</span>
<span class="line"></span>
<span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleClientHttpRequestFactory</span> <span class="keyword">implements</span> <span class="title">ClientHttpRequestFactory</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CHUNK_SIZE = <span class="number">4096</span>;</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">	<span class="keyword">private</span> Proxy proxy;</span>
<span class="line"></span>
<span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> bufferRequestBody = <span class="keyword">true</span>;</span>
<span class="line"></span>
<span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> chunkSize = DEFAULT_CHUNK_SIZE;</span>
<span class="line"></span>
<span class="line">  <span class="comment">// è¿æ¥å’Œè¯»å–è¶…æ—¶éƒ½æ˜¯ -1, ä¹Ÿå°±æ˜¯æ²¡æœ‰è¶…æ—¶è®¾ç½®ã€‚</span></span>
<span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> connectTimeout = -<span class="number">1</span>;</span>
<span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> readTimeout = -<span class="number">1</span>;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>é‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨<code>RestTemplate</code>è¯¥å¦‚ä½•è®¾ç½®è¶…æ—¶æ—¶é—´å‘¢ï¼Ÿ </p>
<h3 id="RestTemplateè¶…æ—¶è®¾ç½®"><a href="#RestTemplateè¶…æ—¶è®¾ç½®" class="headerlink" title="RestTemplateè¶…æ—¶è®¾ç½®"></a>RestTemplateè¶…æ—¶è®¾ç½®</h3><p>ç”±ä¸Šé¢çš„ä»£ç æˆ‘ä»¬äº†è§£åˆ°ï¼Œè¶…æ—¶è®¾ç½®å…¶å®åº”è¯¥é€šè¿‡å†…éƒ¨çš„<code>ClientHttpRequestFactory</code>æ¥è®¾ç½®çš„ã€‚</p>
<p>æ‰€ä»¥å°±å¯ä»¥é€šè¿‡ç»™<code>RestTemplate</code>è®¾ç½®ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„ï¼Œè®¾ç½®äº†è¶…æ—¶æ—¶é—´çš„<code>ClientHttpRequestFactory</code>æ¥å®ç°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line">SimpleClientHttpRequestFactory clientHttpRequestFactory = <span class="keyword">new</span> SimpleClientHttpRequestFactory();</span>
<span class="line">clientHttpRequestFactory.setConnectTimeout(<span class="number">1000</span>);</span>
<span class="line">clientHttpRequestFactory.setReadTimeout(<span class="number">50</span>);</span>
<span class="line">RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate();</span>
<span class="line">restTemplate.setRequestFactory(clientHttpRequestFactory);</span>
</pre></td></tr></table></figure>
<p>æˆ–è€…</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line">HttpComponentsClientHttpRequestFactory clientHttpRequestFactory = <span class="keyword">new</span> HttpComponentsClientHttpRequestFactory();</span>
<span class="line">clientHttpRequestFactory.setConnectTimeout(<span class="number">1000</span>);</span>
<span class="line">clientHttpRequestFactory.setReadTimeout(<span class="number">50</span>);</span>
<span class="line">RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate();</span>
<span class="line">restTemplate.setRequestFactory(clientHttpRequestFactory);</span>
</pre></td></tr></table></figure>
<p>ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯: <code>HttpComponentsClientHttpRequestFactory</code> åº•å±‚ä½¿ç”¨äº†apacheçš„<code>HttpClient</code>ï¼Œè¶…æ—¶æ—¶é—´çš„è®¾ç½®å…¶å®æ˜¯é’ˆå¯¹å®ƒè¿›è¡Œè®¾ç½®çš„ã€‚</p>
<figure class="highlight java"><figcaption><span>HttpComponentsClientHttpRequestFactory</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
</pre></td><td class="code"><pre><span class="line"></span>
<span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_MAX_TOTAL_CONNECTIONS = <span class="number">100</span>;</span>
<span class="line"></span>
<span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_MAX_CONNECTIONS_PER_ROUTE = <span class="number">5</span>;</span>
<span class="line"><span class="comment">//é»˜è®¤è¯»å–è¶…æ—¶ 60s</span></span>
<span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_READ_TIMEOUT_MILLISECONDS = (<span class="number">60</span> * <span class="number">1000</span>);</span>
<span class="line"></span>
<span class="line"><span class="keyword">private</span> HttpClient httpClient;</span>
<span class="line"></span>
<span class="line"><span class="comment">/**</span>
<span class="line"> * Set the connection timeout for the underlying HttpClient.</span>
<span class="line"> * A timeout value of 0 specifies an infinite timeout.</span>
<span class="line"> * <span class="doctag">@param</span> timeout the timeout value in milliseconds</span>
<span class="line"> */</span></span>
<span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConnectTimeout</span><span class="params">(<span class="keyword">int</span> timeout)</span> </span>&#123;</span>
<span class="line">	Assert.isTrue(timeout &gt;= <span class="number">0</span>, <span class="string">"Timeout must be a non-negative value"</span>);</span>
<span class="line">	getHttpClient().getParams().setIntParameter(CoreConnectionPNames.CONNECTION_TIMEOUT, timeout);</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>åˆ°æ­¤ï¼Œå¦‚æœå°±é€šè¿‡ä¸Šé¢æåˆ°çš„æ–¹å¼è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„åº”ç”¨å°±ä¸ç”¨æœ‰è¶…æ—¶é—®é¢˜ï¼Œä¹Ÿä¸ä¼šå‘ç”Ÿæ•…éšœäº†ã€‚</p>
<p>ä½†é—®é¢˜å°±å‘ç”Ÿåœ¨ï¼Œå…¬å¸å†…éƒ¨ä½¿ç”¨çš„ç»„ä»¶ï¼Œä¸æ˜¯é€šè¿‡<code>HttpComponentsClientHttpRequestFactory</code>è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè€Œæ˜¯é€šè¿‡è®¾ç½®<code>HttpComponentsClientHttpRequestFactory</code>å†…éƒ¨çš„<code>HttpClient</code>è®¾ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œå¹¶ä¸”è®¾ç½®äº†<code>HttpClient</code> ä½¿ç”¨çš„ <code>HttpClientConnectionManager</code>ï¼Œä»è€Œå¯¼è‡´äº†é—®é¢˜çš„å‘ç”Ÿã€‚</p>
<h3 id="é—®é¢˜ä»£ç -amp-æµ‹è¯•"><a href="#é—®é¢˜ä»£ç -amp-æµ‹è¯•" class="headerlink" title="é—®é¢˜ä»£ç &amp;æµ‹è¯•"></a>é—®é¢˜ä»£ç &amp;æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
</pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span>
<span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRestTemplateWithRequestFactoryWithoutTimeOut</span><span class="params">()</span> </span>&#123;</span>
<span class="line">    <span class="keyword">long</span> start = System.currentTimeMillis();</span>
<span class="line">    <span class="keyword">try</span> &#123;</span>
<span class="line">        HttpComponentsClientHttpRequestFactory requestFactory = <span class="keyword">new</span> HttpComponentsClientHttpRequestFactory();</span>
<span class="line"></span>
<span class="line">        <span class="comment">//2.è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œ è®¾ç½®/ä¸è®¾ç½®ConnectionManager</span></span>
<span class="line">        HttpClient httpClient = HttpClientBuilder.create()</span>
<span class="line">                .setDefaultRequestConfig(getRequestConfig())</span>
<span class="line">                .setDefaultSocketConfig(getSocketConfig())</span>
<span class="line">                .setConnectionManager(<span class="keyword">new</span> PoolingHttpClientConnectionManager(<span class="number">3</span>, TimeUnit.MINUTES))</span>
<span class="line">                .build();</span>
<span class="line"></span>
<span class="line">        requestFactory.setHttpClient(httpClient);</span>
<span class="line">        RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate();</span>
<span class="line">        restTemplate.setRequestFactory(requestFactory);</span>
<span class="line"></span>
<span class="line">        Map responseObject = restTemplate.getForObject(QUERY_USER_RENEW_URL, Map.class);</span>
<span class="line">        System.out.println(responseObject);</span>
<span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span>
<span class="line">        Assert.assertNotNull(e);</span>
<span class="line">        System.out.println(<span class="string">"timeout = "</span> + (System.currentTimeMillis() - start));</span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><h4 id="spring-web-ç‰ˆæœ¬-3-2-0"><a href="#spring-web-ç‰ˆæœ¬-3-2-0" class="headerlink" title="spring-web ç‰ˆæœ¬ 3.2.0"></a>spring-web ç‰ˆæœ¬ 3.2.0</h4><ol>
<li>é»˜è®¤è¶…æ—¶ 60s, å› ä¸ºnginxé»˜è®¤çš„proxy_read_timeout æ˜¯60s</li>
<li>è®¾ç½®äº† HttpClientçš„è¶…æ—¶æ—¶é—´ï¼Œ ä¸è®¾ç½® ConnectionManager è¶…æ—¶ç”Ÿæ•ˆ</li>
<li>è®¾ç½®äº† HttpClientçš„è¶…æ—¶æ—¶é—´ï¼Œ è®¾ç½® ConnectionManager è¶…æ—¶ç”Ÿæ•ˆ</li>
</ol>
<h4 id="spring-web-ç‰ˆæœ¬-4-0-9-RELEASE"><a href="#spring-web-ç‰ˆæœ¬-4-0-9-RELEASE" class="headerlink" title="spring-web ç‰ˆæœ¬ 4.0.9.RELEASE"></a>spring-web ç‰ˆæœ¬ 4.0.9.RELEASE</h4><ol>
<li>é»˜è®¤è¶…æ—¶ 60s, å› ä¸ºnginxé»˜è®¤çš„proxy_read_timeout æ˜¯60s</li>
<li>è®¾ç½®äº† HttpClientçš„è¶…æ—¶æ—¶é—´ï¼Œ ä¸è®¾ç½® ConnectionManager è¶…æ—¶ç”Ÿæ•ˆ</li>
<li>è®¾ç½®äº† HttpClientçš„è¶…æ—¶æ—¶é—´ï¼Œ è®¾ç½® ConnectionManager è¶…æ—¶ä¸ç”Ÿæ•ˆ ï¼ˆqiyue-store å°±æ˜¯è¿™æ ·é—®é¢˜ï¼‰</li>
</ol>
<h4 id="spring-web-ç‰ˆæœ¬-4-3-0-RELEASE"><a href="#spring-web-ç‰ˆæœ¬-4-3-0-RELEASE" class="headerlink" title="spring-web ç‰ˆæœ¬ 4.3.0.RELEASE"></a>spring-web ç‰ˆæœ¬ 4.3.0.RELEASE</h4><ol>
<li>é»˜è®¤è¶…æ—¶ 60s, å› ä¸ºnginxé»˜è®¤çš„proxy_read_timeout æ˜¯60s</li>
<li>è®¾ç½®äº† HttpClientçš„è¶…æ—¶æ—¶é—´ï¼Œ ä¸è®¾ç½® ConnectionManager è¶…æ—¶ç”Ÿæ•ˆ</li>
<li>è®¾ç½®äº† HttpClientçš„è¶…æ—¶æ—¶é—´ï¼Œ è®¾ç½® ConnectionManager è¶…æ—¶ç”Ÿæ•ˆ</li>
</ol>
<h4 id="spring-web-ç‰ˆæœ¬-4-3-11-RELEASE"><a href="#spring-web-ç‰ˆæœ¬-4-3-11-RELEASE" class="headerlink" title="spring-web ç‰ˆæœ¬ 4.3.11.RELEASE"></a>spring-web ç‰ˆæœ¬ 4.3.11.RELEASE</h4><ol>
<li>é»˜è®¤è¶…æ—¶ 60s, å› ä¸ºnginxé»˜è®¤çš„ proxy_read_timeout æ˜¯60s</li>
<li>è®¾ç½®äº† HttpClientçš„è¶…æ—¶æ—¶é—´ï¼Œ ä¸è®¾ç½® ConnectionManager è¶…æ—¶ç”Ÿæ•ˆ</li>
<li>è®¾ç½®äº† HttpClientçš„è¶…æ—¶æ—¶é—´ï¼Œ è®¾ç½® ConnectionManager è¶…æ—¶ç”Ÿæ•ˆ</li>
</ol>
<p>å…¶å®é—®é¢˜å°±åœ¨ä¸ä¸åŒçš„ç‰ˆæœ¬ä¸­<code>HttpComponentsClientHttpRequestFactory.createRequest</code>æ–¹æ³•çš„å®ç°é€»è¾‘ä¸åŒã€‚å¦‚ä½•ä¸åŒï¼Œè‡ªå·±æŸ¥çœ‹ã€‚ğŸ˜</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol>
<li>è¶…æ—¶è®¾ç½®è‡³å…³é‡è¦ã€‚å¤–éƒ¨ä¾èµ–æ¥å£è°ƒç”¨å¯ä»¥é€šè¿‡Hystrixè¿›è¡ŒåŒ…è£…ã€‚</li>
<li>ä»»ä½•å‚æ•°çš„è®¾ç½®éƒ½éœ€è¦éªŒè¯æ˜¯å¦å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œå¯ä»¥åŠ å…¥åˆ°æµ‹è¯•ç¯èŠ‚ä¸­ï¼Œæ–¹ä¾¿åœ¨ä¸åŒçš„ä¾èµ–ç‰ˆæœ¬ä¸­è¿›è¡ŒéªŒè¯ã€‚</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;æœ€è¿‘çº¿ä¸Šå‡ºäº†ä¸€æ¬¡æ•…éšœï¼Œæ”¶é“¶å°ç³»ç»Ÿæ‰€æœ‰æœåŠ¡å…¨éƒ¨å‡æ­»ã€‚è®¢å•é‡ç¬æ—¶ä¸‹é™ï¼Œé€ æˆå¾ˆå¤§æŸå¤±ã€‚&lt;/p&gt;
&lt;p&gt;æ•…éšœæ€»ç»“ï¼Œå¯¼è‡´é—®é¢˜çš„åŸå› æœ‰ä¸¤æ–¹é¢ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ•°æ®åº“æ…¢æŸ¥è¯¢&lt;/li&gt;
&lt;li&gt;RestTemplateè¶…æ—¶æ—¶é—´è®¾ç½®ä¸ç”Ÿæ•ˆã€‚&lt;/li&gt;
&lt;li&gt;spring-webä¸åŒç‰ˆæœ¬è®¾ç½®RestTemplateæ–¹å¼ä¸å®Œå…¨ä¸€æ ·ã€‚&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="springboot" scheme="https://leokongwq.github.io/categories/springboot/"/>
    
    
      <category term="springboot" scheme="https://leokongwq.github.io/tags/springboot/"/>
    
      <category term="RestTemplate" scheme="https://leokongwq.github.io/tags/RestTemplate/"/>
    
  </entry>
  
  <entry>
    <title>springboot ä¹‹ Servlet3 webç»„ä»¶</title>
    <link href="https://leokongwq.github.io/2018/11/17/springboot-servlet3-component.html"/>
    <id>https://leokongwq.github.io/2018/11/17/springboot-servlet3-component.html</id>
    <published>2018-11-17T03:32:28.000Z</published>
    <updated>2018-11-17T03:44:26.752Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p><a href="https://jcp.org/en/jsr/detail?id=315" target="_blank" rel="external">Servlet3.0</a> è§„èŒƒæ–°å¢äº†å¾ˆå¤šæ³¨è§£ï¼Œä¾‹å¦‚ï¼š<code>@WebFilter</code>, <code>@WebServlet</code>, <code>@WebListener</code>, å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–Webåº”ç”¨çš„å¼€å‘ï¼Œä¸åœ¨ä½¿ç”¨ç¹ççš„xmlé…ç½®ã€‚</p>
<p>ä½†æ˜¯åœ¨SpringBootç¯å¢ƒå’Œæ”¯æŒServlet3.0è§„èŒƒçš„å®¹å™¨ä¸‹ä½¿ç”¨æœ‰äº›è®¸çš„åŒºåˆ«ã€‚</p>
<a id="more"></a>
<h3 id="springbootç¯å¢ƒä¸‹ä½¿ç”¨Servlet3-0æ³¨è§£"><a href="#springbootç¯å¢ƒä¸‹ä½¿ç”¨Servlet3-0æ³¨è§£" class="headerlink" title="springbootç¯å¢ƒä¸‹ä½¿ç”¨Servlet3.0æ³¨è§£"></a>springbootç¯å¢ƒä¸‹ä½¿ç”¨Servlet3.0æ³¨è§£</h3><h4 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span>
<span class="line"> * <span class="doctag">@author</span> jiexiu</span>
<span class="line"> */</span></span>
<span class="line"><span class="meta">@WebServlet</span>(name = <span class="string">"authServlet"</span>, urlPatterns = &#123;<span class="string">"/abc"</span>&#125;, loadOnStartup=<span class="number">1</span>)</span>
<span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AuthServlet</span><span class="params">()</span> </span>&#123;</span>
<span class="line">        <span class="keyword">super</span>();</span>
<span class="line">    &#125;</span>
<span class="line"></span>
<span class="line">    <span class="meta">@Override</span></span>
<span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span>
<span class="line">        System.out.println(<span class="string">"AuthServlet init"</span>);</span>
<span class="line">        <span class="keyword">super</span>.init();</span>
<span class="line">    &#125;</span>
<span class="line"></span>
<span class="line">    <span class="meta">@Override</span></span>
<span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> </span>&#123;</span>
<span class="line">        <span class="keyword">try</span> &#123;</span>
<span class="line">            resp.getOutputStream().write(<span class="string">"hello"</span>.getBytes());</span>
<span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span>
<span class="line">            e.printStackTrace();</span>
<span class="line">        &#125;</span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h4 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span>
<span class="line"> * <span class="doctag">@author</span> : jiexiu</span>
<span class="line"> * DateTime: 2018/3/7 ä¸‹åˆ10:32</span>
<span class="line"> * Mail:leokongwq@gmail.com   </span>
<span class="line"> * Description: desc</span>
<span class="line"> */</span></span>
<span class="line"><span class="meta">@WebFilter</span>(<span class="string">"/*"</span>)</span>
<span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">    <span class="meta">@Override</span></span>
<span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span>
<span class="line">        System.out.println(<span class="string">"AuthFilter init"</span>);</span>
<span class="line">    &#125;</span>
<span class="line"></span>
<span class="line">    <span class="meta">@Override</span></span>
<span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span>
<span class="line">        System.out.println(request.getLocalName());</span>
<span class="line">        chain.doFilter(request, response);</span>
<span class="line">    &#125;</span>
<span class="line"></span>
<span class="line">    <span class="meta">@Override</span></span>
<span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h4 id="Application-å¯åŠ¨ç±»"><a href="#Application-å¯åŠ¨ç±»" class="headerlink" title="Application å¯åŠ¨ç±»"></a>Application å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span>
<span class="line"> * <span class="doctag">@author</span> jiexiu</span>
<span class="line"> */</span></span>
<span class="line"><span class="meta">@EnableDiscoveryClient</span></span>
<span class="line"><span class="meta">@SpringBootApplication</span></span>
<span class="line"><span class="meta">@ServletComponentScan</span></span>
<span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookServiceApplication</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span>
<span class="line">		SpringApplication.run(BookServiceApplication.class, args);</span>
<span class="line">	&#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h3 id="ServletComponentScan"><a href="#ServletComponentScan" class="headerlink" title="@ServletComponentScan"></a>@ServletComponentScan</h3><p><code>@ServletComponentScan</code>è¿™ä¸ªæ³¨è§£å¾ˆé‡è¦ï¼Œå®ƒå‘Šè¯‰SpringBootä»å“ªé‡ŒåŠ è½½Servletç»„ä»¶ã€‚</p>
<p>å¦‚æœä¸åŠ è¯¥æ³¨è§£ï¼Œåˆ™åœ¨SpringBootå†…ç½®çš„Servletå®¹å™¨ä¸­ä¸èƒ½æ­£å¸¸åŠ è½½æ³¨è§£æŒ‡å®šçš„ç»„ä»¶ã€‚</p>
<p>åŸå› å‚è§ï¼š<a href="https://github.com/spring-projects/spring-boot/issues/2290" target="_blank" rel="external">https://github.com/spring-projects/spring-boot/issues/2290</a></p>
<h3 id="åŸç†è§£æ"><a href="#åŸç†è§£æ" class="headerlink" title="åŸç†è§£æ"></a>åŸç†è§£æ</h3><p><code>@ServletComponentScan</code>æ³¨è§£æ˜¯è¢« <code>ServletComponentRegisteringPostProcessor</code>è¿›è¡Œå¤„ç†çš„ã€‚ ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
</pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServletComponentRegisteringPostProcessor</span></span>
<span class="line">  <span class="keyword">implements</span> <span class="title">BeanFactoryPostProcessor</span>, <span class="title">ApplicationContextAware</span> </span>&#123;</span>
<span class="line">   </span>
<span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;ServletComponentHandler&gt; HANDLERS;</span>
<span class="line"> </span>
<span class="line">    <span class="keyword">static</span> &#123;</span>
<span class="line">        List&lt;ServletComponentHandler&gt; handlers = <span class="keyword">new</span> ArrayList&lt;&gt;();</span>
<span class="line">        handlers.add(<span class="keyword">new</span> WebServletHandler());</span>
<span class="line">        handlers.add(<span class="keyword">new</span> WebFilterHandler());</span>
<span class="line">        handlers.add(<span class="keyword">new</span> WebListenerHandler());</span>
<span class="line">        HANDLERS = Collections.unmodifiableList(handlers);</span>
<span class="line">    &#125;</span>
<span class="line">     </span>
<span class="line">    <span class="comment">//...</span></span>
<span class="line">     </span>
<span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scanPackage</span><span class="params">(</span>
<span class="line">      ClassPathScanningCandidateComponentProvider componentProvider, </span>
<span class="line">      String packageToScan)</span></span>&#123;</span>
<span class="line">        <span class="comment">//...</span></span>
<span class="line">        <span class="keyword">for</span> (ServletComponentHandler handler : HANDLERS) &#123;</span>
<span class="line">            handler.handle(((ScannedGenericBeanDefinition) candidate),</span>
<span class="line">              (BeanDefinitionRegistry) <span class="keyword">this</span>.applicationContext);</span>
<span class="line">        &#125;</span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;https://jcp.org/en/jsr/detail?id=315&quot;&gt;Servlet3.0&lt;/a&gt; è§„èŒƒæ–°å¢äº†å¾ˆå¤šæ³¨è§£ï¼Œä¾‹å¦‚ï¼š&lt;code&gt;@WebFilter&lt;/code&gt;, &lt;code&gt;@WebServlet&lt;/code&gt;, &lt;code&gt;@WebListener&lt;/code&gt;, å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–Webåº”ç”¨çš„å¼€å‘ï¼Œä¸åœ¨ä½¿ç”¨ç¹ççš„xmlé…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯åœ¨SpringBootç¯å¢ƒå’Œæ”¯æŒServlet3.0è§„èŒƒçš„å®¹å™¨ä¸‹ä½¿ç”¨æœ‰äº›è®¸çš„åŒºåˆ«ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="springboot" scheme="https://leokongwq.github.io/categories/springboot/"/>
    
    
      <category term="springboot" scheme="https://leokongwq.github.io/tags/springboot/"/>
    
      <category term="servlet3" scheme="https://leokongwq.github.io/tags/servlet3/"/>
    
  </entry>
  
  <entry>
    <title>springboot ä¹‹ ConfigurationProperties</title>
    <link href="https://leokongwq.github.io/2018/11/16/springboot-ConfigurationProperties.html"/>
    <id>https://leokongwq.github.io/2018/11/16/springboot-ConfigurationProperties.html</id>
    <published>2018-11-16T14:49:59.000Z</published>
    <updated>2018-11-21T15:01:26.189Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p><code>ConfigurationProperties</code> æ˜¯SpringBootå¼•å…¥çš„ä¸€ä¸ªå’Œå¤–éƒ¨é…ç½®æ–‡ä»¶ç›¸å…³çš„æ³¨è§£ç±»ã€‚å®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„ä½¿ç”¨å¤–ç½®çš„é…ç½®æ–‡ä»¶å±æ€§ã€‚</p>
<h3 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
</pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123; ElementType.TYPE, ElementType.METHOD &#125;)</span>
<span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span>
<span class="line"><span class="meta">@Documented</span></span>
<span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ConfigurationProperties &#123;</span>
<span class="line">    <span class="meta">@AliasFor</span>(<span class="string">"prefix"</span>)</span>
<span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span>
<span class="line">    <span class="meta">@AliasFor</span>(<span class="string">"value"</span>)</span>
<span class="line">    <span class="function">String <span class="title">prefix</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span>
<span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">ignoreInvalidFields</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span>
<span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">ignoreNestedProperties</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span>
<span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">ignoreUnknownFields</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span>
<span class="line">    <span class="meta">@Deprecated</span></span>
<span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">exceptionIfInvalid</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<a id="more"></a>
<h4 id="prefix-amp-value"><a href="#prefix-amp-value" class="headerlink" title="prefix &amp; value"></a>prefix &amp; value</h4><p>prefix å±æ€§å¯ä»¥æŒ‡å®šé…ç½®æ–‡ä»¶ä¸­é…ç½®é¡¹çš„å‰ç¼€ï¼Œå¦‚æ­¤ï¼Œç›¸åŒå‰ç¼€çš„é…ç½®é¡¹å°±å¯ä»¥ç»Ÿä¸€è§£æã€‚</p>
<h4 id="ignoreInvalidFields"><a href="#ignoreInvalidFields" class="headerlink" title="ignoreInvalidFields"></a>ignoreInvalidFields</h4><p>æ˜¯å¦å¿½ç•¥ä¸å¯ç”¨çš„å­—æ®µï¼Œé»˜è®¤ä¸º<code>false</code>ï¼Œ å½“é…ç½®é¡¹ä¸èƒ½è¢«æ­£ç¡®è½¬åŒ–ä¸ºJavaç±»çš„å­—æ®µå€¼æ—¶ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<h4 id="ignoreNestedProperties"><a href="#ignoreNestedProperties" class="headerlink" title="ignoreNestedProperties"></a>ignoreNestedProperties</h4><p>æ˜¯å¦å¿½ç•¥åµŒå¥—å±æ€§ï¼Œé»˜è®¤ä¸º<code>false</code>ï¼Œ </p>
<h4 id="ignoreUnknownFields"><a href="#ignoreUnknownFields" class="headerlink" title="ignoreUnknownFields"></a>ignoreUnknownFields</h4><p>æ˜¯å¦å¿½ç•¥Javaç±»ä¸å­˜åœ¨çš„å­—æ®µï¼Œé»˜è®¤å€¼ä¸º<code>true</code>ã€‚</p>
<h4 id="exceptionIfInvalid"><a href="#exceptionIfInvalid" class="headerlink" title="exceptionIfInvalid"></a>exceptionIfInvalid</h4><p>å¦‚æœJavaç±»åŠ äº†æ³¨è§£<code>@Validated</code>ï¼Œå¹¶ä¸”æ ¡éªŒå¤±è´¥äº†ï¼Œæ˜¯å¦æŠ›å‡ºå¼‚å¸¸ã€‚é»˜è®¤<code>true</code></p>
<h3 id="å±æ€§æ³¨å…¥åˆ°Javaç±»"><a href="#å±æ€§æ³¨å…¥åˆ°Javaç±»" class="headerlink" title="å±æ€§æ³¨å…¥åˆ°Javaç±»"></a>å±æ€§æ³¨å…¥åˆ°Javaç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
</pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span>
<span class="line"><span class="meta">@ConfigurationProperties</span></span>
<span class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:configprops.properties"</span>)</span>
<span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigProperties</span> </span>&#123;</span>
<span class="line"> </span>
<span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Credentials</span> </span>&#123;</span>
<span class="line">        <span class="meta">@Length</span>(max = <span class="number">4</span>, min = <span class="number">1</span>)</span>
<span class="line">        <span class="keyword">private</span> String authMethod;</span>
<span class="line">        <span class="keyword">private</span> String username;</span>
<span class="line">        <span class="keyword">private</span> String password;</span>
<span class="line"> </span>
<span class="line">       <span class="comment">// standard getters and setters</span></span>
<span class="line">    &#125;</span>
<span class="line">    <span class="meta">@NotBlank</span></span>
<span class="line">    <span class="keyword">private</span> String host;</span>
<span class="line">    <span class="meta">@Min</span>(<span class="number">1025</span>)</span>
<span class="line">    <span class="meta">@Max</span>(<span class="number">65536</span>)</span>
<span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> port;</span>
<span class="line">    <span class="meta">@Pattern</span>(regexp = <span class="string">"^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]&#123;2,6&#125;$"</span>)</span>
<span class="line">    <span class="keyword">private</span> String from;</span>
<span class="line">    <span class="keyword">private</span> Credentials credentials;</span>
<span class="line">    <span class="keyword">private</span> List&lt;String&gt; defaultRecipients;</span>
<span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; additionalHeaders;</span>
<span class="line">  </span>
<span class="line">    <span class="comment">// standard getters and setters</span></span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>é»˜è®¤å±æ€§é…ç½®ä»<code>application.properties</code>æ–‡ä»¶ä¸­è·å–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>@PropertySource</code>æŒ‡å®šã€‚</p>
<p><code>@Configuration</code>æ³¨è§£ä¸å¯ç¼ºå°‘ã€‚</p>
<p>èµ„æºæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
</pre></td><td class="code"><pre><span class="line">#Simple properties</span>
<span class="line">mail.host=mailer@mail.com</span>
<span class="line">mail.port=9000</span>
<span class="line">mail.from=mailer@mail.com</span>
<span class="line"> </span>
<span class="line">#List properties</span>
<span class="line">mail.defaultRecipients[0]=admin@mail.com</span>
<span class="line">mail.defaultRecipients[1]=owner@mail.com</span>
<span class="line"> </span>
<span class="line">#Map Properties</span>
<span class="line">mail.additionalHeaders.redelivery=true</span>
<span class="line">mail.additionalHeaders.secure=true</span>
<span class="line"> </span>
<span class="line">#Object properties</span>
<span class="line">mail.credentials.username=john</span>
<span class="line">mail.credentials.password=password</span>
<span class="line">mail.credentials.authMethod=SHA1</span>
</pre></td></tr></table></figure>
<h4 id="å†…åµŒç±»å±æ€§"><a href="#å†…åµŒç±»å±æ€§" class="headerlink" title="å†…åµŒç±»å±æ€§"></a>å†…åµŒç±»å±æ€§</h4><p><code>mail.credentials.username</code>å¯ä»¥æ³¨å…¥åˆ°å†…åµŒå±æ€§<code>credentials</code>ä¸­</p>
<h4 id="åˆ—è¡¨å­—æ®µ"><a href="#åˆ—è¡¨å­—æ®µ" class="headerlink" title="åˆ—è¡¨å­—æ®µ"></a>åˆ—è¡¨å­—æ®µ</h4><p><code>mail.defaultRecipients[0]</code> å¯ä»¥æ³¨å…¥åˆ°ç±»çš„åˆ—è¡¨(æ•°ç»„é¡µå¯ä»¥)å±æ€§ä¸­ã€‚</p>
<h4 id="mapå­—æ®µ"><a href="#mapå­—æ®µ" class="headerlink" title="mapå­—æ®µ"></a>mapå­—æ®µ</h4><p><code>mail.additionalHeaders.redelivery</code> æ ¼å¼çš„é…ç½®é¡¹ä¹Ÿå¯ä»¥æ³¨å…¥åˆ°<code>Map</code>ç±»å‹çš„å±æ€§ä¸­ã€‚</p>
<h3 id="é€šè¿‡-ConfigurationProperties-Beanæ³¨è§£åœ¨é…ç½®ç±»çš„beanå®šä¹‰æ–¹æ³•ä¸Š"><a href="#é€šè¿‡-ConfigurationProperties-Beanæ³¨è§£åœ¨é…ç½®ç±»çš„beanå®šä¹‰æ–¹æ³•ä¸Š" class="headerlink" title="é€šè¿‡@ConfigurationProperties + @Beanæ³¨è§£åœ¨é…ç½®ç±»çš„beanå®šä¹‰æ–¹æ³•ä¸Š"></a>é€šè¿‡@ConfigurationProperties + @Beanæ³¨è§£åœ¨é…ç½®ç±»çš„beanå®šä¹‰æ–¹æ³•ä¸Š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span>
<span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"mail"</span>)</span>
<span class="line"><span class="function"><span class="keyword">public</span> ConfigProperties <span class="title">mailConfig</span><span class="params">()</span> </span>&#123;</span>
<span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ConfigProperties();</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h3 id="ConfigurationProperties-EnableConfigurationProperties"><a href="#ConfigurationProperties-EnableConfigurationProperties" class="headerlink" title="@ConfigurationProperties + @EnableConfigurationProperties"></a>@ConfigurationProperties + @EnableConfigurationProperties</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
</pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span>
<span class="line"><span class="meta">@EnableConfigurationProperties</span>(&#123;ConfigProperties.class&#125;)</span>
<span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span>
<span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">        SpringApplication.run(Application.class, args);</span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h3 id="å±æ€§æ ¡éªŒ"><a href="#å±æ€§æ ¡éªŒ" class="headerlink" title="å±æ€§æ ¡éªŒ"></a>å±æ€§æ ¡éªŒ</h3><p>å¯ä»¥ç»™å±æ€§ç±»ä¸ŠåŠ å…¥<code>javax.validation.constraints.*</code>ä¸­çš„æ³¨è§£ï¼Œæ¥å¯¹é…ç½®é¡¹è¿›è¡Œæ ¡éªŒã€‚é…åˆ<code>exceptionIfInvalid</code>å¯ä»¥æ›´æ—©çš„å‘ç°é—®é¢˜ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ConfigurationProperties&lt;/code&gt; æ˜¯SpringBootå¼•å…¥çš„ä¸€ä¸ªå’Œå¤–éƒ¨é…ç½®æ–‡ä»¶ç›¸å…³çš„æ³¨è§£ç±»ã€‚å®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„ä½¿ç”¨å¤–ç½®çš„é…ç½®æ–‡ä»¶å±æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æºç è§£æ&quot;&gt;&lt;a href=&quot;#æºç è§£æ&quot; class=&quot;headerlink&quot; title=&quot;æºç è§£æ&quot;&gt;&lt;/a&gt;æºç è§£æ&lt;/h3&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Target&lt;/span&gt;(&amp;#123; ElementType.TYPE, ElementType.METHOD &amp;#125;)&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Retention&lt;/span&gt;(RetentionPolicy.RUNTIME)&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Documented&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;meta&quot;&gt;@interface&lt;/span&gt; ConfigurationProperties &amp;#123;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@AliasFor&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;prefix&quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;String &lt;span class=&quot;title&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; &quot;&quot;&lt;/span&gt;;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@AliasFor&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;value&quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;String &lt;span class=&quot;title&quot;&gt;prefix&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; &quot;&quot;&lt;/span&gt;;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ignoreInvalidFields&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ignoreNestedProperties&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ignoreUnknownFields&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Deprecated&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;exceptionIfInvalid&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;&lt;/span&gt;;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="springboot" scheme="https://leokongwq.github.io/categories/springboot/"/>
    
    
      <category term="spring" scheme="https://leokongwq.github.io/tags/spring/"/>
    
      <category term="springboot" scheme="https://leokongwq.github.io/tags/springboot/"/>
    
      <category term="è¯‘" scheme="https://leokongwq.github.io/tags/%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>JDK8ç¯å¢ƒä¸‹ä½¿ç”¨struts2</title>
    <link href="https://leokongwq.github.io/2018/11/07/struts2-with-jdk8.html"/>
    <id>https://leokongwq.github.io/2018/11/07/struts2-with-jdk8.html</id>
    <published>2018-11-07T14:07:54.000Z</published>
    <updated>2018-11-07T15:02:22.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>æœ€è¿‘å°†ç»„å†…é¡¹ç›®çš„éƒ¨ç½²ç¯å¢ƒè¿›è¡Œäº†ä¸€æ¬¡å‡çº§ã€‚å°†JDK1.7Så‡çº§ä¸º1.8ï¼ŒResinæ›¿æ¢ä¸ºTomcatã€‚åœ¨å‡çº§æ›¿æ¢çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€äº›é—®é¢˜ã€‚ç‰¹è®°å½•å†æ¬¡ï¼Œå¸Œæœ›èƒ½å¸®åŠ©æœ‰åŒæ ·éœ€æ±‚çš„æœ‹å‹ã€‚</p>
<a id="more"></a>
<h3 id="Struts2-å’Œ-JDK8"><a href="#Struts2-å’Œ-JDK8" class="headerlink" title="Struts2 å’Œ JDK8"></a>Struts2 å’Œ JDK8</h3><p>é¡¹ç›®ä¸­ä½¿ç”¨çš„<code>Struts2</code>ç‰ˆæœ¬æ˜¯<code>2.3.35</code>ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.struts<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>struts2-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.35<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span>
<span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span>
</pre></td></tr></table></figure>
<p>Struts2é‡Œé¢ä¾èµ–<code>xwork-core</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.struts.xwork<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xwork-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.35<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span>
<span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span>
</pre></td></tr></table></figure>
<p><code>xwork-core</code>ä¾èµ–<code>asm-*</code></p>
<p>é—®é¢˜æ¥äº†!</p>
<p>ä½ç‰ˆæœ¬çš„<code>ASM</code>ä¸èƒ½åœ¨JDK1.8ç¯å¢ƒä¸­ä½¿ç”¨ã€‚å¦‚æœå¼ºè¡Œä½¿ç”¨ï¼Œä¼šå¯¼è‡´ä¸€äº›å¥‡æ€ªçš„é—®é¢˜ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<ol>
<li>åªæœ‰ä¸€éƒ¨åˆ†<code>Action</code>ç±»å¯ä»¥æ­£å¸¸è¢«Struts2åŠ è½½å¹¶å¤„ç†httpè¯·æ±‚ã€‚æŸäº›åœ¨JDK1.7ç¯å¢ƒä¸‹å¯ä»¥æ­£å¸¸å·¥ä½œçš„<code>Action</code>ä¸èƒ½åœ¨JDK1.8ä¸‹ä½¿ç”¨ã€‚åŸæ¥å¯ä»¥è®¿é—®çš„æ¥å£ï¼Œç°åœ¨æ˜¯<code>404</code>ã€‚</li>
</ol>
<p>å…·ä½“é—®é¢˜å‡ºåœ¨ï¼š</p>
<figure class="highlight java"><figcaption><span>DefaultClassFinder</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
</pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readClassDef</span><span class="params">(String className)</span> </span>&#123;</span>
<span class="line">   <span class="keyword">if</span> (!className.endsWith(<span class="string">".class"</span>)) &#123;</span>
<span class="line">       className = className.replace(<span class="string">'.'</span>, <span class="string">'/'</span>) + <span class="string">".class"</span>;</span>
<span class="line">   &#125;</span>
<span class="line">   <span class="keyword">try</span> &#123;</span>
<span class="line">       URL resource = classLoaderInterface.getResource(className);</span>
<span class="line">       <span class="keyword">if</span> (resource != <span class="keyword">null</span>) &#123;</span>
<span class="line">           InputStream in = resource.openStream();</span>
<span class="line">           <span class="keyword">try</span> &#123;</span>
<span class="line">               ClassReader classReader = <span class="keyword">new</span> ClassReader(in);</span>
<span class="line">               classReader.accept(<span class="keyword">new</span> InfoBuildingVisitor(<span class="keyword">this</span>), ClassReader.SKIP_DEBUG);</span>
<span class="line">           &#125; <span class="keyword">finally</span> &#123;</span>
<span class="line">               in.close();</span>
<span class="line">           &#125;</span>
<span class="line">       &#125; <span class="keyword">else</span> &#123;</span>
<span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> XWorkException(<span class="string">"Could not load "</span> + className);</span>
<span class="line">       &#125;</span>
<span class="line">   &#125; <span class="keyword">catch</span> (IOException e) &#123;</span>
<span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> XWorkException(<span class="string">"Could not load "</span> + className, e);</span>
<span class="line">   &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>è¿™éƒ¨åˆ†ä»£ç å°±å› ä¸ºä½¿ç”¨äº†ä½ç‰ˆæœ¬çš„<code>ASM</code>å¯¼è‡´ç±»è§£æå¤±è´¥(<code>IndexOutOfBoundsException</code>)ã€‚</p>
<h4 id="è§£å†³åŠæ³•ä¸€"><a href="#è§£å†³åŠæ³•ä¸€" class="headerlink" title="è§£å†³åŠæ³•ä¸€"></a>è§£å†³åŠæ³•ä¸€</h4><p>æœ€ç®€å•æ–¹ä¾¿çš„è§£å†³ç‰ˆæœ¬å°±æ˜¯å‡çº§Struts2çš„ç‰ˆæœ¬åˆ°<code>2.5.x</code>ã€‚æ–°ç‰ˆæœ¬å°†<code>xwork</code>ä¾èµ–ç›´æ¥åˆå¹¶åˆ°<code>struts2-core</code>ä¸­äº†ã€‚è€Œä¸”ä½¿ç”¨äº†<code>ASM 5.X</code>ç‰ˆæœ¬ï¼Œæ”¯æŒJDK8ã€‚</p>
<h4 id="è§£å†³åŠæ³•äºŒ"><a href="#è§£å†³åŠæ³•äºŒ" class="headerlink" title="è§£å†³åŠæ³•äºŒ"></a>è§£å†³åŠæ³•äºŒ</h4><p>ä½¿ç”¨Struts2å®˜æ–¹æä¾›çš„ä¸€ä¸ªæ’ä»¶ã€‚å…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<hr>
<p>åœ¨é¡¹ç›®ä¸­åŠ å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.struts<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>struts2-java8-support-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.35<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span>
<span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span>
</pre></td></tr></table></figure>
<p>æ’é™¤ASMä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
</pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.struts.xwork<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xwork-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>asm<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>asm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>asm<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>asm-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span>
<span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span>
</pre></td></tr></table></figure>
<h3 id="Struts2-ç‰ˆæœ¬å‡çº§é—®é¢˜"><a href="#Struts2-ç‰ˆæœ¬å‡çº§é—®é¢˜" class="headerlink" title="Struts2 ç‰ˆæœ¬å‡çº§é—®é¢˜"></a>Struts2 ç‰ˆæœ¬å‡çº§é—®é¢˜</h3><h4 id="æ ‡ç­¾åº“ä¸å…¼å®¹"><a href="#æ ‡ç­¾åº“ä¸å…¼å®¹" class="headerlink" title="æ ‡ç­¾åº“ä¸å…¼å®¹"></a>æ ‡ç­¾åº“ä¸å…¼å®¹</h4><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒStruts2æ¡†æ¶çš„å®‰å…¨é—®é¢˜å¾ˆå¤šï¼Œå»ºè®®å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬<code>2.5.x</code>ã€‚</p>
<p>ä½†æ˜¯2.5.xç‰ˆæœ¬çš„Struts2æä¾›çš„<strong>æ ‡ç­¾åº“</strong>å’Œä½ç‰ˆæœ¬çš„ä¸å…¼å®¹ã€‚è¿™å°±ä¼šå¯¼è‡´åŸæœ‰çš„<strong>JSPé¡µé¢ä¸èƒ½æ­£å¸¸æ¸²æŸ“</strong>ã€‚</p>
<p>å½“ç„¶äº†ï¼Œå¦‚æœä½ çš„é¡¹ç›®é‡Œé¢æ²¡æœ‰ä½¿ç”¨Struts2æ›¿æ¢çš„æ ‡ç­¾ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥å¿½ç•¥äº†ã€‚</p>
<h4 id="æ ¸å¿ƒç±»æ‹¦æˆªå™¨å˜åŒ–"><a href="#æ ¸å¿ƒç±»æ‹¦æˆªå™¨å˜åŒ–" class="headerlink" title="æ ¸å¿ƒç±»æ‹¦æˆªå™¨å˜åŒ–"></a>æ ¸å¿ƒç±»æ‹¦æˆªå™¨å˜åŒ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
</pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span>
<span class="line"><span class="comment">&lt;!--Â org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilterÂ </span>
<span class="line">ä¹‹å‰çš„æ ¸å¿ƒè¿‡æ»¤å™¨å…¨ç±»åä¼šæœ‰ä¸ªng Â ,struts2.5æ ¸å¿ƒè¿‡æ»¤å™¨æ²¡æœ‰è¿™ä¸ª</span>
<span class="line">--&gt;</span></span>
<span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span>
<span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span>
<span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span>
</pre></td></tr></table></figure>
<h3 id="aspectjweaver"><a href="#aspectjweaver" class="headerlink" title="aspectjweaver"></a>aspectjweaver</h3><p>æˆ‘ä»¬é¡¹ç›®ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span>
<span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span>
</pre></td></tr></table></figure>
<p>å‡çº§JDK1.8ä»¥åï¼Œéœ€è¦åŒæ—¶å‡çº§è¯¥jarçš„ç‰ˆæœ¬åˆ°<code>1.8.13</code>ã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://blog.csdn.net/gh670011677/article/details/75019003" target="_blank" rel="external">Struts2.5é…ç½®</a></p>
<p><a href="https://struts.apache.org/plugins/java-8-support/" target="_blank" rel="external">Java 8 Support Plugin</a></p>
<p><a href="https://cwiki.apache.org/confluence/display/WW/Struts+2.3+to+2.5+migration" target="_blank" rel="external">Struts+2.3+to+2.5+migration</a></p>
<p><a href="https://stackoverflow.com/questions/41307863/what-is-the-difference-between-struts-2-3-x-and-struts-2-5-x" target="_blank" rel="external">what-is-the-difference-between-struts-2-3-x-and-struts-2-5-x</a></p>
<p><a href="https://asm.ow2.io/versions.html" target="_blank" rel="external">ASM-VERSIONS</a></p>
<p><a href="https://nosec.org/home/detail/1755.html" target="_blank" rel="external">Struts2æœ€æ–°RCEæ¼æ´S2-057</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h3&gt;&lt;p&gt;æœ€è¿‘å°†ç»„å†…é¡¹ç›®çš„éƒ¨ç½²ç¯å¢ƒè¿›è¡Œäº†ä¸€æ¬¡å‡çº§ã€‚å°†JDK1.7Så‡çº§ä¸º1.8ï¼ŒResinæ›¿æ¢ä¸ºTomcatã€‚åœ¨å‡çº§æ›¿æ¢çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€äº›é—®é¢˜ã€‚ç‰¹è®°å½•å†æ¬¡ï¼Œå¸Œæœ›èƒ½å¸®åŠ©æœ‰åŒæ ·éœ€æ±‚çš„æœ‹å‹ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="struts2" scheme="https://leokongwq.github.io/tags/struts2/"/>
    
      <category term="JDK8" scheme="https://leokongwq.github.io/tags/JDK8/"/>
    
  </entry>
  
  <entry>
    <title>mavenåŠ é€Ÿ</title>
    <link href="https://leokongwq.github.io/2018/11/03/how-to-make-maven-faster.html"/>
    <id>https://leokongwq.github.io/2018/11/03/how-to-make-maven-faster.html</id>
    <published>2018-11-03T04:42:36.000Z</published>
    <updated>2018-11-03T04:58:39.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ç”±äºç½‘ç»œåŸå› ï¼Œå›½å†…è®¿é—®mavenä¸­å¤®ä»“åº“é€Ÿåº¦å¾ˆæ…¢ã€‚ç¼–è¯‘å¤§å‹Mavené¡¹ç›®æ—¶é€Ÿåº¦å¾ˆæ…¢ã€‚æ­¤æ—¶å¯ä»¥é€šè¿‡å…¬ç”¨çš„æˆ–ç§æœ‰çš„é•œåƒç«™æ¥è¿›è¡ŒåŠ é€Ÿã€‚</p>
<a id="more"></a>
<h3 id="å›½å†…Mavené•œåƒç«™ç‚¹"><a href="#å›½å†…Mavené•œåƒç«™ç‚¹" class="headerlink" title="å›½å†…Mavené•œåƒç«™ç‚¹"></a>å›½å†…Mavené•œåƒç«™ç‚¹</h3><h4 id="aliyun"><a href="#aliyun" class="headerlink" title="aliyun"></a>aliyun</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
</pre></td><td class="code"><pre><span class="line">&lt;mirror&gt;Â Â </span>
<span class="line">Â Â Â Â Â Â &lt;id&gt;alimaven&lt;/id&gt;Â Â </span>
<span class="line">Â Â Â Â Â Â &lt;name&gt;aliyunÂ maven&lt;/name&gt;Â Â </span>
<span class="line">Â Â Â Â Â Â &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;Â Â </span>
<span class="line">Â Â Â Â Â Â &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;Â Â Â Â </span>
<span class="line">&lt;/mirror&gt;</span>
</pre></td></tr></table></figure>
<h4 id="oschina"><a href="#oschina" class="headerlink" title="oschina"></a>oschina</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
</pre></td><td class="code"><pre><span class="line">&lt;mirror&gt;    </span>
<span class="line">    &lt;id&gt;CN&lt;/id&gt;  </span>
<span class="line">    &lt;name&gt;OSChina Central&lt;/name&gt;         </span>
<span class="line">    &lt;url&gt;http://maven.oschina.net/content/groups/public/&lt;/url&gt;  </span>
<span class="line">    &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;    </span>
<span class="line">&lt;/mirror&gt;</span>
</pre></td></tr></table></figure>
<h3 id="setting-xml-é…ç½®"><a href="#setting-xml-é…ç½®" class="headerlink" title="setting.xml é…ç½®"></a>setting.xml é…ç½®</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
</pre></td><td class="code"><pre><span class="line">&lt;mirrors&gt;</span>
<span class="line">    &lt;!-- ä½œä¸ºä¸­å¤®ä»“åº“çš„é•œåƒ --&gt;</span>
<span class="line">    &lt;mirror&gt;</span>
<span class="line">      &lt;id&gt;nexus-aliyun&lt;/id&gt;</span>
<span class="line">      &lt;name&gt;Nexus aliyun&lt;/name&gt;</span>
<span class="line">      &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</span>
<span class="line">      &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public&lt;/url&gt;</span>
<span class="line">    &lt;/mirror&gt;</span>
<span class="line">    &lt;!-- ç§æœ‰ï¼Œ å…¬å¸å†…éƒ¨ä½¿ç”¨ --&gt;</span>
<span class="line">    &lt;mirror&gt;</span>
<span class="line">      &lt;id&gt;nexus-mine&lt;/id&gt;</span>
<span class="line">      &lt;name&gt;Nexus mine&lt;/name&gt;</span>
<span class="line">      &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;</span>
<span class="line">      &lt;url&gt;http://xx.xx.xx.xx/nexus/content/groups/public&lt;/url&gt;</span>
<span class="line">    &lt;/mirror&gt;</span>
<span class="line">  &lt;/mirrors&gt;</span>
</pre></td></tr></table></figure>
<h3 id="mirrorOf-é…ç½®"><a href="#mirrorOf-é…ç½®" class="headerlink" title="mirrorOf é…ç½®"></a>mirrorOf é…ç½®</h3><p><code>mirrorOf</code> ç”¨æ¥æŒ‡å®šè¯¥é•œåƒé’ˆå¯¹çš„ä»“åº“ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>*</code> åŒ¹é…æ‰€æœ‰ä»“åº“</li>
<li><code>external:*</code> åŒ¹é…é™¤äº†æœ¬æœºå’ŒåŸºäºæ–‡ä»¶çš„æ‰€æœ‰å¤–éƒ¨æ„å»ºåœ°å€ã€‚</li>
<li><code>repo,repo1</code> åŒ¹é…ä»“åº“<code>repo</code>å’Œ<code>repo1</code></li>
<li><code>*,!repo1</code> é™¤äº†ä»“åº“<code>repo1</code>åŒ¹é…æ‰€æœ‰</li>
</ul>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://maven.apache.org/guides/mini/guide-mirror-settings.html" target="_blank" rel="external">guide-mirror-settings</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;ç”±äºç½‘ç»œåŸå› ï¼Œå›½å†…è®¿é—®mavenä¸­å¤®ä»“åº“é€Ÿåº¦å¾ˆæ…¢ã€‚ç¼–è¯‘å¤§å‹Mavené¡¹ç›®æ—¶é€Ÿåº¦å¾ˆæ…¢ã€‚æ­¤æ—¶å¯ä»¥é€šè¿‡å…¬ç”¨çš„æˆ–ç§æœ‰çš„é•œåƒç«™æ¥è¿›è¡ŒåŠ é€Ÿã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="maven" scheme="https://leokongwq.github.io/tags/maven/"/>
    
  </entry>
  
  <entry>
    <title>consul å‘½ä»¤ä»‹ç»</title>
    <link href="https://leokongwq.github.io/2018/07/29/consul-command-intro.html"/>
    <id>https://leokongwq.github.io/2018/07/29/consul-command-intro.html</id>
    <published>2018-07-28T16:25:40.000Z</published>
    <updated>2018-07-29T07:32:41.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="consul-å‘½ä»¤ç”¨æ³•"><a href="#consul-å‘½ä»¤ç”¨æ³•" class="headerlink" title="consul å‘½ä»¤ç”¨æ³•"></a>consul å‘½ä»¤ç”¨æ³•</h2><p>å®‰è£…å®Œconsulåï¼Œé€šè¿‡åœ¨æ§åˆ¶å°ç›´æ¥å®ç°<code>consul</code>å‘½ä»¤äº†è§£consulå‘½ä»¤è¡Œçš„ç”¨æ³•ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
</pre></td><td class="code"><pre><span class="line">Usage: consul [--version] [--help] &lt;command&gt; [&lt;args&gt;]</span>
<span class="line"></span>
<span class="line">Available commands are:</span>
<span class="line">agent          Runs a Consul agent</span>
<span class="line">catalog        Interact with the catalog</span>
<span class="line">event          Fire a new event</span>
<span class="line">exec           Executes a command on Consul nodes</span>
<span class="line">force-leave    Forces a member of the cluster to enter the &quot;left&quot; state</span>
<span class="line">info           Provides debugging information for operators.</span>
<span class="line">join           Tell Consul agent to join cluster</span>
<span class="line">keygen         Generates a new encryption key</span>
<span class="line">keyring        Manages gossip layer encryption keys</span>
<span class="line">kv             Interact with the key-value store</span>
<span class="line">leave          Gracefully leaves the Consul cluster and shuts down</span>
<span class="line">lock           Execute a command holding a lock</span>
<span class="line">maint          Controls node or service maintenance mode</span>
<span class="line">members        Lists the members of a Consul cluster</span>
<span class="line">monitor        Stream logs from a Consul agent</span>
<span class="line">operator       Provides cluster-level tools for Consul operators</span>
<span class="line">reload         Triggers the agent to reload configuration files</span>
<span class="line">rtt            Estimates network round trip time between nodes</span>
<span class="line">snapshot       Saves, restores and inspects snapshots of Consul server state</span>
<span class="line">validate       Validate config files/directories</span>
<span class="line">version        Prints the Consul version</span>
<span class="line">watch          Watch for changes in Consul</span>
</pre></td></tr></table></figure>
<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œ consulæä¾›çš„å‘½ä»¤å¾ˆå¤šï¼Œä¸‹é¢å°±é€ä¸ªå­¦ä¹ ä¸‹æ¯ä¸ªå‘½ä»¤çš„ä½œç”¨å’Œç”¨æ³•ã€‚</p>
<a id="more"></a>
<h2 id="agent"><a href="#agent" class="headerlink" title="agent"></a>agent</h2><p><code>agent</code> å‘½ä»¤çš„ä½œç”¨æ˜¯å¯åŠ¨ä¸€ä¸ª<code>consul</code> è¿›ç¨‹ï¼Œ è¯¥è¿›ç¨‹çš„å…·ä½“ä½œç”¨å’Œè¯¥å‘½ä»¤çš„å‚æ•°æœ‰å…³ã€‚</p>
<p>é€šè¿‡ <code>consul agent --help</code> å¯ä»¥è·å–è¯¥å‘½ä»¤çš„è¯¦ç»†ç”¨æ³•</p>
<h3 id="datacenter"><a href="#datacenter" class="headerlink" title="datacenter"></a>datacenter</h3><p>è¯¥å‚æ•°æŒ‡å®šè¯¥<code>agent</code>æ‰€åœ¨çš„æ•°æ®ä¸­å¿ƒåç§°ã€‚æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-datacenter=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="advertise"><a href="#advertise" class="headerlink" title="advertise"></a>advertise</h3><p>è¯¥å‚æ•°ç”¨æ¥è®¾ç½®<code>advertise</code>æ‰€ä½¿ç”¨çš„åœ°å€ã€‚é»˜è®¤å€¼å’Œ<code>-bind</code>æŒ‡å®šçš„åœ°å€ä¸€æ ·</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-advertise=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="advertise-wan"><a href="#advertise-wan" class="headerlink" title="advertise-wan"></a>advertise-wan</h3><p>è®¾ç½®å¹¿åŸŸç½‘ç¯å¢ƒçš„çš„<code>advertise</code>åœ°å€ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-advertise-wan=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="bind"><a href="#bind" class="headerlink" title="-bind"></a>-bind</h3><p>è®¾ç½®é›†ç¾¤é€šä¿¡æ‰€ä½¿ç”¨çš„IPåœ°å€ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-bind=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="bootstrap"><a href="#bootstrap" class="headerlink" title="bootstrap"></a>bootstrap</h3><p>å°†Serverè®¾ç½®ä¸º<code>boostrap</code>æ¨¡å¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-bootstrap</span>
</pre></td></tr></table></figure>
<h3 id="bootstrap-expect"><a href="#bootstrap-expect" class="headerlink" title="bootstrap-expect"></a>bootstrap-expect</h3><p>å°†Serverè®¾ç½®ä¸º<code>expect boostrap</code>æ¨¡å¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-bootstrap-expect=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="client"><a href="#client" class="headerlink" title="client"></a>client</h3><p>è®¾ç½®å®¢æˆ·ç«¯è®¿é—®æ‰€ä½¿ç”¨çš„IPåœ°å€ã€‚ è¯¥åœ°å€å¯ç”¨äºRPC, DNS,HTTP,HTTPSé€šä¿¡ä½¿ç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-client=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="config-dir"><a href="#config-dir" class="headerlink" title="config-dir"></a>config-dir</h3><p>è®¾ç½®é…ç½®æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•çš„è·¯å¾„ã€‚consulä¼šè¯»å–è¯¥ç›®å½•ä¸‹æ‰€æœ‰ä»¥<code>.json</code>ç»“å°¾çš„æ–‡ä»¶ä½œä¸ºé…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”ä»¥æ–‡ä»¶åå­—å…¸åºæ¥åº”ç”¨è¿™äº›é…ç½®æ–‡ä»¶ã€‚</p>
<p>è¯¥å‚æ•°å¯ä»¥å¤šæ¬¡ä½¿ç”¨ï¼Œæ¥æŒ‡å®šå¤šä¸ªé…ç½®æ–‡ä»¶ç›®å½•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-config-dir=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="config-file"><a href="#config-file" class="headerlink" title="config-file"></a>config-file</h3><p>æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥å¤šæ¬¡å¤šæ¬¡ä½¿ç”¨ï¼Œç”¨æ¥æŒ‡å®šå¤šä¸ªé…ç½®æ–‡ä»¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-config-file=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="config-format"><a href="#config-format" class="headerlink" title="config-format"></a>config-format</h3><p>è®¾ç½®é…ç½®æ–‡ä»¶çš„æ ¼å¼ã€‚ <code>json</code>æˆ–<code>hcl</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-config-format=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="data-dir"><a href="#data-dir" class="headerlink" title="data-dir"></a>data-dir</h3><p>è®¾ç½®ä¿å­˜<code>agent</code>çŠ¶æ€æ•°æ®çš„ç›®å½•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-data-dir=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="dev"><a href="#dev" class="headerlink" title="dev"></a>dev</h3><p>è¯¥<code>agent</code>ä»¥å¼€å‘æ¨¡å¼è¿è¡Œã€‚ä¼šè¾“å‡ºè¯¦ç»†çš„æ—¥å­ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-dev</span>
</pre></td></tr></table></figure>
<h3 id="disable-host-node-id"><a href="#disable-host-node-id" class="headerlink" title="disable-host-node-id"></a>disable-host-node-id</h3><p>è¯¥è¯¥é€‰é¡¹è®¾ç½®ä¸ºtrue, åˆ™consulä¸ä¼šä½¿ç”¨æ‰€åœ¨ä¸»æœºçš„ä¿¡æ¯ç”Ÿæˆé›†ç¾¤ç»“ç‚¹idã€‚ ä»è€Œæ¯æ¬¡éƒ½ç”Ÿæˆä¸€ä¸ªéšæœºå€¼ã€‚<br>å»ºè®®ä¸è¦å¼€å§‹è¯¥é€‰é¡¹ã€‚é»˜è®¤çš„ç»“ç‚¹idå°†ä¼šæ˜¯ä¸»æœºå<code>hostname</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-disable-host-node-id</span>
</pre></td></tr></table></figure>
<h3 id="disable-keyring-file"><a href="#disable-keyring-file" class="headerlink" title="disable-keyring-file"></a>disable-keyring-file</h3><p>ç¦æ­¢å°†<code>keyring</code>å¤‡ä»½åˆ°æ–‡ä»¶ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-disable-keyring-file</span>
</pre></td></tr></table></figure>
<h3 id="dns-port"><a href="#dns-port" class="headerlink" title="dns-port"></a>dns-port</h3><p>è®¾ç½®DNS æŸ¥è¯¢æ‰€ä½¿ç”¨çš„ç«¯å£ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-dns-port=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="domain"><a href="#domain" class="headerlink" title="domain"></a>domain</h3><p>DNS æ¥å£æ‰€ä½¿ç”¨çš„åŸŸåã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-domain=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="enable-script-checks"><a href="#enable-script-checks" class="headerlink" title="enable-script-checks"></a>enable-script-checks</h3><p>å¯ç”¨å¥åº·æ£€æµ‹è„šæœ¬ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-enable-script-checks</span>
</pre></td></tr></table></figure>
<h3 id="encrypt"><a href="#encrypt" class="headerlink" title="encrypt"></a>encrypt</h3><p>æä¾›<code>gossip</code>å¹¿æ’­åŠ å¯†æ•°æ®æ‰€ä½¿ç”¨çš„key.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-encrypt=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="hcl"><a href="#hcl" class="headerlink" title="hcl"></a>hcl</h3><p><code>hcl</code> é…ç½®ç‰‡æ®µã€‚ å¯ä»¥å¤šæ¬¡ä½¿ç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-hcl=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="http-port"><a href="#http-port" class="headerlink" title="http-port"></a>http-port</h3><p>è®¾ç½®http API æœåŠ¡ç›‘å¬çš„ç«¯å£ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-http-port=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="join"><a href="#join" class="headerlink" title="join"></a>join</h3><p>è®¾ç½®è¯¥<code>agent</code>å¯åŠ¨æ—¶åŠ å…¥æ‰€åœ¨é›†ç¾¤çš„æˆå‘˜IPåœ°å€ã€‚å¯ä»¥å¤šæ¬¡ä½¿ç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-join=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="join-wan"><a href="#join-wan" class="headerlink" title="join-wan"></a>join-wan</h3><p>è®¾ç½®è¯¥<code>agent</code>å¯åŠ¨æ—¶åŠ å…¥æ‰€åœ¨è·¨IDCé›†ç¾¤çš„æˆå‘˜IPåœ°å€ã€‚å¯ä»¥å¤šæ¬¡ä½¿ç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-join-wan=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="log-level"><a href="#log-level" class="headerlink" title="log-level"></a>log-level</h3><p>è®¾ç½®<code>agent</code>çš„æ—¥å¿—è¾“å‡ºçº§åˆ«ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-log-level=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="node"><a href="#node" class="headerlink" title="node"></a>node</h3><p>è®¾ç½®è¯¥ç»“ç‚¹åœ¨é›†ç¾¤ä¸­çš„åç§°ï¼Œå¿…é¡»å”¯ä¸€ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-node=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="node-id"><a href="#node-id" class="headerlink" title="node-id"></a>node-id</h3><p>è®¾ç½®è¯¥ç»“ç‚¹åœ¨é›†ç¾¤ä¸­æ°¸æ’çš„IDï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªéšæœºç”Ÿæˆçš„å€¼ï¼Œå¹¶ä¿å­˜çš„æ•°æ®ç›®å½•ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-node-id=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="node-meta"><a href="#node-meta" class="headerlink" title="node-meta"></a>node-meta</h3><p>ç»™è¯¥ç»“ç‚¹è®¾ç½®å…ƒæ•°æ®ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-node-meta=&lt;key:value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="non-voting-server"><a href="#non-voting-server" class="headerlink" title="non-voting-server"></a>non-voting-server</h3><p>è¯¥é€‰é¡¹ä½¿è¯¥Serverä¸å‚äºRaftåè®®çš„é€‰ä¸¾æµç¨‹ï¼Œä»…ä»…è¿›è¡Œæ•°æ®åŒæ­¥ã€‚è¿™æ ·è§’è‰²çš„ç»“ç‚¹ä¸»è¦ç”¨æ¥æ‰©å±•consulé›†ç¾¤çš„è¯»èƒ½åŠ›ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-non-voting-server</span>
</pre></td></tr></table></figure>
<h3 id="pid-file"><a href="#pid-file" class="headerlink" title="pid-file"></a>pid-file</h3><p>æŒ‡å®šä¿å­˜pidçš„æ–‡ä»¶è·¯å¾„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-pid-file=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="protocol"><a href="#protocol" class="headerlink" title="protocol"></a>protocol</h3><p>è®¾ç½®åè®®ç‰ˆæœ¬ã€‚é»˜è®¤ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-protocol=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="raft-protocol"><a href="#raft-protocol" class="headerlink" title="raft-protocol"></a>raft-protocol</h3><p>è®¾ç½®Raftåè®®çš„ç‰ˆæœ¬ã€‚é»˜è®¤ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-raft-protocol=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="recursor"><a href="#recursor" class="headerlink" title="recursor"></a>recursor</h3><p>ä¸Šæ¸¸DNSæœåŠ¡å™¨çš„åœ°å€ã€‚å¯ä»¥å¤šæ¬¡ä½¿ç”¨ï¼ŒæŒ‡å®šå¤šä¸ªåœ°å€ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-recursor=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="rejoin"><a href="#rejoin" class="headerlink" title="rejoin"></a>rejoin</h3><p>å¿½ç•¥ä¸Šæ¬¡çš„ç¦»å¼€ï¼Œå¹¶å°è¯•ä»æ–°åŠ å…¥é›†ç¾¤ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-rejoin</span>
</pre></td></tr></table></figure>
<h3 id="retry-interval"><a href="#retry-interval" class="headerlink" title="retry-interval"></a>retry-interval</h3><p>æ¯æ¬¡å°è¯•é‡è¯•åŠ å…¥é›†ç¾¤çš„é‡è¯•æ—¶é—´é—´éš”ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-retry-interval=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="retry-interval-wan"><a href="#retry-interval-wan" class="headerlink" title="retry-interval-wan"></a>retry-interval-wan</h3><p>åŒæ ·ç”¨æ¥æŒ‡å®šåŠ å…¥é›†ç¾¤çš„é‡è¯•æ—¶é—´é—´éš”ï¼Œä¸è¿‡é’ˆå¯¹çš„å¹¿åŸŸç½‘ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-retry-interval-wan=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="retry-join"><a href="#retry-join" class="headerlink" title="retry-join"></a>retry-join</h3><p>Address of an agent to join at start time with retries enabled. Can<br>be specified multiple times.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-retry-join=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="retry-join-wan"><a href="#retry-join-wan" class="headerlink" title="retry-join-wan"></a>retry-join-wan</h3><p>Address of an agent to join -wan at start time with retries<br>enabled. Can be specified multiple times.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-retry-join-wan=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="retry-max"><a href="#retry-max" class="headerlink" title="retry-max"></a>retry-max</h3><p>è®¾ç½®é‡è¯•çš„æœ€å¤§æ¬¡æ•°ã€‚é»˜è®¤å€¼æ˜¯<code>0</code>, æ„å‘³ç€ä¸€ç›´è¿›è¡Œå°è¯•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-retry-max=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="retry-max-wan"><a href="#retry-max-wan" class="headerlink" title="retry-max-wan"></a>retry-max-wan</h3><p>è®¾ç½®é‡è¯•çš„æœ€å¤§æ¬¡æ•°ã€‚é’ˆå¯¹çš„æ˜¯å¹¿åŸŸç½‘ã€‚é»˜è®¤å€¼æ˜¯<code>0</code>, æ„å‘³ç€ä¸€ç›´è¿›è¡Œå°è¯•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-retry-max-wan=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="segment"><a href="#segment" class="headerlink" title="segment"></a>segment</h3><p>(ä¼ä¸šçº§ç‰ˆæœ¬æ‰æœ‰çš„åŠŸèƒ½) è®¾ç½®åŠ å…¥çš„ç½‘ç»œæ®µã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-segment=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="serf-lan-bind"><a href="#serf-lan-bind" class="headerlink" title="serf-lan-bind"></a>serf-lan-bind</h3><p>Address to bind Serf LAN listeners to.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-serf-lan-bind=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="serf-wan-bind"><a href="#serf-wan-bind" class="headerlink" title="serf-wan-bind"></a>serf-wan-bind</h3><p>Address to bind Serf WAN listeners to.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-serf-wan-bind=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="server"><a href="#server" class="headerlink" title="-server"></a>-server</h3><p>ä»¥<code>server</code>æ¨¡å¼å¯åŠ¨ï¼Œé»˜è®¤æ˜¯<code>client</code></p>
<h3 id="syslog"><a href="#syslog" class="headerlink" title="syslog"></a>syslog</h3><p>å°†æ—¥å¿—è¾“å‡ºåˆ°syslog.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-syslog</span>
</pre></td></tr></table></figure>
<h3 id="ui"><a href="#ui" class="headerlink" title="ui"></a>ui</h3><p>å¯ç”¨consulå†…ç½®çš„é™æ€wei UIæœåŠ¡å™¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-ui</span>
</pre></td></tr></table></figure>
<h3 id="ui-dir"><a href="#ui-dir" class="headerlink" title="ui-dir"></a>ui-dir</h3><p>æŒ‡å®šåŒ…å«webç•Œé¢çš„èµ„æºç›®å½•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-ui-dir=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h2 id="catalog"><a href="#catalog" class="headerlink" title="catalog"></a>catalog</h2><p>æ­¤å‘½ä»¤å…·æœ‰ä¸Consulç›®å½•äº¤äº’çš„å­å‘½ä»¤ã€‚è¯¥ç›®å½•ä¸åº”ä¸ä»£ç†æ··æ·†ï¼Œå°½ç®¡APIå’Œå›åº”å¯èƒ½ç±»ä¼¼ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›ç®€å•ç¤ºä¾‹ï¼Œå¹¶æä¾›äº†æ›´è¯¦ç»†çš„ç¤ºä¾‹åœ¨å­å‘½ä»¤æˆ–æ–‡æ¡£ä¸­ã€‚</p>
<p>åˆ—å‡ºæ‰€æœ‰æ•°æ®ä¸­å¿ƒ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">$ consul catalog datacenters</span>
</pre></td></tr></table></figure>
<p>åˆ—å‡ºæ‰€æœ‰ç»“ç‚¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">$ consul catalog nodes</span>
</pre></td></tr></table></figure>
<p>åˆ—å‡ºæ‰€æœ‰æœåŠ¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">$ consul catalog services</span>
</pre></td></tr></table></figure>
<h2 id="event"><a href="#event" class="headerlink" title="event"></a>event</h2><p>è·¨æ•°æ®ä¸­å¿ƒå‘å¸ƒè‡ªå®šä¹‰ç”¨æˆ·äº‹ä»¶ã€‚ å¿…é¡»æä¾›äº‹ä»¶åç§°ï¼Œä½†äº‹ä»¶çš„å†…å®¹æ˜¯å¯é€‰çš„ã€‚ </p>
<p>æ”¯æŒé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ï¼ŒèŠ‚ç‚¹åç§°ï¼ŒæœåŠ¡åç§°ï¼Œæˆ–æ ‡ç­¾è¿›è¡Œè¿‡æ»¤ã€‚</p>
<h3 id="name"><a href="#name" class="headerlink" title="name"></a>name</h3><p>äº‹ä»¶çš„åç§°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-name=&lt;string&gt;</span>
</pre></td></tr></table></figure>
<h3 id="node-1"><a href="#node-1" class="headerlink" title="node"></a>node</h3><p>ç”¨æ¥æŒ‡å®šé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤çš„èŠ‚ç‚¹åç§°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-node=&lt;string&gt;</span>
</pre></td></tr></table></figure>
<h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><p>ç”¨æ¥æŒ‡å®šé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤çš„æœåŠ¡åç§°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-service=&lt;string&gt;</span>
</pre></td></tr></table></figure>
<h3 id="tag"><a href="#tag" class="headerlink" title="tag"></a>tag</h3><p>ç”¨æ¥æŒ‡å®šé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤çš„æœåŠ¡çš„æ ‡ç­¾åç§°ã€‚å¿…é¡»å’Œ<code>-service</code>é€‰é¡¹ä¸€èµ·ä½¿ç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-tag=&lt;string&gt;</span>
</pre></td></tr></table></figure>
<h2 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h2><p>åœ¨è¿œç¨‹ConsulèŠ‚ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚ èŠ‚ç‚¹çš„å“åº”å†…å®¹å¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œè¿‡æ»¤ã€‚</p>
<p>å¯ç”¨çš„é€‰é¡¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
</pre></td><td class="code"><pre><span class="line">-node=&lt;string&gt;</span>
<span class="line"></span>
<span class="line">Regular expression to filter on node names.</span>
<span class="line"></span>
<span class="line">-prefix=&lt;string&gt;</span>
<span class="line"></span>
<span class="line">Prefix in the KV store to use for request data.</span>
<span class="line"></span>
<span class="line">-service=&lt;string&gt;</span>
<span class="line"></span>
<span class="line">Regular expression to filter on service instances.</span>
<span class="line"></span>
<span class="line">-shell</span>
<span class="line"></span>
<span class="line">Use a shell to run the command.</span>
<span class="line"></span>
<span class="line">-tag=&lt;string&gt;</span>
<span class="line"></span>
<span class="line">Regular expression to filter on service tags. Must be used with</span>
<span class="line">-service.</span>
<span class="line"></span>
<span class="line">-verbose</span>
<span class="line"></span>
<span class="line">Enables verbose output.</span>
<span class="line"></span>
<span class="line">-wait=&lt;duration&gt;</span>
<span class="line"></span>
<span class="line">Period to wait with no responses before terminating execution.</span>
<span class="line"></span>
<span class="line">-wait-repl=&lt;duration&gt;</span>
<span class="line"></span>
<span class="line">Period to wait for replication before firing event. This is an</span>
<span class="line">optimization to allow stale reads to be performed.</span>
</pre></td></tr></table></figure>
<h2 id="leave"><a href="#leave" class="headerlink" title="leave"></a>leave</h2><p>å°†ä¸€ä¸ªç»“ç‚¹ä¼˜é›…è¿›å…¥<code>leave</code>çŠ¶æ€ï¼Œå¹¶å…³é—­ã€‚</p>
<h2 id="force-leave"><a href="#force-leave" class="headerlink" title="force-leave"></a>force-leave</h2><p>å¼ºåˆ¶ä¸€ä¸ªé›†ç¾¤çš„èŠ‚ç‚¹è¿›å…¥<code>left</code>çŠ¶æ€ã€‚</p>
<h2 id="info"><a href="#info" class="headerlink" title="info"></a>info</h2><p>æä¾›æ“ä½œå‘½ä»¤çš„è°ƒè¯•ä¿¡æ¯ã€‚</p>
<h2 id="join-1"><a href="#join-1" class="headerlink" title="join"></a>join</h2><p>ä½¿ä¸€ä¸ªè¿è¡Œä¸­çš„agentåŠ å…¥åˆ°é›†ç¾¤ä¸­ã€‚</p>
<h3 id="wan"><a href="#wan" class="headerlink" title="wan"></a>wan</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-wan</span>
</pre></td></tr></table></figure>
<h2 id="keygen"><a href="#keygen" class="headerlink" title="keygen"></a>keygen</h2><p>ç”Ÿæˆä¸€ä¸ªæ–°çš„åŠ å¯†ç”¨çš„keyï¼Œç”¨æ¥ä¾›agentå¯¹ç½‘ç»œæµé‡å°±è¡ŒåŠ å¯†ã€‚  </p>
<h2 id="keyring"><a href="#keyring" class="headerlink" title="keyring"></a>keyring</h2><p>ç®¡ç†ç”¨æ¥åŠ å¯†<code>gossip</code>æ¶ˆæ¯çš„ç§˜é’¥ã€‚<code>Gossip</code>åŠ å¯†æ˜¯å¯ä»¥é€‰çš„ã€‚å½“å¯ç”¨<code>Gossip</code>åŠ å¯†ï¼Œè¯¥å‘½ä»¤å¯ä»¥ç”¨æ¥æ£€æŸ¥é›†ç¾¤ä¸­å¤„äºæ¿€æ´»çŠ¶æ€ä¸‹çš„åŠ å¯†keyï¼Œæ·»åŠ æ–°çš„keyï¼Œåˆ é™¤è€çš„keyã€‚æŠŠè¿™äº›åŠŸèƒ½ç»“åˆèµ·æ¥ï¼Œå°±å¯ä»¥å®ç°ä¸ç ´åé›†ç¾¤çš„å‰æä¸‹ï¼Œæ›´æ–°åŠ å¯†ç§˜é’¥çš„åŠŸèƒ½ã€‚</p>
<p>è¯¥å‘½ä»¤æä¾›çš„æ‰€æœ‰æ“ä½œéƒ½åªèƒ½åœ¨<code>Server</code>æ¨¡å¼çš„ç»“ç‚¹ä¸Šæ‰§è¡Œï¼Œ å¹¶ä¸”å½±å“èŒƒå›´åŒ…æ‹¬<code>LAN</code>å’Œ<code>WAN</code>ã€‚</p>
<p>å½“æ‰€æœ‰ç»“ç‚¹æ­£ç¡®è¿”å›æ—¶ï¼Œè¯¥å‘½ä»¤è¾“å‡º:0, å¦åˆ™å…¶ä»–ä»»ä½•æƒ…å†µéƒ½è¾“å‡º1ã€‚</p>
<p>è¯¥å‘½ä»¤çš„é€‰é¡¹å¦‚ä¸‹ï¼š</p>
<h3 id="install"><a href="#install" class="headerlink" title="install"></a>install</h3><p>å®‰è£…ä¸€ä¸ªæ–°çš„ç§˜é’¥ï¼Œå¹¶å¹¿æ’­åˆ°é›†ç¾¤çš„æ‰€æœ‰ç»“ç‚¹ä¸­ã€‚ç§˜é’¥çš„æ ¼å¼æ˜¯base64çš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-install=&lt;string&gt;</span>
</pre></td></tr></table></figure>
<h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><p>åˆ—å‡ºæ‰€æœ‰æ­£åœ¨é›†ç¾¤ä¸­ä½¿ç”¨çš„ç§˜é’¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-list</span>
</pre></td></tr></table></figure>
<h3 id="relay-factor"><a href="#relay-factor" class="headerlink" title="relay-factor"></a>relay-factor</h3><p>Setting this to a non-zero value will cause nodes to relay their<br>response to the operation through this many randomly-chosen other<br>nodes in the cluster. The maximum allowed value is 5.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-relay-factor=&lt;int&gt;</span>
</pre></td></tr></table></figure>
<h3 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h3><p>ä»é›†ç¾¤ä¸­åˆ é™¤ç§˜é’¥ã€‚ è¯¥æ“ä½œåªèƒ½é’ˆå¯¹å“ªäº›å½“å‰ä¸æ˜¯ä¸»ç§˜é’¥çš„ç§˜é’¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-remove=&lt;string&gt;</span>
</pre></td></tr></table></figure>
<h3 id="use"><a href="#use" class="headerlink" title="use"></a>use</h3><p>Change the primary encryption key, which is used to encrypt<br>messages. The key must already be installed before this operation<br>can succeed.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-use=&lt;string&gt;</span>
</pre></td></tr></table></figure>
<h2 id="kv"><a href="#kv" class="headerlink" title="kv"></a>kv</h2><p>è¯¥å‘½ä»¤åŒ…å«ä¸€äº›æ“ä½œConsul K-V å­˜å‚¨çš„å­å‘½ä»¤ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€äº›ç®€å•çš„ä¾‹å­ï¼š</p>
<p>åˆ›å»ºæˆ–æ›´æ–°ä¸€ä¸ªåç§°ä¸º<code>redis/config/connections</code>ï¼Œå€¼ä¸º5çš„é”®å€¼å¯¹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">$ consul kv put redis/config/connections 5</span>
</pre></td></tr></table></figure>
<p>è·å–è¯¥é”®å€¼å¯¹çš„å€¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">$ consul kv get redis/config/connections</span>
</pre></td></tr></table></figure>
<p>è·å–è¯¥é”®å€¼å¯¹çš„è¯¦ç»†ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">$ consul kv get -detailed redis/config/connections</span>
</pre></td></tr></table></figure>
<p>åˆ é™¤è¯¥é”®å€¼å¯¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">$ consul kv delete redis/config/connections</span>
</pre></td></tr></table></figure>
<h3 id="å­å‘½ä»¤"><a href="#å­å‘½ä»¤" class="headerlink" title="å­å‘½ä»¤"></a>å­å‘½ä»¤</h3><p>delete    Removes data from the KV store<br>export    Exports a tree from the KV store as JSON<br>get       Retrieves or lists data from the KV store<br>import    Imports a tree stored as JSON to the KV store<br>put       Sets or updates data in the KV store</p>
<h2 id="lock"><a href="#lock" class="headerlink" title="lock"></a>lock</h2><p>Acquires a lock or semaphore at a given path, and invokes a child process<br>when successful. The child process can assume the lock is held while it<br>executes. If the lock is lost or communication is disrupted the child<br>process will be sent a SIGTERM signal and given time to gracefully exit.<br>After the grace period expires the process will be hard terminated.</p>
<p>For Consul agents on Windows, the child process is always hard terminated<br>with a SIGKILL, since Windows has no POSIX compatible notion for SIGTERM.</p>
<p>When -n=1, only a single lock holder or leader exists providing mutual<br>exclusion. Setting a higher value switches to a semaphore allowing multiple<br>holders to coordinate.</p>
<p>The prefix provided must have write privileges.</p>
<h2 id="maint"><a href="#maint" class="headerlink" title="maint"></a>maint</h2><p>è¯¥å‘½ä»¤çš„ä½œç”¨æ˜¯å°†èŠ‚ç‚¹æˆ–æœåŠ¡ç½®äºç»´æŠ¤æ¨¡å¼ã€‚åœ¨ç»´æŠ¤æ¨¡å¼ä¸‹ï¼Œæ— è®ºé€šè¿‡DNSæŸ¥è¯¢è¿˜æ˜¯HTTPæ¥å£ï¼Œéƒ½ä¸å†è¿”å›èŠ‚ç‚¹æˆ–æœåŠ¡çš„ä¿¡æ¯ã€‚å‘½ä»¤æœ‰æ•ˆåœ°å°†å…¶ä»å¯ç”¨æ± ä¸­å–å‡ºèŠ‚ç‚¹ã€‚è¯¥å‘½ä»¤çš„æ‰§è¡ŒåŸç†æ˜¯é€šè¿‡æ³¨å†ŒèŠ‚ç‚¹æˆ–æœåŠ¡çš„å¥åº·æ£€æŸ¥æ¥å®Œæˆçš„ã€‚</p>
<p>ä¸ºèŠ‚ç‚¹æˆ–æœåŠ¡å¯ç”¨ç»´æŠ¤æ¨¡å¼æ—¶ï¼Œä½ å¯ä»¥é€‰æ‹©æŒ‡å®šä¸€ä¸ªå­—ç¬¦ä¸²æ¥è¡¨æ˜åŸå› ã€‚è¯¥å­—ç¬¦ä¸²å°†å‡ºç°åœ¨â€œNotesâ€å­—æ®µä¸­<br>å¯¹èŠ‚ç‚¹æˆ–æ³¨å†Œçš„é‡è¦å¥åº·æ£€æŸ¥æœåŠ¡ã€‚å¦‚æœæ²¡æœ‰æä¾›åŸå› ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼ã€‚</p>
<p>ç»´æŠ¤æ¨¡å¼æ˜¯æŒä¹…çš„ï¼Œå¹¶ä¸”ä¼šåœ¨agenté‡å¯å¯åŠ¨çš„æ—¶å€™æ¢å¤ã€‚ å› æ­¤ï¼Œåœ¨å°†ç»™å®šèŠ‚ç‚¹æˆ–æœåŠ¡å°†è¢«æ”¾å›å¯ä»¥æ± ä¸­ä¹‹å‰éœ€è¦ç¦ç”¨ç»´æŠ¤æ¨¡å¼ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œæ“ä½œã€‚é€šè¿‡æŒ‡å®š<code>-service</code>å‚æ•°ï¼Œå¯ä»¥æ“ä½œå…·ä½“çš„æœåŠ¡ã€‚</p>
<p>å¦‚æœæ²¡æœ‰ç»™å‡ºå‚æ•°ï¼Œå°†æ˜¾ç¤ºagentçš„ç»´æŠ¤çŠ¶æ€ã€‚å¦‚æœå½“å‰æ²¡æœ‰ä»»ä½•ç»´æŠ¤ï¼Œåˆ™è¿”å›ç©ºç™½ã€‚</p>
<h3 id="disable"><a href="#disable" class="headerlink" title="disable"></a>disable</h3><p>ç¦ç”¨ç»´æŠ¤æ¨¡å¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-disable</span>
</pre></td></tr></table></figure>
<h3 id="enable"><a href="#enable" class="headerlink" title="enable"></a>enable</h3><p>å¯ç”¨ç»´æŠ¤æ¨¡å¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-enable</span>
</pre></td></tr></table></figure>
<h3 id="reason"><a href="#reason" class="headerlink" title="reason"></a>reason</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-reason=&lt;string&gt;</span>
</pre></td></tr></table></figure>
<p>æŒ‡å®šæœ¬æ¬¡æ“ä½œçš„åŸå› æè¿°ä¿¡æ¯</p>
<h3 id="service-1"><a href="#service-1" class="headerlink" title="service"></a>service</h3><p>æŒ‡å®šæ“ä½œçš„æœåŠ¡IDã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-service=&lt;string&gt;</span>
</pre></td></tr></table></figure>
<h2 id="members"><a href="#members" class="headerlink" title="members"></a>members</h2><p>è¯¥å‘½ä»¤çš„ä½œç”¨æ˜¯ï¼šè¾“å‡ºé›†ç¾¤æˆå‘˜ä¿¡æ¯</p>
<p>å¯ç”¨çš„å‚æ•°æœ‰ï¼š</p>
<h3 id="detailed"><a href="#detailed" class="headerlink" title="-detailed"></a>-detailed</h3><p>è¾“å‡ºæ›´è¯¦ç»†çš„èŠ‚ç‚¹ä¿¡æ¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
</pre></td><td class="code"><pre><span class="line">consul members -detailed</span>
<span class="line">Node   Address         Status  Tags</span>
<span class="line">bogon  127.0.0.1:8301  alive   build=1.0.2:b55059f,dc=dc1,id=fc1742c4-d97b-8a5b-ff3c-ab11941e2fea,port=8300,raft_vsn=3,role=consul,segment=&lt;all&gt;,vsn=2,vsn_max=3,vsn_min=2,wan_join_port=8302</span>
</pre></td></tr></table></figure>
<h3 id="segment-1"><a href="#segment-1" class="headerlink" title="segment"></a>segment</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-segment=&lt;string&gt;</span>
</pre></td></tr></table></figure>
<p>ä¼ä¸šçº§ç‰ˆæœ¬æ‰æœ‰çš„åŠŸèƒ½ã€‚ å¯ä»¥åªè¾“å‡ºæ‰€å±segmentçš„ç»“ç‚¹ä¿¡æ¯ã€‚</p>
<h3 id="status"><a href="#status" class="headerlink" title="status"></a>status</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-status=&lt;string&gt;</span>
</pre></td></tr></table></figure>
<p>æ ¹æ®çŠ¶æ€è¿›è¡Œè¿‡æ»¤éœ€è¦è¾“å‡ºçš„ç»“ç‚¹ã€‚</p>
<h3 id="wan-1"><a href="#wan-1" class="headerlink" title="wan"></a>wan</h3><p>å¦‚æœagentå…è®¸åœ¨serveræ¨¡å¼ä¸‹ï¼Œè¯¥é€‰é¡¹å¯ä»¥è¾“å‡ºå…¶å®ƒåœ¨<code>WAN</code>å¹¿åŸŸç½‘çš„èŠ‚ç‚¹ä¿¡æ¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-wan</span>
</pre></td></tr></table></figure>
<h2 id="monitor"><a href="#monitor" class="headerlink" title="monitor"></a>monitor</h2><p>æ˜¾ç¤ºConsul agent çš„æœ€è¿‘æ—¥å¿—æ¶ˆæ¯ï¼Œå¹¶è¿æ¥åˆ°agentï¼Œå®æ—¶è¾“å‡ºagentä¸Šæ—¥å¿—æ¶ˆæ¯ã€‚ è€Œä¸”å¯ä»¥é€šè¿‡å‚æ•°æ¥æŒ‡å®šéœ€è¦æŸ¥çœ‹çš„æ—¥å¿—çº§åˆ«ã€‚é»˜è®¤è¾“å‡ºçš„æ˜¯DEBUGçº§åˆ«çš„æ—¥å¿—ã€‚</p>
<h2 id="operator"><a href="#operator" class="headerlink" title="operator"></a>operator</h2><p>è¯¥å‘½ä»¤æä¾›äº†Consulé›†ç¾¤çº§åˆ«çš„æ“ä½œèƒ½åŠ›ï¼Œ åœ¨ä½¿ç”¨æ—¶éœ€è¦éå¸¸å°å¿ƒã€‚ä½¿ç”¨ä¸å½“æœ‰å¯èƒ½é€ æˆï¼ŒèŠ‚ç‚¹æ•°æ®è¿‡æœŸæˆ–æ•°æ®ä¸¢å¤±ã€‚</p>
<p>å­å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<h3 id="autopilot"><a href="#autopilot" class="headerlink" title="autopilot"></a>autopilot</h3><p><code>autopilot</code> å‘½ä»¤ç”¨äºä¸Consulçš„<code>autopilot</code>å­ç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚ è¯¥å‘½ä»¤å¯ç”¨äºæŸ¥çœ‹æˆ–ä¿®æ”¹å½“å‰é…ç½®ã€‚</p>
<h4 id="get-config"><a href="#get-config" class="headerlink" title="get-config"></a>get-config</h4><p>æ˜¾ç¤ºå½“å‰çš„è‡ªåŠ¨é©¾é©¶ä»ªé…ç½®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
</pre></td><td class="code"><pre><span class="line">consul operator autopilot get-config</span>
<span class="line">CleanupDeadServers = true</span>
<span class="line">LastContactThreshold = 200ms</span>
<span class="line">MaxTrailingLogs = 250</span>
<span class="line">ServerStabilizationTime = 10s</span>
<span class="line">RedundancyZoneTag = &quot;&quot;</span>
<span class="line">DisableUpgradeMigration = false</span>
<span class="line">UpgradeVersionTag = &quot;&quot;</span>
</pre></td></tr></table></figure>
<h4 id="set-config"><a href="#set-config" class="headerlink" title="set-config"></a>set-config</h4><p>ä¿®æ”¹å½“å‰çš„è‡ªåŠ¨é©¾é©¶ä»ªé…ç½®</p>
<h3 id="raft"><a href="#raft" class="headerlink" title="raft"></a>raft</h3><h4 id="list-peers"><a href="#list-peers" class="headerlink" title="list-peers"></a>list-peers</h4><p>Display the current Raft peer configuration</p>
<h4 id="remove-peer"><a href="#remove-peer" class="headerlink" title="remove-peer"></a>remove-peer</h4><p>Remove a Consul server from the Raft configuration</p>
<h2 id="reload"><a href="#reload" class="headerlink" title="reload"></a>reload</h2><p>è¯¥å‘½ä»¤çš„ä½œç”¨æ˜¯é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œä»¥æ­¤æ¥æ›¿ä»£<code>SIGHUP</code>ä¿¡å·ã€‚</p>
<h2 id="rtt"><a href="#rtt" class="headerlink" title="rtt"></a>rtt</h2><p><code>rtt</code>å‘½ä»¤çš„ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">Usage: consul rtt [options] node1 [node2]</span>
</pre></td></tr></table></figure>
<p>è¯¥å‘½ä»¤çš„ä½œç”¨æ˜¯ï¼šé¢„ä¼°2ä¸ªç»“ç‚¹é—´ä¸€æ¬¡é€šä¿¡çš„è€—æ—¶çŠ¶å†µçš„ã€‚è‡³å°‘éœ€è¦æä¾›ä¸€ä¸ªèŠ‚ç‚¹åç§°ã€‚å¦‚æœåªæä¾›äº†ä¸€ä¸ªèŠ‚ç‚¹çš„åç§°ï¼Œ<br>åˆ™ç¬¬äºŒä¸ªç»“ç‚¹çš„åç§°é»˜è®¤å°±æ˜¯agentæ‰€åœ¨çš„ç»“ç‚¹åç§°ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¿™äº›èŠ‚ç‚¹åç§°å’Œ<code>consul members</code>è¾“å‡ºä¸­çš„ç»“ç‚¹åç§°ç›¸åŒï¼Œä¸æ˜¯ä¸€ä¸ªIPåœ°å€ã€‚</p>
</blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯å‡è®¾2ä¸ªèŠ‚ç‚¹åœ¨åŒä¸€ä¸ªæ•°æ®ä¸­å¿ƒå†…ï¼Œå¹¶ä½¿ç”¨å±€åŸŸç½‘çš„ç½‘ç»œåè°ƒå™¨ã€‚å¦‚æœæœ‰<code>-wan</code>å‚æ•°ï¼Œé‚£ä¹ˆä½¿ç”¨æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">consul rtt -wan bogon.dc1</span>
<span class="line">Estimated bogon.dc1 &lt;-&gt; bogon.dc1 rtt: 0.020 ms (using WAN coordinates)</span>
</pre></td></tr></table></figure>
<p>èŠ‚ç‚¹çš„åç§°åé¢éœ€è¦æ·»åŠ æ‰€å±æ•°æ®ä¸­å¿ƒçš„åç§°ã€‚</p>
<p>è¯¥å‘½ä»¤ä¸èƒ½ç”¨æ¥æµ‹é‡å±€åŸŸç½‘å’Œå¹¿åŸŸç½‘2ä¸ªèŠ‚ç‚¹é—´çš„ç½‘ç»œé€šä¿¡è€—æ—¶ï¼Œå› ä¸ºä»–ä»¬ä½äºä¸åŒçš„<code>gossip</code>åŸŸã€‚</p>
<p>è¯¥å‘½ä»¤å¯ä»¥ä½¿ç”¨çš„å‚æ•°å¦‚ä¸‹ï¼š</p>
<h3 id="ca-file"><a href="#ca-file" class="headerlink" title="ca-file"></a>ca-file</h3><p>æŒ‡å®šTLSé€šä¿¡æ˜¯ä½¿ç”¨çš„<code>CA</code>æ–‡ä»¶ã€‚ è¯¥é€‰é¡¹çš„å€¼ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡<code>CONSUL_CACERT</code>çš„å€¼è·å–ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-ca-file=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="ca-path"><a href="#ca-path" class="headerlink" title="ca-path"></a>ca-path</h3><p>æŒ‡å®šTLSé€šä¿¡æ˜¯ä½¿ç”¨çš„<code>CA</code>æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚ è¯¥é€‰é¡¹çš„å€¼ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡<code>CONSUL_CAPATH</code>çš„å€¼è·å–ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-ca-path=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="client-cert"><a href="#client-cert" class="headerlink" title="client-cert"></a>client-cert</h3><p>æŒ‡å®šåœ¨ä½¿ç”¨TLSè¿›è¡Œé€šä¿¡æ—¶ï¼Œå¹¶ä¸”å¯ç”¨äº†<code>verify_incoming</code>åŠŸèƒ½æ—¶ï¼Œå®¢æˆ·ç«¯æ‰€ä½¿ç”¨çš„è¯ä¹¦æ–‡ä»¶ï¼Œ<br>ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡<code>CONSUL_CLIENT_CERT</code> æ¥æŒ‡å®šã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-client-cert=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="client-key"><a href="#client-key" class="headerlink" title="client-key"></a>client-key</h3><p>æŒ‡å®šåœ¨ä½¿ç”¨TLSè¿›è¡Œé€šä¿¡æ—¶ï¼Œå¹¶ä¸”å¯ç”¨äº†<code>verify_incoming</code>åŠŸèƒ½æ—¶ï¼Œå®¢æˆ·ç«¯æ‰€ä½¿ç”¨çš„keyæ–‡ä»¶ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡<code>CONSUL_CLIENT_KEY</code> æ¥æŒ‡å®šã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-client-key=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="http-addr"><a href="#http-addr" class="headerlink" title="http-addr"></a>http-addr</h3><p>æŒ‡å®šæä¾›httpæœåŠ¡çš„Consul agent çš„IPåœ°å€å’Œç«¯å£å·ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡<code>CONSUL_HTTP_ADDR</code>çš„å€¼æ¥æŒ‡å®šã€‚</p>
<p>é»˜è®¤çš„å€¼æ˜¯ï¼š<code>http://127.0.0.1:8500</code>ã€‚ ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡<code>CONSUL_HTTP_SSL=true</code>æ¥å¯ç”¨httpsè¿›è¡Œé€šä¿¡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-http-addr=&lt;address&gt;</span>
</pre></td></tr></table></figure>
<h3 id="tls-server-name"><a href="#tls-server-name" class="headerlink" title="tls-server-name"></a>tls-server-name</h3><p>æŒ‡å®šå½“é€šè¿‡TLSè¿›è¡Œé€šä¿¡æ—¶ä½œä¸º<code>SNI</code>ä¸»æœºçš„æœåŠ¡å™¨åç§°ã€‚ä¹Ÿå¯ä»¥é€šè¿‡<code>CONSUL_TLS_SERVER_NAME</code>ç¯å¢ƒå˜é‡æ¥æŒ‡å®šã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-tls-server-name=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<h3 id="token"><a href="#token" class="headerlink" title="token"></a>token</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-token=&lt;value&gt;</span>
</pre></td></tr></table></figure>
<p>æŒ‡å®šè¯·æ±‚ä¸­ä½¿ç”¨çš„ACL tokençš„å€¼ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡<code>CONSUL_HTTP_TOKEN</code>æ¥æŒ‡å®šã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä½¿ç”¨é€šè¿‡http è®¿é—®Consul agent æ‰€ä½¿ç”¨çš„tokenå€¼ã€‚</p>
<h3 id="wan-2"><a href="#wan-2" class="headerlink" title="wan"></a>wan</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">-wan</span>
</pre></td></tr></table></figure>
<p>ä½¿ç”¨å¹¿åŸŸç½‘åè°ƒå™¨æ¥æ›¿ä»£å±€åŸŸç½‘åè°ƒå™¨ã€‚</p>
<h2 id="snapshot"><a href="#snapshot" class="headerlink" title="snapshot"></a>snapshot</h2><p>è¯¥å‘½ä»¤åŒ…å«ä¸€äº›å­å‘½ä»¤ï¼Œä½œç”¨æ˜¯ä¿å­˜ï¼Œé‡æ–°åŠ è½½ æˆ–åœ¨æ•…éšœæ¢å¤æ—¶æ£€æŸ¥ Consul Server çš„çŠ¶æ€ã€‚</p>
<p>è¿™äº›æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼Œä¿å­˜å½“å‰æ—¶é—´ç‚¹ åŒ…æ‹¬<code>é”®/å€¼æ¡ç›®</code>ï¼Œ<code>æœåŠ¡ç›®å½•</code>ï¼Œ<code>å‡†å¤‡å¥½çš„æŸ¥è¯¢</code>ï¼Œ<code>ä¼šè¯å’ŒACL</code>ä¿¡æ¯çš„å¿«ç…§ã€‚</p>
<p>å¦‚æœå¯ç”¨äº†<code>ACLS</code>åŠŸèƒ½ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨è¿™äº›å­å‘½ä»¤æ—¶ï¼Œéœ€è¦æä¾›ç®¡ç†tokenæ¥è¿›è¡Œå¿«ç…§çš„æ“ä½œã€‚</p>
<h3 id="åˆ›å»ºä¸€ä¸ªå¿«ç…§"><a href="#åˆ›å»ºä¸€ä¸ªå¿«ç…§" class="headerlink" title="åˆ›å»ºä¸€ä¸ªå¿«ç…§"></a>åˆ›å»ºä¸€ä¸ªå¿«ç…§</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
</pre></td><td class="code"><pre><span class="line">$ consul snapshot save backup.snap</span>
<span class="line">```      </span>
<span class="line"></span>
<span class="line">### ä»å¿«ç…§ä¸­æ¢å¤</span>
</pre></td></tr></table></figure>
<p>$ consul snapshot restore backup.snap<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
</pre></td><td class="code"><pre><span class="line"></span>
<span class="line">å…ˆå¯åŠ¨ä¸€ä¸ªæ²¡æœ‰ä»»ä½•æ•°æ®çš„agent,ç„¶åæ‰§è¡Œè¯¥å‘½ä»¤ï¼ŒåŠ è½½æŒ‡å®šçš„å¿«ç…§ä¿¡æ¯ã€‚</span>
<span class="line"></span>
<span class="line">### æ£€æŸ¥å¿«ç…§ä¿¡æ¯</span>
</pre></td></tr></table></figure></p>
<p>$ consul snapshot inspect backup.snap<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line"></span>
<span class="line">è¾“å‡ºï¼š</span>
</pre></td></tr></table></figure></p>
<p>leo@bogon consul snapshot inspect a.snap<br>ID           2-110-1532832078752<br>Size         1175<br>Index        110<br>Term         2<br>Version      1<br>```</p>
<p>å¯ä»¥å…è®¸ä¸€ä¸ªConsul agent, æ¯å°æ—¶ä¿å­˜ä¸€æ¬¡å¿«ç…§ä¿¡æ¯ã€‚ ä¸è¿‡è¯¥åŠŸèƒ½åªæœ‰ä¼ä¸šçº§ç‰ˆæœ¬æ‰æœ‰ã€‚</p>
<h2 id="validate"><a href="#validate" class="headerlink" title="validate"></a>validate</h2><p>æ ¡éªŒconsulé…ç½®æ–‡ä»¶ï¼Œæˆ–é…ç½®æ–‡ä»¶ç›®å½•ä¸‹é…ç½®æ–‡ä»¶çš„æ­£ç¡®æ€§</p>
<h2 id="version"><a href="#version" class="headerlink" title="version"></a>version</h2><p>æ‰“å°consulçš„ç‰ˆæœ¬</p>
<h2 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h2>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;consul-å‘½ä»¤ç”¨æ³•&quot;&gt;&lt;a href=&quot;#consul-å‘½ä»¤ç”¨æ³•&quot; class=&quot;headerlink&quot; title=&quot;consul å‘½ä»¤ç”¨æ³•&quot;&gt;&lt;/a&gt;consul å‘½ä»¤ç”¨æ³•&lt;/h2&gt;&lt;p&gt;å®‰è£…å®Œconsulåï¼Œé€šè¿‡åœ¨æ§åˆ¶å°ç›´æ¥å®ç°&lt;code&gt;consul&lt;/code&gt;å‘½ä»¤äº†è§£consulå‘½ä»¤è¡Œçš„ç”¨æ³•ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Usage: consul [--version] [--help] &amp;lt;command&amp;gt; [&amp;lt;args&amp;gt;]&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;Available commands are:&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;agent          Runs a Consul agent&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;catalog        Interact with the catalog&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;event          Fire a new event&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;exec           Executes a command on Consul nodes&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;force-leave    Forces a member of the cluster to enter the &amp;quot;left&amp;quot; state&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;info           Provides debugging information for operators.&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;join           Tell Consul agent to join cluster&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;keygen         Generates a new encryption key&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;keyring        Manages gossip layer encryption keys&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;kv             Interact with the key-value store&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;leave          Gracefully leaves the Consul cluster and shuts down&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;lock           Execute a command holding a lock&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;maint          Controls node or service maintenance mode&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;members        Lists the members of a Consul cluster&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;monitor        Stream logs from a Consul agent&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;operator       Provides cluster-level tools for Consul operators&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;reload         Triggers the agent to reload configuration files&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;rtt            Estimates network round trip time between nodes&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;snapshot       Saves, restores and inspects snapshots of Consul server state&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;validate       Validate config files/directories&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;version        Prints the Consul version&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;watch          Watch for changes in Consul&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å¦‚ä¸Šæ‰€ç¤ºï¼Œ consulæä¾›çš„å‘½ä»¤å¾ˆå¤šï¼Œä¸‹é¢å°±é€ä¸ªå­¦ä¹ ä¸‹æ¯ä¸ªå‘½ä»¤çš„ä½œç”¨å’Œç”¨æ³•ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="åˆ†å¸ƒå¼" scheme="https://leokongwq.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
      <category term="consul" scheme="https://leokongwq.github.io/tags/consul/"/>
    
  </entry>
  
  <entry>
    <title>servletå¦‚ä½•æ­£ç¡®å¤„ç†302è·³è½¬</title>
    <link href="https://leokongwq.github.io/2018/07/15/how-to-process-302-in-j2ee-correctly.html"/>
    <id>https://leokongwq.github.io/2018/07/15/how-to-process-302-in-j2ee-correctly.html</id>
    <published>2018-07-15T02:08:31.000Z</published>
    <updated>2018-11-03T04:40:32.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æŸå¤©ï¼Œå°†çº¿ä¸Šçš„resinå®¹å™¨æ›¿æ¢ä¸ºtomcatï¼ã€€è¿‡äº†ä¸€æ®µæ—¶é—´å‘ç°æœ‰ä¸ªæ¥å£å¤„ç†å¤±è´¥ï¼Œæç¤ºå¼‚å¸¸ï¼æŸ¥çœ‹åº”ç”¨æ—¥å¿—å‘ç°å¦‚ä¸‹çš„æ—¥å¿—ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
</pre></td><td class="code"><pre><span class="line">Caused by: javax.servlet.ServletException: java.lang.IllegalStateException: Cannot create a session after the response has been committed</span>
<span class="line">        at org.apache.jsp.WEB_002dINF.content.order.page.error_jsp._jspService(error_jsp.java:<span class="number">293</span>) ~[na:na]</span>
<span class="line">        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:<span class="number">70</span>) ~[jasper.jar:<span class="number">8.5</span>.12]</span>
<span class="line">        at javax.servlet.http.HttpServlet.service(HttpServlet.java:<span class="number">742</span>) ~[servlet-api.jar:na]</span>
<span class="line">        at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:<span class="number">443</span>) ~[jasper.jar:<span class="number">8.5</span>.12]</span>
<span class="line">        ... <span class="number">38</span> common frames omitted</span>
</pre></td></tr></table></figure>
<p>æŸ¥è¯¢ç›¸å…³æ¥å£çš„ä»£ç å‘ç°ï¼Œä»£ç å¯¹<code>302</code>è·³è½¬çš„é€»è¾‘å¤„ç†æœ‰é—®é¢˜ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
</pre></td><td class="code"><pre><span class="line"><span class="meta">@Actions</span>(value = &#123;</span>
<span class="line">            <span class="meta">@Action</span>(value = <span class="string">"dopay"</span>, results = &#123;<span class="meta">@Result</span>(name = ERROR, location = <span class="string">"/WEB-INF/content/order/page/error.jsp"</span>)&#125;),</span>
<span class="line">    &#125;)</span>
<span class="line">    <span class="meta">@ActionMonitor</span>(value = <span class="string">"pay.doPay"</span>)</span>
<span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">doPay</span><span class="params">()</span> </span>&#123;</span>
<span class="line">        <span class="comment">// çœç•¥ä»£ç </span></span>
<span class="line">        String _result = dealWapClient(params);</span>
<span class="line">        <span class="comment">// é—®é¢˜ä¹‹æ‰€åœ¨ï¼Œã€€å½“dealWapClientå¤„ç†æˆåŠŸæ—¶ï¼Œè¿”å›å€¼å°±æ˜¯null</span></span>
<span class="line">        <span class="comment">// æ­¤æ—¶ï¼Œè¿”å›ERRORï¼Œ Struts2ä¼šç»§ç»­æ‰§è¡Œï¼Œæ¸²æŸ“é”™è¯¯é¡µé¢(å®¢æˆ·ç«¯å°±èƒ½çœ‹åˆ°é”™è¯¯é¡µé¢äº†)</span></span>
<span class="line">        <span class="comment">// tomcat èƒ½çœ‹åˆ°ï¼Œã€€resinä¸‹çœ‹ä¸åˆ°ï¼ŒåŸå› ä¸‹é¢åˆ†æ</span></span>
<span class="line">        <span class="keyword">if</span> (_result == <span class="keyword">null</span>) &#123;</span>
<span class="line">            <span class="keyword">return</span> ERROR;</span>
<span class="line">        &#125;</span>
<span class="line">        <span class="comment">// çœç•¥ä»£ç </span></span>
<span class="line">    &#125;</span>
<span class="line"></span>
<span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">dealWapClient</span><span class="params">(Map&lt;String, String&gt; params)</span> </span>&#123;</span>
<span class="line">        <span class="comment">// çœç•¥ä»£ç </span></span>
<span class="line">        redirect(returnParams, returnUrl);</span>
<span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span>
<span class="line">        <span class="comment">// çœç•¥ä»£ç </span></span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h3 id="302è·³è½¬è§£é‡Š"><a href="#302è·³è½¬è§£é‡Š" class="headerlink" title="302è·³è½¬è§£é‡Š"></a>302è·³è½¬è§£é‡Š</h3><p>å…³äº302ä¸´æ—¶è·³è½¬çš„è¯¦ç»†è§£é‡Šå¯ä»¥å‚è€ƒ<a href="https://zh.wikipedia.org/wiki/HTTP_302" target="_blank" rel="external">HTTP_302</a>.<br>ä¹Ÿå¯ä»¥å‚è€ƒRFCè§„èŒƒ<a href="http://www.ietf.org/rfc/rfc3986.txt" target="_blank" rel="external">http://www.ietf.org/rfc/rfc3986.txt</a><br>å†æ¬¡å°±ä¸å†èµ˜è¿°ï¼</p>
<h3 id="servlet-apiå¯¹302å¤„ç†çš„è§„å®š"><a href="#servlet-apiå¯¹302å¤„ç†çš„è§„å®š" class="headerlink" title="servletã€€apiå¯¹302å¤„ç†çš„è§„å®š"></a>servletã€€apiå¯¹302å¤„ç†çš„è§„å®š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span>
<span class="line">* Sends a temporary redirect response to the client using the</span>
<span class="line">* specified redirect location URL and clears the buffer. The buffer will</span>
<span class="line">* be replaced with the data set by this method. Calling this method sets the</span>
<span class="line">* status code to &#123;<span class="doctag">@link</span> #SC_FOUND&#125; 302 (Found).</span>
<span class="line">* This method can accept relative URLs;the servlet container must convert</span>
<span class="line">* the relative URL to an absolute URL</span>
<span class="line">* before sending the response to the client. If the location is relative </span>
<span class="line">* without a leading '/' the container interprets it as relative to</span>
<span class="line">* the current request URI. If the location is relative with a leading</span>
<span class="line">* '/' the container interprets it as relative to the servlet container root.</span>
<span class="line">* If the location is relative with two leading '/' the container interprets</span>
<span class="line">* it as a network-path reference (see</span>
<span class="line">* &lt;a href="http://www.ietf.org/rfc/rfc3986.txt"&gt;</span>
<span class="line">* RFC 3986: Uniform Resource Identifier (URI): Generic Syntax&lt;/a&gt;, section 4.2</span>
<span class="line">* &amp;quot;Relative Reference&amp;quot;).</span>
<span class="line">*</span>
<span class="line">* &lt;p&gt;If the response has already been committed, this method throws </span>
<span class="line">* an IllegalStateException.</span>
<span class="line">* After using this method, the response should be considered</span>
<span class="line">* to be committed and should not be written to.</span>
<span class="line">*</span>
<span class="line">* <span class="doctag">@param</span>		location	the redirect location URL</span>
<span class="line">* <span class="doctag">@exception</span>	IOException	If an input or output exception occurs</span>
<span class="line">* <span class="doctag">@exception</span>	IllegalStateException	If the response was committed or</span>
<span class="line">*              if a partial URL is given and cannot be converted into a valid URL</span>
<span class="line">*/</span></span>
<span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendRedirect</span><span class="params">(String location)</span> <span class="keyword">throws</span> IOException</span>;</span>
</pre></td></tr></table></figure>
<blockquote>
<p>ç¿»è¯‘è¿‡æ¥æ„æ€å°±æ˜¯ï¼š é€šè¿‡è¯¥æ–¹æ³•å‘Šè¯‰å®¢æˆ·ç«¯ä¸´æ—¶é‡å®šå‘åˆ°ä¸€ä¸ªæŒ‡å®šçš„URLï¼Œå¹¶ä¸”æ¸…ç©ºç¼“å­˜åŒºï¼Œä¹‹å‰è¿˜æ²¡æœ‰å‘é€åˆ°å®¢æˆ·ç«¯çš„æ•°æ®ï¼<br>å¹¶ä½¿ç”¨è¯¥æ–¹æ³•è®¾ç½®çš„æ•°æ®å¡«å……ç¼“å­˜åŒºï¼<br>è¯¥æ–¹æ³•è®¾ç½®httpå“åº”çš„çŠ¶æ€ç ä¸º302.<br>å¦‚æœé‡å®šå‘çš„åœ°å€ä¸ºç›¸å¯¹åœ°å€ï¼Œè¯¥æ–¹æ³•å†…éƒ¨ä¼šå°†ç›¸å¯¹åœ°å€è½¬ä¸ºç»å¯¹åœ°å€ï¼ã€€<br>å¦‚æœresponseå·²ç»committedï¼Œå†æ¬¡è°ƒç”¨è¯¥æ–¹æ³•ä¼šæŠ›å‡º<code>IllegalStateException</code>å¼‚å¸¸.<br>è°ƒç”¨è¯¥æ–¹æ³•åï¼Œã€€responseå¯¹è±¡çš„çŠ¶æ€åº”è¯¥æ˜¯<code>committed</code>ï¼Œå¹¶ä¸”ä¸åº”è¯¥å†å†™å…¥æ•°æ®ï¼</p>
</blockquote>
<p>servlet-apiå·²ç»è¯¦ç»†è¯´æ˜äº†è¯¥æ–¹æ³•çš„ç”¨æ³•å’Œéœ€è¦æ³¨æ„çš„äº‹é¡¹ï¼ä½†æ˜¯ä¸åŒçš„servletå®¹å™¨åœ¨å®ç°æœºåˆ¶ä¸Šå¯èƒ½ä¸å°½ç›¸åŒï¼<br>é¡¹ç›®ä¸­å‘ç°çš„é—®é¢˜ä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼š</p>
<ol>
<li>ä»£ç æœ‰bugï¼è¿™ä¸ªæ˜¯ä¸»è¦åŸå› ï¼</li>
<li>servletå®¹å™¨å®ç°ä¸åŒï¼</li>
</ol>
<p>ä¸‹é¢å°±åˆ†æä¸‹è¯¥æ–¹æ³•åœ¨resinå’Œtomcatä¸­å®ç°çš„ç»†èŠ‚ï¼š</p>
<h3 id="resinå¯¹302çš„å¤„ç†"><a href="#resinå¯¹302çš„å¤„ç†" class="headerlink" title="resinå¯¹302çš„å¤„ç†"></a>resinå¯¹302çš„å¤„ç†</h3><p>åœ¨resinä¸­ï¼Œ<code>HttpServletResponse</code>æ¥å£çš„å®ç°ç±»æ˜¯<code>HttpServletResponseImpl</code>ï¼ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
<span class="line">34</span>
<span class="line">35</span>
<span class="line">36</span>
<span class="line">37</span>
<span class="line">38</span>
<span class="line">39</span>
<span class="line">40</span>
<span class="line">41</span>
<span class="line">42</span>
<span class="line">43</span>
<span class="line">44</span>
<span class="line">45</span>
<span class="line">46</span>
<span class="line">47</span>
<span class="line">48</span>
<span class="line">49</span>
<span class="line">50</span>
<span class="line">51</span>
<span class="line">52</span>
<span class="line">53</span>
<span class="line">54</span>
<span class="line">55</span>
<span class="line">56</span>
<span class="line">57</span>
<span class="line">58</span>
<span class="line">59</span>
<span class="line">60</span>
<span class="line">61</span>
<span class="line">62</span>
<span class="line">63</span>
<span class="line">64</span>
<span class="line">65</span>
<span class="line">66</span>
<span class="line">67</span>
<span class="line">68</span>
<span class="line">69</span>
<span class="line">70</span>
<span class="line">71</span>
<span class="line">72</span>
<span class="line">73</span>
<span class="line">74</span>
<span class="line">75</span>
<span class="line">76</span>
<span class="line">77</span>
<span class="line">78</span>
<span class="line">79</span>
<span class="line">80</span>
<span class="line">81</span>
<span class="line">82</span>
<span class="line">83</span>
<span class="line">84</span>
<span class="line">85</span>
<span class="line">86</span>
<span class="line">87</span>
<span class="line">88</span>
<span class="line">89</span>
<span class="line">90</span>
<span class="line">91</span>
<span class="line">92</span>
<span class="line">93</span>
<span class="line">94</span>
<span class="line">95</span>
<span class="line">96</span>
<span class="line">97</span>
<span class="line">98</span>
<span class="line">99</span>
<span class="line">100</span>
<span class="line">101</span>
<span class="line">102</span>
<span class="line">103</span>
<span class="line">104</span>
<span class="line">105</span>
<span class="line">106</span>
<span class="line">107</span>
<span class="line">108</span>
<span class="line">109</span>
<span class="line">110</span>
<span class="line">111</span>
</pre></td><td class="code"><pre><span class="line">abstract public class AbstractCauchoResponse implements CauchoResponse &#123;</span>
<span class="line"></span>
<span class="line">&#125;</span>
<span class="line"></span>
<span class="line">public interface CauchoResponse extends HttpServletResponse &#123;</span>
<span class="line">&#125;</span>
<span class="line"></span>
<span class="line">public final class HttpServletResponseImpl extends AbstractCauchoResponse</span>
<span class="line">  implements CauchoResponse</span>
<span class="line">&#123;</span>
<span class="line">    /**</span>
<span class="line">   * Sends a redirect to the browser.  If the URL is relative, it gets</span>
<span class="line">   * combined with the current url.</span>
<span class="line">   *</span>
<span class="line">   * @param url the possibly relative url to send to the browser</span>
<span class="line">   */</span>
<span class="line">  @Override</span>
<span class="line">  public void sendRedirect(String url)</span>
<span class="line">    throws IOException</span>
<span class="line">  &#123;</span>
<span class="line">    if (url == null)</span>
<span class="line">      throw new NullPointerException();</span>
<span class="line"></span>
<span class="line">    if (isCommitted())</span>
<span class="line">      throw new IllegalStateException(L.l("Can't sendRedirect() after data has committed to the client."));</span>
<span class="line"></span>
<span class="line">    _responseStream.clearBuffer();</span>
<span class="line"></span>
<span class="line">    // server/10c4</span>
<span class="line">    // reset();</span>
<span class="line">    resetBuffer();</span>
<span class="line"></span>
<span class="line">    setStatus(SC_MOVED_TEMPORARILY);</span>
<span class="line"></span>
<span class="line">    String encoding = getCharacterEncoding();</span>
<span class="line">    boolean isLatin1 = "iso-8859-1".equals(encoding);</span>
<span class="line">    </span>
<span class="line">    String path = encodeAbsoluteRedirect(url);</span>
<span class="line"></span>
<span class="line">    setHeader("Location", path);</span>
<span class="line">    </span>
<span class="line">    if (isLatin1)</span>
<span class="line">      setHeader("Content-Type", "text/html; charset=iso-8859-1");</span>
<span class="line">    else</span>
<span class="line">      setHeader("Content-Type", "text/html; charset=utf-8");</span>
<span class="line"></span>
<span class="line">    String msg = "The URL has moved &lt;a href=\"" + path + "\"&gt;here&lt;/a&gt;";</span>
<span class="line"></span>
<span class="line">    // The data is required for some WAP devices that can't handle an</span>
<span class="line">    // empty response.</span>
<span class="line">    if (_writer != null) &#123;</span>
<span class="line">      _writer.println(msg);</span>
<span class="line">    &#125;</span>
<span class="line">    else &#123;</span>
<span class="line">      ServletOutputStream out = getOutputStream();</span>
<span class="line">      out.println(msg);</span>
<span class="line">    &#125;</span>
<span class="line">    // closeConnection();</span>
<span class="line"></span>
<span class="line">    _request.saveSession(); // #503</span>
<span class="line">    // éå¸¸é‡è¦ï¼Œè¿™ä¸ªå°±æ˜¯resionå’Œtomcatçš„ä¸åŒä¹‹å¤„ï¼</span>
<span class="line">    // å·²ç»å…³é—­äº†ï¼Œè‚¯å®šä¸èƒ½å†å†™å…¥æ•°æ®ï¼</span>
<span class="line">    close();</span>
<span class="line">  &#125;</span>
<span class="line">   @Override</span>
<span class="line">  public void close()</span>
<span class="line">    throws IOException</span>
<span class="line">  &#123;</span>
<span class="line">    // tck - jsp include</span>
<span class="line">    AbstractHttpResponse response = _response;</span>
<span class="line">    </span>
<span class="line">    if (response != null) &#123;</span>
<span class="line">      response.close();</span>
<span class="line">    &#125;</span>
<span class="line">  &#125;</span>
<span class="line"></span>
<span class="line">&#125;</span>
<span class="line"></span>
<span class="line">resinå¤„ç†`302`æ–¹å¼å…¶å®éå¸¸ç®€å•ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</span>
<span class="line"></span>
<span class="line">1. æ¸…ç©ºç¼“å­˜åŒºå†…å®¹å¹¶è¿›è¡Œé‡ç½®</span>
<span class="line">2. è®¾ç½®302çŠ¶æ€ç </span>
<span class="line">3. è®¾ç½®`Location`ã€€å’Œã€€`Content-Type` å“åº”å¤´</span>
<span class="line">4. å†™å“åº”ä½“æ•°æ®</span>
<span class="line">5. ä¿å­˜session</span>
<span class="line">6. å…³é—­è¿æ¥</span>
<span class="line"></span>
<span class="line">æ•´ä¸ªå¤„ç†æµç¨‹éå¸¸ç®€å•æ˜äº†ï¼</span>
<span class="line"></span>
<span class="line">### tomcatå¯¹302çš„å¤„ç†</span>
<span class="line"></span>
<span class="line">åœ¨tomcatä¸­ï¼Œ`HttpServletResponse`æ¥å£çš„å®ç°ç±»æ˜¯`ResponseFacade`ï¼è¯¥ç±»æŒ‡ç¤ºä¸€ä¸ªFacade,</span>
<span class="line">ä»£ç å¦‚ä¸‹ï¼š</span>
<span class="line"></span>
<span class="line">```java ResponseFacade</span>
<span class="line">public class ResponseFacade implements HttpServletResponse &#123;</span>
<span class="line">    @Override</span>
<span class="line">    public void sendRedirect(String location)</span>
<span class="line">        throws IOException &#123;</span>
<span class="line"></span>
<span class="line">        if (isCommitted()) &#123;</span>
<span class="line">            throw new IllegalStateException</span>
<span class="line">                (sm.getString("coyoteResponse.sendRedirect.ise"));</span>
<span class="line">        &#125;</span>
<span class="line"></span>
<span class="line">        response.setAppCommitted(true);</span>
<span class="line"></span>
<span class="line">        response.sendRedirect(location);</span>
<span class="line"></span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>çœŸæ­£çš„å¤„ç†ç”±<code>Response</code>æ¥è¿›è¡Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
<span class="line">34</span>
<span class="line">35</span>
<span class="line">36</span>
<span class="line">37</span>
<span class="line">38</span>
<span class="line">39</span>
<span class="line">40</span>
<span class="line">41</span>
<span class="line">42</span>
<span class="line">43</span>
<span class="line">44</span>
<span class="line">45</span>
<span class="line">46</span>
<span class="line">47</span>
<span class="line">48</span>
<span class="line">49</span>
<span class="line">50</span>
<span class="line">51</span>
<span class="line">52</span>
<span class="line">53</span>
<span class="line">54</span>
<span class="line">55</span>
<span class="line">56</span>
<span class="line">57</span>
<span class="line">58</span>
<span class="line">59</span>
<span class="line">60</span>
<span class="line">61</span>
<span class="line">62</span>
<span class="line">63</span>
<span class="line">64</span>
<span class="line">65</span>
<span class="line">66</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Response</span> <span class="keyword">implements</span> <span class="title">HttpServletResponse</span> </span>&#123;</span>
<span class="line">    <span class="comment">/**</span>
<span class="line">    * Send a temporary redirect to the specified redirect location URL.</span>
<span class="line">    *</span>
<span class="line">    * <span class="doctag">@param</span> location Location URL to redirect to</span>
<span class="line">    *</span>
<span class="line">    * <span class="doctag">@exception</span> IllegalStateException if this response has</span>
<span class="line">    *  already been committed</span>
<span class="line">    * <span class="doctag">@exception</span> IOException if an input/output error occurs</span>
<span class="line">    */</span></span>
<span class="line">    <span class="meta">@Override</span></span>
<span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendRedirect</span><span class="params">(String location)</span> <span class="keyword">throws</span> IOException </span>&#123;</span>
<span class="line">        sendRedirect(location, SC_FOUND);</span>
<span class="line">    &#125;</span>
<span class="line"></span>
<span class="line">    <span class="comment">/**</span>
<span class="line">     * Internal method that allows a redirect to be sent with a status other</span>
<span class="line">     * than &#123;<span class="doctag">@link</span> HttpServletResponse#SC_FOUND&#125; (302). No attempt is made to</span>
<span class="line">     * validate the status code.</span>
<span class="line">     *</span>
<span class="line">     * <span class="doctag">@param</span> location Location URL to redirect to</span>
<span class="line">     * <span class="doctag">@param</span> status HTTP status code that will be sent</span>
<span class="line">     * <span class="doctag">@throws</span> IOException an IO exception occurred</span>
<span class="line">     */</span></span>
<span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendRedirect</span><span class="params">(String location, <span class="keyword">int</span> status)</span> <span class="keyword">throws</span> IOException </span>&#123;</span>
<span class="line">        <span class="keyword">if</span> (isCommitted()) &#123;</span>
<span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(sm.getString(<span class="string">"coyoteResponse.sendRedirect.ise"</span>));</span>
<span class="line">        &#125;</span>
<span class="line"></span>
<span class="line">        <span class="comment">// Ignore any call from an included servlet</span></span>
<span class="line">        <span class="keyword">if</span> (included) &#123;</span>
<span class="line">            <span class="keyword">return</span>;</span>
<span class="line">        &#125;</span>
<span class="line"></span>
<span class="line">        <span class="comment">// æ¸…ç©ºç¼“å­˜åŒºå†…å®¹å¹¶è¿›è¡Œé‡ç½®</span></span>
<span class="line">        resetBuffer(<span class="keyword">true</span>);</span>
<span class="line"></span>
<span class="line">        <span class="comment">// Generate a temporary redirect to the specified location</span></span>
<span class="line">        <span class="keyword">try</span> &#123;</span>
<span class="line">            String locationUri;</span>
<span class="line">            <span class="comment">// Relative redirects require HTTP/1.1</span></span>
<span class="line">            <span class="keyword">if</span> (getRequest().getCoyoteRequest().getSupportsRelativeRedirects() &amp;&amp;</span>
<span class="line">                    getContext().getUseRelativeRedirects()) &#123;</span>
<span class="line">                locationUri = location;</span>
<span class="line">            &#125; <span class="keyword">else</span> &#123;</span>
<span class="line">                locationUri = toAbsolute(location);</span>
<span class="line">            &#125;</span>
<span class="line">            setStatus(status);</span>
<span class="line">            setHeader(<span class="string">"Location"</span>, locationUri);</span>
<span class="line">            <span class="comment">//ã€€è¿™é‡Œæœ‰ä¸ªå°é­”æ³•</span></span>
<span class="line">            <span class="keyword">if</span> (getContext().getSendRedirectBody()) &#123;</span>
<span class="line">                PrintWriter writer = getWriter();</span>
<span class="line">                writer.print(sm.getString(<span class="string">"coyoteResponse.sendRedirect.note"</span>,</span>
<span class="line">                        Escape.htmlElementContent(locationUri)));</span>
<span class="line">                flushBuffer();</span>
<span class="line">            &#125;</span>
<span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span>
<span class="line">            log.warn(sm.getString(<span class="string">"response.sendRedirectFail"</span>, location), e);</span>
<span class="line">            setStatus(SC_NOT_FOUND);</span>
<span class="line">        &#125;</span>
<span class="line"></span>
<span class="line">        <span class="comment">// è®¾ç½®ç¼“å­˜åŒºçš„suspendedæ ‡å¿—ä½ã€€</span></span>
<span class="line">        <span class="comment">// ä»åº”ç”¨è§†å›¾çš„è§’åº¦çœ‹ï¼Œè¯¥å“åº”å·²ç»ç»“æŸäº†ï¼ ä½†å…¶å®è¿æ¥å¹¶æ²¡æœ‰å…³é—­.</span></span>
<span class="line">        setSuspended(<span class="keyword">true</span>);</span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>tomcatå¤„ç†<code>302</code>æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>æ¸…ç©ºç¼“å­˜åŒºå†…å®¹å¹¶è¿›è¡Œé‡ç½®</li>
<li>è®¾ç½®302çŠ¶æ€ç </li>
<li>è®¾ç½®<code>Location</code> å“åº”å¤´</li>
<li>å†™å“åº”ä½“æ•°æ®</li>
<li>ä¿å­˜session</li>
<li>å…³é—­è¿æ¥</li>
</ol>
<h4 id="tomcat-contexté…ç½®"><a href="#tomcat-contexté…ç½®" class="headerlink" title="tomcat contexté…ç½®"></a>tomcat contexté…ç½®</h4><p>è¯¦ç»†é…ç½®é¡¹å‚è€ƒ:<a href="https://tomcat.apache.org/tomcat-7.0-doc/config/context.html" target="_blank" rel="external">https://tomcat.apache.org/tomcat-7.0-doc/config/context.html</a></p>
<p>å…¶ä¸­å’Œ302å¤„ç†ç›¸å…³çš„ä¸€ä¸ªé…ç½®é¡¹ä¸º:<code>sendRedirectBody</code>,æ–‡æ¡£è§£é‡Šå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">If <span class="keyword">true</span>, redirect responses will include a <span class="keyword">short</span> response body that includes details of the redirect as recommended by RFC <span class="number">2616</span>. This is disabled by <span class="keyword">default</span> since including a response body may cause problems <span class="keyword">for</span> some application component such as compression filters.</span>
</pre></td></tr></table></figure>
<p>æ ¹æ®<a href="https://tools.ietf.org/html/rfc2616" target="_blank" rel="external">RFC 2616</a>è§„èŒƒï¼Œ302è·³è½¬æ˜¯å¯ä»¥å¸¦æœ‰å“åº”ä½“æ•°æ®çš„(resinå°±æŒ‰è§„èŒƒè¿›è¡Œäº†å®ç°).ã€€tomcaté»˜è®¤å¤„ç†æ˜¯ä¸å¸¦çš„ï¼ŒåŸå› æ˜¯å¯èƒ½ä¸å…¶å®ƒç»„ä»¶å†²çªï¼Œä¾‹å¦‚å‹ç¼©ç»„ä»¶.</p>
<p>å¦‚æœå°†<code>sendRedirectBody</code>çš„å€¼è®¾ä¸ºtrue,åˆ™tomcatåœ¨å¤„ç†302æ—¶ï¼Œåœ¨å†™å®Œå“åº”ä½“æ•°æ®åï¼Œä¼šæ‰§è¡Œç¼“å­˜åŒºçš„åˆ·æ–°ï¼Œå®¢æˆ·ç«¯èƒ½æ”¶åˆ°å¯¹åº”çš„å“åº”å¤´æ•°æ®ï¼Œå®Œæˆè·³è½¬ï¼Œä¸”ä¸ä¼šåº”ä¸ºåç»­ç»§ç»­å†™æ•°æ®å¯¼è‡´å®¢æˆ·ç«¯ä¸èƒ½æ­£å¸¸è·³è½¬.</p>
<p>å› ä¸ºé»˜è®¤æ˜¯false,å¯¼è‡´302å“åº”å¤´æ•°æ®æ²¡æœ‰åŠæ—¶å‘é€ç»™å®¢æˆ·ç«¯ï¼Œåœ¨<code>sendRedirect</code>åå¦‚æœåº”ç”¨å‘ç”Ÿäº†å¼‚å¸¸ï¼Œåˆ™å·²ç»è®¾ç½®äº†çš„302å“åº”ç ä¼šè¢«500æ‰€æ›¿ä»£ï¼Œå®¢æˆ·ç«¯ä¸èƒ½æ­£å¸¸è·³è½¬ï¼</p>
<p>###ã€€tomcatã€€<code>sendRedirect</code>åä¸èƒ½è·³è½¬çš„é€»è¾‘åˆ†æ</p>
<p>tomcatã€€å¤„ç†è¯·æ±‚çš„æµç¨‹ä¸€éƒ¨åˆ†æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><code>StandardHostValve</code> -&gt; <code>StandardContextValve</code> -&gt; <code>StandardWrapperValve</code></p>
<p>è¯·æ±‚å…¥å£ç”±<code>StandardWrapperValve</code>å¤„ç†ï¼Œã€€ç»“æŸè¿˜æ˜¯éœ€è¦<code>StandardHostValve</code>æ¥å¤„ç†ï¼</p>
<figure class="highlight java"><figcaption><span>StandardWrapperValve</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
</pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span>
<span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(Request request, Response response)</span></span>
<span class="line">    <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span>
<span class="line"></span>
<span class="line">    <span class="comment">// Allocate a servlet instance to process this request</span></span>
<span class="line">    <span class="keyword">try</span> &#123;</span>
<span class="line">        <span class="keyword">if</span> (!unavailable) &#123;</span>
<span class="line">            servlet = wrapper.allocate();</span>
<span class="line">        &#125;</span>
<span class="line">    &#125; <span class="keyword">catch</span> (UnavailableException e) &#123;</span>
<span class="line">       </span>
<span class="line">    &#125; <span class="keyword">catch</span> (ServletException e) &#123;</span>
<span class="line">        </span>
<span class="line">        exception(request, response, e);</span>
<span class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span>
<span class="line">        exception(request, response, e);</span>
<span class="line">        servlet = <span class="keyword">null</span>;</span>
<span class="line">    &#125;</span>
<span class="line"></span>
<span class="line">    <span class="comment">//ã€€å½“è¯·æ±‚å‘é€å¼‚å¸¸æ—¶, å·²ç»è®¾ç½®çš„302çŠ¶æ€ç æ­¤æ—¶å˜ä¸º500</span></span>
<span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">exception</span><span class="params">(Request request, Response response,</span>
<span class="line">                           Throwable exception)</span> </span>&#123;</span>
<span class="line">        request.setAttribute(RequestDispatcher.ERROR_EXCEPTION, exception);</span>
<span class="line">        response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);</span>
<span class="line">        response.setError();</span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>StandardHostValveã€€å¤„ç†é€»è¾‘</p>
<figure class="highlight java"><figcaption><span>StandardHostValve</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
<span class="line">34</span>
<span class="line">35</span>
<span class="line">36</span>
<span class="line">37</span>
<span class="line">38</span>
<span class="line">39</span>
<span class="line">40</span>
<span class="line">41</span>
<span class="line">42</span>
<span class="line">43</span>
<span class="line">44</span>
<span class="line">45</span>
<span class="line">46</span>
<span class="line">47</span>
<span class="line">48</span>
<span class="line">49</span>
<span class="line">50</span>
<span class="line">51</span>
<span class="line">52</span>
<span class="line">53</span>
<span class="line">54</span>
<span class="line">55</span>
<span class="line">56</span>
<span class="line">57</span>
<span class="line">58</span>
<span class="line">59</span>
<span class="line">60</span>
<span class="line">61</span>
<span class="line">62</span>
<span class="line">63</span>
</pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span>
<span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(Request request, Response response)</span></span>
<span class="line">    <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span>
<span class="line"></span>
<span class="line">    <span class="keyword">try</span> &#123;</span>
<span class="line">        <span class="comment">// çœç•¥ä»£ç </span></span>
<span class="line">        <span class="keyword">try</span> &#123;</span>
<span class="line">            <span class="keyword">if</span> (!asyncAtStart || asyncDispatching) &#123;</span>
<span class="line">                context.getPipeline().getFirst().invoke(request, response);</span>
<span class="line">            &#125; <span class="keyword">else</span> &#123;</span>
<span class="line">                <span class="comment">// Make sure this request/response is here because an error</span></span>
<span class="line">                <span class="comment">// report is required.</span></span>
<span class="line">                <span class="keyword">if</span> (!response.isErrorReportRequired()) &#123;</span>
<span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(sm.getString(<span class="string">"standardHost.asyncStateError"</span>));</span>
<span class="line">                &#125;</span>
<span class="line">            &#125;</span>
<span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span>
<span class="line">            ExceptionUtils.handleThrowable(t);</span>
<span class="line">            container.getLogger().error(<span class="string">"Exception Processing "</span> + request.getRequestURI(), t);</span>
<span class="line">            <span class="comment">// If a new error occurred while trying to report a previous</span></span>
<span class="line">            <span class="comment">// error allow the original error to be reported.</span></span>
<span class="line">            <span class="keyword">if</span> (!response.isErrorReportRequired()) &#123;</span>
<span class="line">                request.setAttribute(RequestDispatcher.ERROR_EXCEPTION, t);</span>
<span class="line">                throwable(request, response, t);</span>
<span class="line">            &#125;</span>
<span class="line">        &#125;</span>
<span class="line">        <span class="comment">// åœ¨sendRedirectæ–¹æ³•è®¾ç½®çš„suspendedæ ‡å¿—ä½æ­¤æ—¶åˆè¢«ç½®ä¸ºfalse</span></span>
<span class="line">        <span class="comment">// ä¹Ÿå°±æ˜¯è¯´ã€€responseç”±å¯ä»¥ä½¿ç”¨äº†ï¼è¿™å°±æ˜¯resinå’Œtomcatè®¾è®¡å®ç°çš„ä¸åŒ        </span></span>
<span class="line">        <span class="comment">// Now that the request/response pair is back under container</span></span>
<span class="line">        <span class="comment">// control lift the suspension so that the error handling can</span></span>
<span class="line">        <span class="comment">// complete and/or the container can flush any remaining data</span></span>
<span class="line">        response.setSuspended(<span class="keyword">false</span>);</span>
<span class="line"></span>
<span class="line">        Throwable t = (Throwable) request.getAttribute(RequestDispatcher.ERROR_EXCEPTION);</span>
<span class="line"></span>
<span class="line">        <span class="comment">// Protect against NPEs if the context was destroyed during a</span></span>
<span class="line">        <span class="comment">// long running request.</span></span>
<span class="line">        <span class="keyword">if</span> (!context.getState().isAvailable()) &#123;</span>
<span class="line">            <span class="keyword">return</span>;</span>
<span class="line">        &#125;</span>
<span class="line"></span>
<span class="line">        <span class="comment">// Look for (and render if found) an application level error page</span></span>
<span class="line">        <span class="keyword">if</span> (response.isErrorReportRequired()) &#123;</span>
<span class="line">            <span class="keyword">if</span> (t != <span class="keyword">null</span>) &#123;</span>
<span class="line">                throwable(request, response, t);</span>
<span class="line">            &#125; <span class="keyword">else</span> &#123;</span>
<span class="line">                status(request, response);</span>
<span class="line">            &#125;</span>
<span class="line">        &#125;</span>
<span class="line"></span>
<span class="line">        <span class="keyword">if</span> (!request.isAsync() &amp;&amp; !asyncAtStart) &#123;</span>
<span class="line">            context.fireRequestDestroyEvent(request.getRequest());</span>
<span class="line">        &#125;</span>
<span class="line">    &#125; <span class="keyword">finally</span> &#123;</span>
<span class="line">        <span class="comment">// Access a session (if present) to update last accessed time, based</span></span>
<span class="line">        <span class="comment">// on a strict interpretation of the specification</span></span>
<span class="line">        <span class="keyword">if</span> (ACCESS_SESSION) &#123;</span>
<span class="line">            request.getSession(<span class="keyword">false</span>);</span>
<span class="line">        &#125;</span>
<span class="line"></span>
<span class="line">        context.unbind(Globals.IS_SECURITY_ENABLED, MY_CLASSLOADER);</span>
<span class="line">    &#125;        </span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol>
<li>çº¿ä¸Šæ›¿æ¢åº”ç”¨ç»„ä»¶ï¼Œå°¤å…¶æ˜¯åº•å±‚çš„åº”ç”¨è½¯ä»¶éœ€è¦éå¸¸æ³¨æ„ï¼ä¸å¯å…¨é‡æ›¿æ¢ï¼ä¸€å®šè¦é€æ­¥æ›¿æ¢ï¼è™½ç„¶å·²ç»åœ¨æµ‹è¯•ç¯å¢ƒï¼Œçº¿ä¸Šç°åº¦æ›¿æ¢äº†ä¸€å°æœºå™¨ï¼Œ<br>ä½†æ˜¯å› ä¸ºè®¿é—®é‡å°ï¼Œå¯¼è‡´é—®é¢˜å‘ç°çš„æ¯”è¾ƒæ™šï¼Œç›´è‡³å¤§æ‰¹é‡æ›¿æ¢æ‰å‘ç°é—®é¢˜ï¼ã€€è¿˜æœ‰å°±æ˜¯ï¼šåŒä¸€ä¸ªè§„èŒƒï¼Œä½†ä¸åŒçš„å®ç°ç»†èŠ‚è¿˜æ˜¯æœ‰å·®å¼‚ï¼</li>
<li>åº”ç”¨å¼€å‘ä¸€å®šéœ€è¦éµå®ˆAPIè§„èŒƒï¼Œå¦åˆ™ä¼šå¯¼è‡´å¥‡æ€ªé—®é¢˜çš„å‘ç”Ÿï¼å¥½å¤šäººæ€»æ˜¯è¯´é‡åˆ°çš„é—®é¢˜å¤šï¼Œè¸©å‘å¤šï¼Œé‚£æ˜¯å› ä¸ºä½ ä»æ¥ä¸ä»”ç»†é˜…è¯»ç›¸å…³apiè§„èŒƒæ–‡æ¡£æˆ–å®˜æ–¹æ–‡æ¡£ï¼ä¸éµå®ˆè§„èŒƒå¯¼è‡´çš„é—®é¢˜èƒ½å«å‘å—ï¼Ÿ</li>
<li>åœ¨ä½¿ç”¨ä»»ä½•ä¸€é¡¹æŠ€æœ¯æ—¶ï¼Œä¼˜å…ˆæŸ¥è¯¢å®˜æ–¹æ–‡æ¡£ï¼ä¸è¦éšæ‰‹googleæˆ–baiduï¼ã€€å®è¯è¯´ï¼Œç½‘ä¸Šçš„æ–‡ç« è´¨é‡å‚å·®ä¸é½ï¼Œéš¾å…æ‰¾åˆ°ç†è§£é”™è¯¯çš„æ–‡æ¡£ï¼</li>
<li>å…»æˆé˜…è¯»æºä»£ç çš„ä¹ æƒ¯ï¼Œå¥½å¤„ä¸è¨€è€Œå–»ï¼å¦‚æœï¼“å¹´å‰æ²¡æœ‰è¯»è¿‡tomcat6çš„æºä»£ç ï¼Œä»Šå¤©æ’æŸ¥èµ·æ¥é—®é¢˜å°±éå¸¸å›°éš¾äº†.</li>
</ol>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://zh.wikipedia.org/wiki/HTTP_302" target="_blank" rel="external">https://zh.wikipedia.org/wiki/HTTP_302</a><br><a href="https://tools.ietf.org/html/rfc2616#section-10.3.3" target="_blank" rel="external">https://tools.ietf.org/html/rfc2616#section-10.3.3</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;æŸå¤©ï¼Œå°†çº¿ä¸Šçš„resinå®¹å™¨æ›¿æ¢ä¸ºtomcatï¼ã€€è¿‡äº†ä¸€æ®µæ—¶é—´å‘ç°æœ‰ä¸ªæ¥å£å¤„ç†å¤±è´¥ï¼Œæç¤ºå¼‚å¸¸ï¼æŸ¥çœ‹åº”ç”¨æ—¥å¿—å‘ç°å¦‚ä¸‹çš„æ—¥å¿—ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Caused by: javax.servlet.ServletException: java.lang.IllegalStateException: Cannot create a session after the response has been committed&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;        at org.apache.jsp.WEB_002dINF.content.order.page.error_jsp._jspService(error_jsp.java:&lt;span class=&quot;number&quot;&gt;293&lt;/span&gt;) ~[na:na]&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:&lt;span class=&quot;number&quot;&gt;70&lt;/span&gt;) ~[jasper.jar:&lt;span class=&quot;number&quot;&gt;8.5&lt;/span&gt;.12]&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;        at javax.servlet.http.HttpServlet.service(HttpServlet.java:&lt;span class=&quot;number&quot;&gt;742&lt;/span&gt;) ~[servlet-api.jar:na]&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;        at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:&lt;span class=&quot;number&quot;&gt;443&lt;/span&gt;) ~[jasper.jar:&lt;span class=&quot;number&quot;&gt;8.5&lt;/span&gt;.12]&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;        ... &lt;span class=&quot;number&quot;&gt;38&lt;/span&gt; common frames omitted&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;æŸ¥è¯¢ç›¸å…³æ¥å£çš„ä»£ç å‘ç°ï¼Œä»£ç å¯¹&lt;code&gt;302&lt;/code&gt;è·³è½¬çš„é€»è¾‘å¤„ç†æœ‰é—®é¢˜ï¼Œå…·ä½“å¦‚ä¸‹ï¼š&lt;/p&gt;
    
    </summary>
    
    
      <category term="web" scheme="https://leokongwq.github.io/tags/web/"/>
    
      <category term="tomcat" scheme="https://leokongwq.github.io/tags/tomcat/"/>
    
      <category term="resin" scheme="https://leokongwq.github.io/tags/resin/"/>
    
  </entry>
  
  <entry>
    <title>consulä¹‹aclé…ç½®</title>
    <link href="https://leokongwq.github.io/2018/07/08/consul-acl.html"/>
    <id>https://leokongwq.github.io/2018/07/08/consul-acl.html</id>
    <published>2018-07-08T15:08:31.000Z</published>
    <updated>2018-11-03T04:40:32.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><h2 id="é…ç½®é¡¹"><a href="#é…ç½®é¡¹" class="headerlink" title="é…ç½®é¡¹"></a>é…ç½®é¡¹</h2><h3 id="acl-datacenter"><a href="#acl-datacenter" class="headerlink" title="acl_datacenter"></a>acl_datacenter</h3><p>è¯¥é…ç½®é¡¹æŒ‡å®šäº†å¯¹ACLä¿¡æ¯å…·æœ‰æƒå¨æ€§çš„æ•°æ®ä¸­å¿ƒã€‚ å¿…é¡»æä¾›å®ƒæ‰èƒ½å¯ç”¨ACLã€‚ æ‰€æœ‰Serverå®ä¾‹å’Œæ•°æ®ä¸­å¿ƒå¿…é¡»å°±ACLæ•°æ®ä¸­å¿ƒè¾¾æˆä¸€è‡´ã€‚<br>å¿…é¡»åœ¨æ•´ä¸ªé›†ç¾¤çš„ServerèŠ‚ç‚¹ä¸Šè®¾ç½®è¯¥é…ç½®é¡¹ã€‚ä½†æ˜¯é’ˆå¯¹APIæ¥è¯´ï¼Œå¦‚æœè¦ä½¿å®¢æˆ·ç«¯çš„è¯·æ±‚èƒ½è¢«æ­£ç¡®è½¬å‘ï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦åœ¨å®¢æˆ·ç«¯èŠ‚ç‚¹è®¾ç½®ã€‚<br>åœ¨Consul 0.8åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œè¿˜å¯ä»¥å¯ç”¨ä»£ç†çº§åˆ«çš„ACLã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://www.consul.io/docs/guides/acl.html" target="_blank" rel="external">ACLæŒ‡å—</a>ã€‚</p>
<h3 id="acl-default-policy"><a href="#acl-default-policy" class="headerlink" title="acl_default_policy"></a>acl_default_policy</h3><p>è¯¥é…ç½®é¡¹å¯é€‰çš„å€¼ä¸º<code>allow</code>å’Œ<code>deny</code>ã€‚é»˜è®¤å€¼ä¸ºâ€™allowâ€™ã€‚é»˜è®¤çš„ç­–ç•¥æ§åˆ¶tokenåœ¨æ²¡æœ‰åŒ¹é…çš„è§„åˆ™æ—¶çš„è¡Œä¸ºã€‚<br>åœ¨<code>allow</code>æ¨¡å¼ä¸‹ï¼ŒACLè§„åˆ™æ˜¯ä¸€ä¸ªé»‘åå•ï¼šä»»ä½•æ²¡æœ‰è¢«ç¦æ­¢çš„æ“ä½œéƒ½æ˜¯å¯ä»¥æ‰§è¡Œçš„ã€‚<br>åœ¨<code>deny</code>æ¨¡å¼ä¸‹ï¼ŒACLè§„åˆ™æ˜¯ä¸€ä¸ªç™½åå•ï¼Œä»»ä½•æ²¡æœ‰æ˜ç¡®æŒ‡å®šçš„æ“ä½œéƒ½æ˜¯è¢«ç¦æ­¢çš„ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šè¯¥é…ç½®é¡¹åªæœ‰åœ¨é…ç½®äº†<code>acl_datacenter</code>åæ‰èµ·ä½œç”¨</p>
</blockquote>
<a id="more"></a>
<h3 id="acl-down-policy"><a href="#acl-down-policy" class="headerlink" title="acl_down_policy"></a>acl_down_policy</h3><p>è¯¥é…ç½®é¡¹å¯é€‰çš„å€¼ä¸º<code>allow</code>ï¼Œ<code>deny</code>æˆ–<code>extend-cache</code>ï¼Œã€€é»˜è®¤å€¼æ˜¯<code>extend-cache</code>ã€‚å‡å¦‚ä¸èƒ½ä»<code>acl_datacenter</code>æˆ–<code>Leader</code>èŠ‚ç‚¹è·å–ä¸€ä¸ªtokençš„aclä¿¡æ¯ï¼Œåˆ™è¯¥é…ç½®é¡¹æŒ‡å®šçš„ç­–ç•¥è¢«ä½¿ç”¨ã€‚</p>
<ul>
<li><code>allow</code>æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½å…è®¸ã€‚ </li>
<li><code>deny</code>æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½è¢«ç¦æ­¢ã€‚ </li>
<li><code>extend-cache</code>æ¨¡å¼ä¸‹,ä½¿ç”¨ç¼“å­˜çš„ ACLè§„åˆ™å¹¶å¿½ç•¥è¿™äº›è§„åˆ™çš„è¿‡æœŸæ—¶é—´ã€‚å¦‚æœä¸€ä¸ªä¸å¯ç¼“å­˜çš„ï¼¡ï¼£ï¼¬çš„è§„åˆ™è¢«ä½¿ç”¨ï¼Œåˆ™å½“ä½œ<code>deny</code>ç­–ç•¥æ¥å¤„ç†ã€‚</li>
</ul>
<h3 id="acl-master-token"><a href="#acl-master-token" class="headerlink" title="acl_master_token"></a>acl_master_token</h3><p>è¯¥é…ç½®é¡¹åªèƒ½ç”¨åœ¨<code>acl_datacenter</code>ä¸­çš„ServerèŠ‚ç‚¹ä¸Šã€‚ å¦‚æœè¯¥ä»¤ç‰Œä¸å­˜åœ¨ï¼Œåˆ™å°†ä½¿ç”¨ç®¡ç†çº§æƒé™åˆ›å»ºè¯¥ä»¤ç‰Œã€‚ å®ƒå…è®¸æ“ä½œå‘˜ä½¿ç”¨ä¼—æ‰€å‘¨çŸ¥çš„ä»¤ç‰ŒIDæ¥å¼•å¯¼ACLç³»ç»Ÿã€‚</p>
<p>ä»…å½“æœåŠ¡å™¨è·å¾—é›†ç¾¤é¢†å¯¼æ—¶æ‰å®‰è£…acl_master_tokenã€‚ å¦‚æœè¦å®‰è£…æˆ–æ›´æ”¹acl_master_tokenï¼Œè¯·åœ¨æ‰€æœ‰æœåŠ¡å™¨çš„é…ç½®ä¸­ä¸ºacl_master_tokenè®¾ç½®æ–°å€¼ã€‚ å®Œæˆæ­¤æ“ä½œåï¼Œé‡æ–°å¯åŠ¨å½“å‰é¢†å¯¼è€…ä»¥å¼ºåˆ¶è¿›è¡Œé¢†å¯¼è€…é€‰ä¸¾ã€‚ å¦‚æœæœªæä¾›acl_master_tokenï¼Œåˆ™æœåŠ¡å™¨ä¸ä¼šåˆ›å»ºä¸»ä»¤ç‰Œã€‚ æä¾›å€¼æ—¶ï¼Œå®ƒå¯ä»¥æ˜¯ä»»ä½•å­—ç¬¦ä¸²å€¼ã€‚ ä½¿ç”¨UUIDå¯ä»¥ç¡®ä¿å®ƒçœ‹èµ·æ¥ä¸å…¶ä»–ä»¤ç‰Œç›¸åŒï¼Œä½†å¹¶ä¸æ˜¯ç»å¯¹å¿…è¦çš„ã€‚</p>
<h3 id="acl-agent-master-token"><a href="#acl-agent-master-token" class="headerlink" title="acl_agent_master_token"></a>acl_agent_master_token</h3><p>ç”¨ä½œç‰¹æ®Šè®¿é—® tokenï¼Œåœ¨é…ç½®å®ƒçš„æ¯ä¸ª agent ä¸Šå…·æœ‰ agent ACL ç­–ç•¥ write ç‰¹æƒã€‚ åªæœ‰å½“ Consul server ä¸å¯ç”¨äºè§£æ ACL token æ—¶ï¼Œ æ­¤ tokone æ‰åº”ç”±è¿ç»´äººå‘˜åœ¨æœåŠ¡ä¸­æ–­æœŸé—´ä½¿ç”¨ã€‚ åº”ç”¨ç¨‹åºåº”åœ¨æ­£å¸¸æ“ä½œæœŸé—´ä½¿ç”¨å¸¸è§„ ACL tokenã€‚è¯¥é…ç½®é¡¹ä»ç‰ˆæœ¬<code>0.7.2</code>å¼€å§‹ä½¿ç”¨ï¼Œå¹¶ä¸”åªæœ‰å½“é…ç½®é¡¹<code>acl_enforce_version_8</code>è®¾ç½®ä¸ºtrueæ—¶æ‰èµ·ä½œç”¨ã€‚æ›´å¤šä¿¡æ¯å‚è€ƒ<a href="https://www.consul.io/docs/guides/acl.html#acl-agent-master-token" target="_blank" rel="external"> ACL Agent Master Token </a></p>
<h3 id="acl-agent-token"><a href="#acl-agent-token" class="headerlink" title="acl_agent_token"></a>acl_agent_token</h3><p>ç”±å®¢æˆ·ç«¯å’Œ<code>Server</code>èŠ‚ç‚¹æ‰§è¡Œå†…éƒ¨æ“ä½œä½¿ç”¨ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®è¯¥é…ç½®é¡¹çš„å€¼ï¼Œåˆ™<code>acl_token</code>é…ç½®é¡¹çš„è¢«ä½¿ç”¨ã€‚è¯¥é…ç½®é¡¹ä»ç‰ˆæœ¬<code>0.7.2</code>å¼€å§‹ä½¿ç”¨ã€‚</p>
<p>æ­¤ä»¤ç‰Œå¿…é¡»è‡³å°‘å…·æœ‰å¯¹å…¶å°†æ³¨å†Œçš„èŠ‚ç‚¹åç§°çš„å†™è®¿é—®æƒï¼Œä»¥ä¾¿è®¾ç½®ç›®å½•ä¸­çš„ä»»ä½•èŠ‚ç‚¹çº§ä¿¡æ¯ï¼Œä¾‹å¦‚å…ƒæ•°æ®æˆ–èŠ‚ç‚¹çš„æ ‡è®°åœ°å€ã€‚ ä½¿ç”¨æ­¤ä»¤ç‰Œè¿˜æœ‰å…¶ä»–åœ°æ–¹ï¼Œè¯·å‚é˜…<a href="https://www.consul.io/docs/guides/acl.html#acl-agent-token" target="_blank" rel="external">ACLä»£ç†ä»¤ç‰Œ</a>ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p>
<h3 id="acl-enforce-version-8"><a href="#acl-enforce-version-8" class="headerlink" title="acl_enforce_version_8"></a>acl_enforce_version_8</h3><p>ç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼Œä»¥ç¡®å®šæ˜¯å¦åº”åœ¨Consul 0.8ä¹‹å‰é¢„è§ˆæ–°çš„ACLç­–ç•¥ã€‚ åœ¨Consul 0.7.2ä¸­æ·»åŠ ï¼Œåœ¨0.8ä¹‹å‰çš„Consulç‰ˆæœ¬ä¸­é»˜è®¤ä¸ºfalseï¼Œåœ¨Consul 0.8åŠæ›´é«˜ç‰ˆæœ¬ä¸­é»˜è®¤ä¸ºtrueã€‚ é€šè¿‡åœ¨å®æ–½å¼€å§‹ä¹‹å‰å…è®¸ç­–ç•¥åˆ°ä½ï¼Œè¿™æœ‰åŠ©äºç®€åŒ–å‘æ–°ACLåŠŸèƒ½çš„è¿‡æ¸¡ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ACLæŒ‡å—ã€‚</p>
<h3 id="acl-replication-token"><a href="#acl-replication-token" class="headerlink" title="acl_replication_token"></a>acl_replication_token</h3><p>ä»…ç”¨äºè¿è¡ŒConsul 0.7æˆ–æ›´é«˜ç‰ˆæœ¬çš„<code>acl_datacenter</code>ä¹‹å¤–çš„æœåŠ¡å™¨ã€‚ æä¾›æ—¶ï¼Œè¿™å°†å¯ç”¨ä½¿ç”¨æ­¤ä»¤ç‰Œè¿›è¡ŒACLå¤åˆ¶ï¼Œä»¥æ£€ç´¢ACLå¹¶å°†å…¶å¤åˆ¶åˆ°éæƒå¨çš„æœ¬åœ°æ•°æ®ä¸­å¿ƒã€‚ åœ¨Consul 0.9.1å’Œæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>enable_acl_replication</code>å¯ç”¨ACLå¤åˆ¶ï¼Œç„¶åç¨åä½¿ç”¨æ¯ä¸ªæœåŠ¡å™¨ä¸Šçš„ä»£ç†ä»¤ç‰ŒAPIè®¾ç½®ä»¤ç‰Œã€‚ å¦‚æœåœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®äº†<code>acl_replication_token</code> ï¼Œå®ƒå°†è‡ªåŠ¨å°†<code>enable_acl_replication</code>è®¾ç½®ä¸ºtrueä»¥å®ç°å‘åå…¼å®¹æ€§ã€‚</p>
<p>å¦‚æœå­˜åœ¨å½±å“æƒå¨æ•°æ®ä¸­å¿ƒçš„åˆ†åŒºæˆ–å…¶ä»–ä¸­æ–­ï¼Œå¹¶ä¸”<code>acl_down_policy</code>è®¾ç½®ä¸º<code>extend-cache</code>ï¼Œåˆ™å¯ä»¥åœ¨ä¸­æ–­æœŸé—´ä½¿ç”¨å¤åˆ¶çš„ACLé›†è§£æä¸åœ¨ç¼“å­˜ä¸­çš„ä»¤ç‰Œã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://www.consul.io/docs/guides/acl.html#replication" target="_blank" rel="external">ACLæŒ‡å—å¤åˆ¶éƒ¨åˆ†</a>ã€‚</p>
<h3 id="acl-token"><a href="#acl-token" class="headerlink" title="acl_token"></a>acl_token</h3><p>å¦‚æœè®¾ç½®äº†è¯¥é…ç½®é¡¹ï¼Œä»£ç†å°†åœ¨å‘ConsulæœåŠ¡å™¨å‘å‡ºè¯·æ±‚æ—¶ä½¿ç”¨æ­¤ä»¤ç‰Œã€‚ å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡æä¾›<code>ï¼Ÿtoken</code>æŸ¥è¯¢å‚æ•°ï¼ŒåŸºäºæ¯ä¸ªè¯·æ±‚è¦†ç›–æ­¤ä»¤ç‰Œã€‚ å¦‚æœæœªæä¾›ï¼Œåˆ™ä½¿ç”¨æ˜ å°„åˆ°â€œåŒ¿åâ€ACLç­–ç•¥çš„ç©ºæ ‡è®°ã€‚</p>
<h3 id="acl-ttl"><a href="#acl-ttl" class="headerlink" title="acl_ttl"></a>acl_ttl</h3><p>ç”¨äºæ§åˆ¶ACLç¼“å­˜çš„è¿‡æœŸæ—¶é—´ã€‚ é»˜è®¤æ˜¯30ç§’ã€‚ æ­¤è®¾ç½®ä¼šå¯¹æ€§èƒ½äº§ç”Ÿé‡å¤§å½±å“ï¼šå‡å°‘å®ƒä¼šå¯¼è‡´æ›´é¢‘ç¹çš„åˆ·æ–°ï¼Œå¢åŠ å®ƒä¼šå‡å°‘åˆ·æ–°æ¬¡æ•°ã€‚ ä½†æ˜¯ï¼Œç”±äºç¼“å­˜æœªè¢«ä¸»åŠ¨å¤±æ•ˆï¼Œå› æ­¤ACLç­–ç•¥å¯èƒ½ä¼šè¿‡æ—¶åˆ°TTLå€¼ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;h2 id=&quot;é…ç½®é¡¹&quot;&gt;&lt;a href=&quot;#é…ç½®é¡¹&quot; class=&quot;headerlink&quot; title=&quot;é…ç½®é¡¹&quot;&gt;&lt;/a&gt;é…ç½®é¡¹&lt;/h2&gt;&lt;h3 id=&quot;acl-datacenter&quot;&gt;&lt;a href=&quot;#acl-datacenter&quot; class=&quot;headerlink&quot; title=&quot;acl_datacenter&quot;&gt;&lt;/a&gt;acl_datacenter&lt;/h3&gt;&lt;p&gt;è¯¥é…ç½®é¡¹æŒ‡å®šäº†å¯¹ACLä¿¡æ¯å…·æœ‰æƒå¨æ€§çš„æ•°æ®ä¸­å¿ƒã€‚ å¿…é¡»æä¾›å®ƒæ‰èƒ½å¯ç”¨ACLã€‚ æ‰€æœ‰Serverå®ä¾‹å’Œæ•°æ®ä¸­å¿ƒå¿…é¡»å°±ACLæ•°æ®ä¸­å¿ƒè¾¾æˆä¸€è‡´ã€‚&lt;br&gt;å¿…é¡»åœ¨æ•´ä¸ªé›†ç¾¤çš„ServerèŠ‚ç‚¹ä¸Šè®¾ç½®è¯¥é…ç½®é¡¹ã€‚ä½†æ˜¯é’ˆå¯¹APIæ¥è¯´ï¼Œå¦‚æœè¦ä½¿å®¢æˆ·ç«¯çš„è¯·æ±‚èƒ½è¢«æ­£ç¡®è½¬å‘ï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦åœ¨å®¢æˆ·ç«¯èŠ‚ç‚¹è®¾ç½®ã€‚&lt;br&gt;åœ¨Consul 0.8åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œè¿˜å¯ä»¥å¯ç”¨ä»£ç†çº§åˆ«çš„ACLã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…&lt;a href=&quot;https://www.consul.io/docs/guides/acl.html&quot;&gt;ACLæŒ‡å—&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&quot;acl-default-policy&quot;&gt;&lt;a href=&quot;#acl-default-policy&quot; class=&quot;headerlink&quot; title=&quot;acl_default_policy&quot;&gt;&lt;/a&gt;acl_default_policy&lt;/h3&gt;&lt;p&gt;è¯¥é…ç½®é¡¹å¯é€‰çš„å€¼ä¸º&lt;code&gt;allow&lt;/code&gt;å’Œ&lt;code&gt;deny&lt;/code&gt;ã€‚é»˜è®¤å€¼ä¸ºâ€™allowâ€™ã€‚é»˜è®¤çš„ç­–ç•¥æ§åˆ¶tokenåœ¨æ²¡æœ‰åŒ¹é…çš„è§„åˆ™æ—¶çš„è¡Œä¸ºã€‚&lt;br&gt;åœ¨&lt;code&gt;allow&lt;/code&gt;æ¨¡å¼ä¸‹ï¼ŒACLè§„åˆ™æ˜¯ä¸€ä¸ªé»‘åå•ï¼šä»»ä½•æ²¡æœ‰è¢«ç¦æ­¢çš„æ“ä½œéƒ½æ˜¯å¯ä»¥æ‰§è¡Œçš„ã€‚&lt;br&gt;åœ¨&lt;code&gt;deny&lt;/code&gt;æ¨¡å¼ä¸‹ï¼ŒACLè§„åˆ™æ˜¯ä¸€ä¸ªç™½åå•ï¼Œä»»ä½•æ²¡æœ‰æ˜ç¡®æŒ‡å®šçš„æ“ä½œéƒ½æ˜¯è¢«ç¦æ­¢çš„ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼šè¯¥é…ç½®é¡¹åªæœ‰åœ¨é…ç½®äº†&lt;code&gt;acl_datacenter&lt;/code&gt;åæ‰èµ·ä½œç”¨&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="consul" scheme="https://leokongwq.github.io/tags/consul/"/>
    
  </entry>
  
  <entry>
    <title>springcloudæœåŠ¡æ³¨å†Œä¹‹consul</title>
    <link href="https://leokongwq.github.io/2018/07/08/spring-cloud-consul.html"/>
    <id>https://leokongwq.github.io/2018/07/08/spring-cloud-consul.html</id>
    <published>2018-07-08T05:28:16.000Z</published>
    <updated>2018-07-09T02:59:36.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä½¿ç”¨springcloudæ„å»ºå¾®æœåŠ¡ï¼Œé™¤äº†å¯ä»¥ä½¿ç”¨eurekaæ¥å®ç°æœåŠ¡æ³¨å†Œå’Œå‘ç°å¤–ï¼Œspringcloudå¯¹consulä¹Ÿæä¾›äº†è‰¯å¥½çš„æ”¯æŒã€‚æœ¬æ–‡å°±ç®€å•ä»‹ç»ä¸‹ä½¿ç”¨springcloudå’Œconsulå®ç°æœåŠ¡æ³¨å†Œå’Œå‘ç°ã€‚</p>
<h3 id="consulå®‰è£…"><a href="#consulå®‰è£…" class="headerlink" title="consulå®‰è£…"></a>consulå®‰è£…</h3><p>consulçš„å®‰è£…éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨å®˜ç½‘<a href="https://www.consul.io/downloads.html" target="_blank" rel="external">ä¸‹è½½</a>å¯¹åº”å¹³å°çš„å®‰è£…æ–‡ä»¶å³å¯ã€‚</p>
<p>å…·ä½“å®‰è£…æ­¥éª¤å‚è€ƒ<a href="https://www.consul.io/intro/getting-started/install.html" target="_blank" rel="external">install</a></p>
<a id="more"></a>
<h3 id="æœåŠ¡æ³¨å†Œ"><a href="#æœåŠ¡æ³¨å†Œ" class="headerlink" title="æœåŠ¡æ³¨å†Œ"></a>æœåŠ¡æ³¨å†Œ</h3><h4 id="maven-é…ç½®"><a href="#maven-é…ç½®" class="headerlink" title="maven é…ç½®"></a>maven é…ç½®</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
</pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span>
<span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span>
<span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span>
<span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>Camden.SR6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span>
<span class="line">           <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span>
<span class="line">           <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span>
<span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span>
<span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span>
<span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span>
<span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span>
<span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span>
</pre></td></tr></table></figure>
<h4 id="ç›¸å…³æ³¨è§£é…ç½®"><a href="#ç›¸å…³æ³¨è§£é…ç½®" class="headerlink" title="ç›¸å…³æ³¨è§£é…ç½®"></a>ç›¸å…³æ³¨è§£é…ç½®</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
</pre></td><td class="code"><pre><span class="line"></span>
<span class="line"><span class="meta">@EnableDiscoveryClient</span></span>
<span class="line"><span class="meta">@SpringBootApplication</span></span>
<span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span>
<span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span>
<span class="line">		SpringApplication.run(Application.class, args);</span>
<span class="line">	&#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h4 id="application-propertiesé…ç½®"><a href="#application-propertiesé…ç½®" class="headerlink" title="application.propertiesé…ç½®"></a>application.propertiesé…ç½®</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
</pre></td><td class="code"><pre><span class="line">#é»˜è®¤å°±æ˜¯true</span>
<span class="line">spring.cloud.consul.enabled=true</span>
<span class="line">spring.cloud.consul.host=127.0.0.1</span>
<span class="line">spring.cloud.consul.port=8500</span>
<span class="line">#é»˜è®¤å°±æ˜¯true</span>
<span class="line">spring.cloud.consul.discovery.enabled=true</span>
<span class="line">#æœåŠ¡å</span>
<span class="line">spring.cloud.consul.discovery.serviceName=$&#123;spring.application.name&#125;</span>
<span class="line">#æœåŠ¡æ³¨å†Œå®ä¾‹å</span>
<span class="line">spring.cloud.consul.discovery.instanceId=$&#123;spring.application.name&#125;-$&#123;spring.cloud.client.ipAddress&#125;-$&#123;server.port&#125;</span>
<span class="line">#æœåŠ¡æ‰€åœ¨çš„ä¸»æœºå</span>
<span class="line">spring.cloud.consul.discovery.hostname=$&#123;spring.cloud.client.ipAddress&#125;</span>
<span class="line">#æœåŠ¡æ‰€åœ¨çš„ç«¯å£</span>
<span class="line">spring.cloud.consul.discovery.port=$&#123;server.port&#125;</span>
<span class="line">#æœåŠ¡çš„å¥åº·æ£€æŸ¥url</span>
<span class="line">spring.cloud.consul.discovery.healthCheckUrl=http://localhost:$&#123;server.port&#125;/</span>
<span class="line">spring.cloud.consul.discovery.healthCheckInterval=10s</span>
<span class="line">spring.cloud.consul.discovery.healthCheckTimeout=10s</span>
<span class="line">spring.cloud.consul.discovery.healthCheckPath=/</span>
<span class="line">spring.cloud.consul.discovery.tags=dev,dev1</span>
</pre></td></tr></table></figure>
<blockquote>
<p>healthCheckUrl æ˜¯consulæ£€æŸ¥åº”ç”¨å¥åº·çŠ¶æ€çš„åœ°å€ï¼Œå¯ä»¥é€‰æ‹©ä¸€ä¸ªè‡ªå®šä¹‰åœ°å€ï¼Œ ä¹Ÿå¯ä»¥ä½¿ç”¨<code>actuator</code>æä¾›çš„<code>/health</code>åœ°å€ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¦‚æœä½ ä½¿ç”¨<code>actuator</code>æä¾›çš„<code>/health</code>åœ°å€ï¼Œåˆ™éœ€è¦ç¡®ä¿è¿”å›çš„jsonæ³¨è§£ä¸­çš„<code>status</code>å­—æ®µä¸º<code>UP</code>ã€‚ä¹Ÿå°±æ˜¯è¯´<code>actuator</code>å®æ–½å¥åº·æ£€æŸ¥çš„æ‰€æœ‰ç»„ä»¶çš„å¥åº·çŠ¶æ€éƒ½å¿…é¡»æ˜¯<code>UP</code>çŠ¶æ€ï¼Œæœ‰ä¸€ä¸ªä¸æ˜¯ï¼Œåˆ™æ•´ä¸ªè¿”å›ç•Œéƒ½å°±æ˜¯<code>DOWN</code>çŠ¶æ€ã€‚</p>
</blockquote>
<h3 id="æœåŠ¡è°ƒç”¨"><a href="#æœåŠ¡è°ƒç”¨" class="headerlink" title="æœåŠ¡è°ƒç”¨"></a>æœåŠ¡è°ƒç”¨</h3><p>propertiesæ–‡ä»¶é…ç½®å’ŒæœåŠ¡æ³¨å†Œç«¯éƒ½æ˜¯ä¸€è‡´çš„ã€‚Springçš„java Beané…ç½®ä¹ŸåŸºæœ¬ç›¸åŒã€‚</p>
<h4 id="maven-é…ç½®-1"><a href="#maven-é…ç½®-1" class="headerlink" title="maven é…ç½®"></a>maven é…ç½®</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
</pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span>
<span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-ribbon<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span>
<span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span>
<span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span>
</pre></td></tr></table></figure>
<h4 id="java-Bean-é…ç½®"><a href="#java-Bean-é…ç½®" class="headerlink" title="java Bean é…ç½®"></a>java Bean é…ç½®</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
</pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span>
<span class="line"><span class="meta">@EnableCircuitBreaker</span></span>
<span class="line"><span class="meta">@SpringBootApplication</span></span>
<span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span>
<span class="line">    </span>
<span class="line">    <span class="comment">//å¯åŠ¨è´Ÿè½½å‡è¡¡åŠŸèƒ½</span></span>
<span class="line">    <span class="meta">@Bean</span></span>
<span class="line">    <span class="meta">@LoadBalanced</span></span>
<span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span> </span>&#123;</span>
<span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span>
<span class="line">    &#125;</span>
<span class="line"></span>
<span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span>
<span class="line">        SpringApplication.run(Application.class, args);</span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>æœåŠ¡è°ƒç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
</pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span>
<span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">    <span class="meta">@Resource</span></span>
<span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span>
<span class="line"></span>
<span class="line">    <span class="meta">@HystrixCommand</span>(fallbackMethod = <span class="string">"addServiceFallback"</span>)</span>
<span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span></span>&#123;</span>
<span class="line">        <span class="comment">//urlæ ¼å¼ä¸ºæœåŠ¡å + è¯·æ±‚çš„URI</span></span>
<span class="line">        <span class="keyword">return</span> restTemplate.getForEntity(<span class="string">"http://bookservice/add?a=10&amp;b=20"</span>, String.class).getBody();</span>
<span class="line">    &#125;</span>
<span class="line"></span>
<span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addServiceFallback</span><span class="params">()</span> </span>&#123;</span>
<span class="line">        <span class="keyword">return</span> <span class="string">"error"</span>;</span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨springcloudæ„å»ºå¾®æœåŠ¡ï¼Œé™¤äº†å¯ä»¥ä½¿ç”¨eurekaæ¥å®ç°æœåŠ¡æ³¨å†Œå’Œå‘ç°å¤–ï¼Œspringcloudå¯¹consulä¹Ÿæä¾›äº†è‰¯å¥½çš„æ”¯æŒã€‚æœ¬æ–‡å°±ç®€å•ä»‹ç»ä¸‹ä½¿ç”¨springcloudå’Œconsulå®ç°æœåŠ¡æ³¨å†Œå’Œå‘ç°ã€‚&lt;/p&gt;
&lt;h3 id=&quot;consulå®‰è£…&quot;&gt;&lt;a href=&quot;#consulå®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;consulå®‰è£…&quot;&gt;&lt;/a&gt;consulå®‰è£…&lt;/h3&gt;&lt;p&gt;consulçš„å®‰è£…éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨å®˜ç½‘&lt;a href=&quot;https://www.consul.io/downloads.html&quot;&gt;ä¸‹è½½&lt;/a&gt;å¯¹åº”å¹³å°çš„å®‰è£…æ–‡ä»¶å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“å®‰è£…æ­¥éª¤å‚è€ƒ&lt;a href=&quot;https://www.consul.io/intro/getting-started/install.html&quot;&gt;install&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="web" scheme="https://leokongwq.github.io/categories/web/"/>
    
    
      <category term="spring" scheme="https://leokongwq.github.io/tags/spring/"/>
    
      <category term="springcloud" scheme="https://leokongwq.github.io/tags/springcloud/"/>
    
  </entry>
  
  <entry>
    <title>ActiveMQ å»¶è¿Ÿæ¶ˆæ¯</title>
    <link href="https://leokongwq.github.io/2018/06/27/activemq-deleyQueue.html"/>
    <id>https://leokongwq.github.io/2018/06/27/activemq-deleyQueue.html</id>
    <published>2018-06-27T15:08:31.000Z</published>
    <updated>2018-11-03T04:40:32.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æœ‰éå¸¸å¤šçš„ä¸šåŠ¡åœºæ™¯éœ€è¦ç”¨åˆ°å»¶è¿Ÿæ¶ˆæ¯åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼šè®¢å•å¾…æ”¯ä»˜æé†’ï¼Œè®¢å•è¶…æ—¶å–æ¶ˆç­‰ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ¶ˆæ¯ä¸­é—´ä»¶éƒ½æ”¯æŒå»¶è¿Ÿæ¶ˆæ¯çš„åŠŸèƒ½ï¼Œä¸ºäº†å®ç°å»¶è¿Ÿæ¶ˆæ¯ï¼Œå„è·¯å¤§ç¥ä¹Ÿæ˜¯åˆ›é€ äº†å¾ˆå¤šçš„æ–¹æ¡ˆã€‚<br>æˆ‘ä»¬çš„ç³»ç»Ÿä½¿ç”¨çš„æ˜¯ActiveMQï¼ŒActiveMQä»ç‰ˆæœ¬<code>5.4</code>å¼€å§‹æä¾›äº†æŒä¹…åŒ–çš„å»¶è¿Ÿæ¶ˆæ¯åŠŸèƒ½ã€‚ä¸‹æ–‡å°±ActiveMQæä¾›çš„å»¶è¿Ÿæ¶ˆæ¯åŠŸèƒ½è¿›è¡Œä»‹ç»ã€‚</p>
<h3 id="å¯ç”¨ActiveMQå®šæ—¶æ¶ˆæ¯åŠŸèƒ½"><a href="#å¯ç”¨ActiveMQå®šæ—¶æ¶ˆæ¯åŠŸèƒ½" class="headerlink" title="å¯ç”¨ActiveMQå®šæ—¶æ¶ˆæ¯åŠŸèƒ½"></a>å¯ç”¨ActiveMQå®šæ—¶æ¶ˆæ¯åŠŸèƒ½</h3><p>ä¸ºäº†ä½¿ç”¨ActiveMQçš„å»¶è¿Ÿæ¶ˆæ¯åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ActiveMQçš„é…ç½®æ–‡ä»¶<code>activemq.xml</code>ï¼Œ<br>åœ¨brokerèŠ‚ç‚¹ä¸Šæ·»åŠ <code>schedulerSupport=&quot;true&quot;</code>ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<a id="more"></a>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">broker</span> <span class="attr">xmlns</span>=<span class="string">"http://activemq.apache.org/schema/core"</span> <span class="attr">schedulerSupport</span>=<span class="string">"true"</span> &gt;</span></span>
<span class="line"><span class="tag">&lt;/<span class="name">broker</span>&gt;</span></span>
</pre></td></tr></table></figure>
<h3 id="åˆ›å»ºå»¶è¿Ÿæ¶ˆæ¯å¹¶å‘é€"><a href="#åˆ›å»ºå»¶è¿Ÿæ¶ˆæ¯å¹¶å‘é€" class="headerlink" title="åˆ›å»ºå»¶è¿Ÿæ¶ˆæ¯å¹¶å‘é€"></a>åˆ›å»ºå»¶è¿Ÿæ¶ˆæ¯å¹¶å‘é€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
</pre></td><td class="code"><pre><span class="line">jmsTemplate.send(orderCreatedTopic, session -&gt; &#123;</span>
<span class="line">	MapMessage orderCreatedMsg = session.createMapMessage();</span>
<span class="line">	orderCreatedMsg.setString(<span class="string">"orderCode"</span>, orderCode);</span>
<span class="line">	<span class="comment">//å»¶è¿Ÿ10åˆ†é’Ÿè¿›è¡ŒæŠ•é€’</span></span>
<span class="line">	<span class="keyword">long</span> time = <span class="number">10</span> * <span class="number">60</span> * <span class="number">1000</span>;</span>
<span class="line">	orderCreatedMsg.setLongProperty(ScheduledMessage.AMQ_SCHEDULED_DELAY, time);</span>
<span class="line">	<span class="keyword">return</span> orderCreatedMsg;</span>
<span class="line">&#125;);</span>
</pre></td></tr></table></figure>
<h3 id="å»¶æ—¶æ¶ˆæ¯å±æ€§æ€»ç»“"><a href="#å»¶æ—¶æ¶ˆæ¯å±æ€§æ€»ç»“" class="headerlink" title="å»¶æ—¶æ¶ˆæ¯å±æ€§æ€»ç»“"></a>å»¶æ—¶æ¶ˆæ¯å±æ€§æ€»ç»“</h3><p>ActiveMæä¾›äº†å¾ˆå¤šé«˜çº§çš„å»¶æ—¶æ¶ˆæ¯é…ç½®å±æ€§ï¼Œè§£é‡Šå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>ç±»å‹</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>ã€€AMQ_SCHEDULED_DELAY</td>
<td>long</td>
<td>brokeråœ¨æŠ•é€’è¯¥æ¶ˆæ¯å‰ç­‰å¾…çš„æ¯«ç§’æ•°</td>
</tr>
<tr>
<td>ã€€AMQ_SCHEDULED_PERIOD</td>
<td>long</td>
<td>æ¯æ¬¡é‡æ–°æŠ•é€’è¯¥æ¶ˆæ¯çš„æ—¶é—´é—´éš”</td>
</tr>
<tr>
<td>ã€€AMQ_SCHEDULED_REPEAT</td>
<td>int</td>
<td>é‡å¤æŠ•é€’è¯¥æ¶ˆæ¯çš„æ¬¡æ•°</td>
</tr>
<tr>
<td>ã€€AMQ_SCHEDULED_CRONã€€</td>
<td>String</td>
<td>ä½¿ç”¨ä¸€ä¸ªcronè¡¨è¾¾å¼æ¥è¡¨ç¤ºæ¶ˆæ¯æŠ•é€’çš„ç­–ç•¥</td>
</tr>
</tbody>
</table>
<p>ä¾‹å­:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
</pre></td><td class="code"><pre><span class="line">MessageProducer producer = session.createProducer(destination);</span>
<span class="line">TextMessage message = session.createTextMessage(<span class="string">"test msg"</span>);</span>
<span class="line">message.setStringProperty(ScheduledMessage.AMQ_SCHEDULED_CRON, <span class="string">"0 * * * *"</span>);</span>
<span class="line">message.setLongProperty(ScheduledMessage.AMQ_SCHEDULED_DELAY, <span class="number">1000</span>);</span>
<span class="line">message.setLongProperty(ScheduledMessage.AMQ_SCHEDULED_PERIOD, <span class="number">1000</span>);</span>
<span class="line">message.setIntProperty(ScheduledMessage.AMQ_SCHEDULED_REPEAT, <span class="number">9</span>);</span>
<span class="line">producer.send(message);</span>
</pre></td></tr></table></figure>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="http://activemq.apache.org/delay-and-schedule-message-delivery.html" target="_blank" rel="external">http://activemq.apache.org/delay-and-schedule-message-delivery.html</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;æœ‰éå¸¸å¤šçš„ä¸šåŠ¡åœºæ™¯éœ€è¦ç”¨åˆ°å»¶è¿Ÿæ¶ˆæ¯åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼šè®¢å•å¾…æ”¯ä»˜æé†’ï¼Œè®¢å•è¶…æ—¶å–æ¶ˆç­‰ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ¶ˆæ¯ä¸­é—´ä»¶éƒ½æ”¯æŒå»¶è¿Ÿæ¶ˆæ¯çš„åŠŸèƒ½ï¼Œä¸ºäº†å®ç°å»¶è¿Ÿæ¶ˆæ¯ï¼Œå„è·¯å¤§ç¥ä¹Ÿæ˜¯åˆ›é€ äº†å¾ˆå¤šçš„æ–¹æ¡ˆã€‚&lt;br&gt;æˆ‘ä»¬çš„ç³»ç»Ÿä½¿ç”¨çš„æ˜¯ActiveMQï¼ŒActiveMQä»ç‰ˆæœ¬&lt;code&gt;5.4&lt;/code&gt;å¼€å§‹æä¾›äº†æŒä¹…åŒ–çš„å»¶è¿Ÿæ¶ˆæ¯åŠŸèƒ½ã€‚ä¸‹æ–‡å°±ActiveMQæä¾›çš„å»¶è¿Ÿæ¶ˆæ¯åŠŸèƒ½è¿›è¡Œä»‹ç»ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å¯ç”¨ActiveMQå®šæ—¶æ¶ˆæ¯åŠŸèƒ½&quot;&gt;&lt;a href=&quot;#å¯ç”¨ActiveMQå®šæ—¶æ¶ˆæ¯åŠŸèƒ½&quot; class=&quot;headerlink&quot; title=&quot;å¯ç”¨ActiveMQå®šæ—¶æ¶ˆæ¯åŠŸèƒ½&quot;&gt;&lt;/a&gt;å¯ç”¨ActiveMQå®šæ—¶æ¶ˆæ¯åŠŸèƒ½&lt;/h3&gt;&lt;p&gt;ä¸ºäº†ä½¿ç”¨ActiveMQçš„å»¶è¿Ÿæ¶ˆæ¯åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ActiveMQçš„é…ç½®æ–‡ä»¶&lt;code&gt;activemq.xml&lt;/code&gt;ï¼Œ&lt;br&gt;åœ¨brokerèŠ‚ç‚¹ä¸Šæ·»åŠ &lt;code&gt;schedulerSupport=&amp;quot;true&amp;quot;&lt;/code&gt;ï¼Œå¦‚ä¸‹æ‰€ç¤º:&lt;/p&gt;
    
    </summary>
    
      <category term="æ¶ˆæ¯ä¸­é—´ä»¶" scheme="https://leokongwq.github.io/categories/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    
      <category term="MQ" scheme="https://leokongwq.github.io/tags/MQ/"/>
    
      <category term="ActiveMQ" scheme="https://leokongwq.github.io/tags/ActiveMQ/"/>
    
  </entry>
  
  <entry>
    <title>zookeeperä½¿ç”¨ä¹‹curator</title>
    <link href="https://leokongwq.github.io/2018/06/17/zookeeper-curator.html"/>
    <id>https://leokongwq.github.io/2018/06/17/zookeeper-curator.html</id>
    <published>2018-06-17T10:26:10.000Z</published>
    <updated>2018-06-24T13:48:19.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Apache <a href="http://curator.apache.org/" target="_blank" rel="external">Curator</a>æ˜¯Netflixå¼€æºçš„æ“ä½œZookeeperçš„ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§çš„å®¢æˆ·ç«¯ã€‚æä¾›äº†å¾ˆå¤šéå¸¸å¥½ç”¨çš„åŠŸèƒ½æ¥å¸®åŠ©æˆ‘ä»¬æ„å»ºåˆ†å¸ƒå¼åº”ç”¨ã€‚</p>
<h2 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h2><p>Curator æä¾›çš„åˆ†å¸ƒå¼é”åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š</p>
<ul>
<li>å¯é‡å…¥å…¬å¹³é” InterProcessMutex</li>
<li>ä¸å¯é‡å…¥çš„éå…¬å¹³é” InterProcessSemaphoreMutex</li>
<li>å¯é‡å…¥çš„è¯»å†™é” InterProcessReadWriteLock</li>
<li>é”é›†åˆ InterProcessMultiLock</li>
</ul>
<a id="more"></a>
<h3 id="InterProcessMutex"><a href="#InterProcessMutex" class="headerlink" title="InterProcessMutex"></a>InterProcessMutex</h3><p>Curatoræä¾›äº†<code>InterProcessMutex</code>æ¥å®ç°è¯¥åŠŸèƒ½ã€‚æ ·ä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><figcaption><span>InterProcessMutex</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
</pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºé”</span></span>
<span class="line">InterProcessLock lock = <span class="keyword">new</span> InterProcessMutex(client, lockPath);</span>
<span class="line"><span class="comment">//è·å–</span></span>
<span class="line">lock.acquire(<span class="number">1</span>ï¼ŒTimeUnit.SECONDS)</span>
<span class="line"><span class="keyword">try</span> &#123;</span>
<span class="line"><span class="comment">//ä¸šåŠ¡ä»£ç </span></span>
<span class="line">&#125; <span class="keyword">finally</span> &#123;</span>
<span class="line">    lock.release();</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>å®ç°åŸç†åˆ†æï¼š</p>
<p><code>InterProcessMutex</code>é€šè¿‡åˆ›å»ºä¸€ä¸ª Zookeeper ä¸´æ—¶ï¼Œé¡ºåºç»“ç‚¹æ¥å®ç°é”çš„å…¬å¹³è·å–ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
</pre></td><td class="code"><pre><span class="line"> <span class="meta">@Override</span></span>
<span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">   <span class="keyword">if</span> ( !internalLock(-<span class="number">1</span>, <span class="keyword">null</span>) ) &#123;</span>
<span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Lost connection while trying to acquire lock: "</span> + basePath);</span>
<span class="line">   &#125;</span>
<span class="line">&#125;</span>
<span class="line"></span>
<span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">internalLock</span><span class="params">(<span class="keyword">long</span> time, TimeUnit unit)</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">   <span class="comment">/*</span>
<span class="line">      Note on concurrency: a given lockData instance</span>
<span class="line">      can be only acted on by a single thread so locking isn't necessary</span>
<span class="line">   */</span></span>
<span class="line">   </span>
<span class="line">   <span class="comment">//ä¸‹é¢çš„ä»£ç å®ç°ï¼šå¯é‡å…¥æ€§ã€‚</span></span>
<span class="line">   Thread currentThread = Thread.currentThread();</span>
<span class="line">   LockData lockData = threadData.get(currentThread);</span>
<span class="line">   <span class="keyword">if</span> ( lockData != <span class="keyword">null</span> )</span>
<span class="line">   &#123;</span>
<span class="line">       <span class="comment">// re-entering </span></span>
<span class="line">       lockData.lockCount.incrementAndGet();</span>
<span class="line">       <span class="keyword">return</span> <span class="keyword">true</span>;</span>
<span class="line">   &#125;</span>
<span class="line">   <span class="comment">//åˆ›å»ºï¼šä¸´æ—¶ï¼Œé¡ºåºç»“ç‚¹ </span></span>
<span class="line">   String lockPath = internals.attemptLock(time, unit, getLockNodeBytes());</span>
<span class="line">   <span class="keyword">if</span> ( lockPath != <span class="keyword">null</span> )</span>
<span class="line">   &#123;</span>
<span class="line">       LockData newLockData = <span class="keyword">new</span> LockData(currentThread, lockPath);</span>
<span class="line">       threadData.put(currentThread, newLockData);</span>
<span class="line">       <span class="keyword">return</span> <span class="keyword">true</span>;</span>
<span class="line">   &#125;</span>
<span class="line"></span>
<span class="line">   <span class="keyword">return</span> <span class="keyword">false</span>;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>åˆ›å»ºï¼šä¸´æ—¶ï¼Œé¡ºåºç»“ç‚¹ </p>
<figure class="highlight java"><figcaption><span>LockInternals.attemptLock</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
</pre></td><td class="code"><pre><span class="line"><span class="function">String <span class="title">attemptLock</span><span class="params">(<span class="keyword">long</span> time, TimeUnit unit, <span class="keyword">byte</span>[] lockNodeBytes)</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line"><span class="keyword">while</span> ( !isDone )</span>
<span class="line">   &#123;</span>
<span class="line">       isDone = <span class="keyword">true</span>;</span>
<span class="line"></span>
<span class="line">       <span class="keyword">try</span></span>
<span class="line">       &#123;   </span>
<span class="line">           <span class="comment">// é€šè¿‡LockInternalsDriveråˆ›å»ºZookeeperç»“ç‚¹</span></span>
<span class="line">           ourPath = driver.createsTheLock(client, path, localLockNodeBytes);</span>
<span class="line">           <span class="comment">// åˆ¤æ–­æ˜¯å¦è·å–äº†é”ï¼Œ å…¶å®å°±æ˜¯åˆ¤å®šè¯¥çº¿ç¨‹åˆ›å»ºçš„ä¸´æ—¶ç»“ç‚¹çš„é¡ºåºæ˜¯å¦æœ€å°</span></span>
<span class="line">           hasTheLock = internalLockLoop(startMillis, millisToWait, ourPath);</span>
<span class="line">       &#125;</span>
<span class="line">       <span class="keyword">catch</span> ( KeeperException.NoNodeException e )</span>
<span class="line">       &#123;</span>
<span class="line">           <span class="comment">// gets thrown by StandardLockInternalsDriver when it can't find the lock node</span></span>
<span class="line">           <span class="comment">// this can happen when the session expires, etc. So, if the retry allows, just try it all again</span></span>
<span class="line">           <span class="keyword">if</span> ( client.getZookeeperClient().getRetryPolicy().allowRetry(retryCount++, System.currentTimeMillis() - startMillis, RetryLoop.getDefaultRetrySleeper()) )</span>
<span class="line">           &#123;</span>
<span class="line">               isDone = <span class="keyword">false</span>;</span>
<span class="line">           &#125;</span>
<span class="line">           <span class="keyword">else</span></span>
<span class="line">           &#123;</span>
<span class="line">               <span class="keyword">throw</span> e;</span>
<span class="line">           &#125;</span>
<span class="line">       &#125;</span>
<span class="line">   &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
<span class="line">34</span>
<span class="line">35</span>
<span class="line">36</span>
<span class="line">37</span>
<span class="line">38</span>
<span class="line">39</span>
<span class="line">40</span>
<span class="line">41</span>
<span class="line">42</span>
<span class="line">43</span>
<span class="line">44</span>
<span class="line">45</span>
<span class="line">46</span>
<span class="line">47</span>
<span class="line">48</span>
<span class="line">49</span>
<span class="line">50</span>
<span class="line">51</span>
<span class="line">52</span>
<span class="line">53</span>
<span class="line">54</span>
<span class="line">55</span>
<span class="line">56</span>
<span class="line">57</span>
<span class="line">58</span>
<span class="line">59</span>
<span class="line">60</span>
<span class="line">61</span>
<span class="line">62</span>
<span class="line">63</span>
<span class="line">64</span>
<span class="line">65</span>
<span class="line">66</span>
<span class="line">67</span>
<span class="line">68</span>
<span class="line">69</span>
<span class="line">70</span>
<span class="line">71</span>
<span class="line">72</span>
<span class="line">73</span>
<span class="line">74</span>
<span class="line">75</span>
<span class="line">76</span>
<span class="line">77</span>
</pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">internalLockLoop</span><span class="params">(<span class="keyword">long</span> startMillis, Long millisToWait, String ourPath)</span> <span class="keyword">throws</span> Exception</span>
<span class="line"></span>&#123;</span>
<span class="line">   <span class="keyword">boolean</span>     haveTheLock = <span class="keyword">false</span>;</span>
<span class="line">   <span class="keyword">boolean</span>     doDelete = <span class="keyword">false</span>;</span>
<span class="line">   <span class="keyword">try</span></span>
<span class="line">   &#123;</span>
<span class="line">       <span class="keyword">if</span> ( revocable.get() != <span class="keyword">null</span> )</span>
<span class="line">       &#123;</span>
<span class="line">           client.getData().usingWatcher(revocableWatcher).forPath(ourPath);</span>
<span class="line">       &#125;</span>
<span class="line">       <span class="comment">// å¾ªç¯æ¥è·å–é”</span></span>
<span class="line">       <span class="keyword">while</span> ( (client.getState() == CuratorFrameworkState.STARTED) &amp;&amp; !haveTheLock )</span>
<span class="line">       &#123;</span>
<span class="line">           <span class="comment">//è·å–æ‰€æœ‰çš„æ’åºåçš„å­èŠ‚ç‚¹åˆ—è¡¨ï¼ˆå‡åºæ’åˆ—ï¼‰ </span></span>
<span class="line">           List&lt;String&gt;        children = getSortedChildren();</span>
<span class="line">           String              sequenceNodeName = ourPath.substring(basePath.length() + <span class="number">1</span>); <span class="comment">// +1 to include the slash</span></span>
<span class="line">           <span class="comment">// åˆ¤æ–­è¯¥è¿›ç¨‹æˆ–çº¿ç¨‹åˆ›å»ºçš„å­èŠ‚ç‚¹ï¼šsequenceNodeName æ˜¯å¦æ˜¯ç¬¬ä¸€ä¸ª</span></span>
<span class="line">           PredicateResults    predicateResults = driver.getsTheLock(client, children, sequenceNodeName, maxLeases);</span>
<span class="line">           <span class="keyword">if</span> ( predicateResults.getsTheLock() )</span>
<span class="line">           &#123;</span>
<span class="line">               haveTheLock = <span class="keyword">true</span>;</span>
<span class="line">           &#125;</span>
<span class="line">           <span class="keyword">else</span></span>
<span class="line">           &#123;</span>
<span class="line">               String  previousSequencePath = basePath + <span class="string">"/"</span> + predicateResults.getPathToWatch();</span>
<span class="line">                <span class="comment">// JVM è¿›ç¨‹èƒ½åŒæ­¥ï¼Œ</span></span>
<span class="line">               <span class="keyword">synchronized</span>(<span class="keyword">this</span>)</span>
<span class="line">               &#123;</span>
<span class="line">                   <span class="keyword">try</span> </span>
<span class="line">                   &#123;</span>
<span class="line">                       <span class="comment">// use getData() instead of exists() to avoid leaving unneeded watchers which is a type of resource leak</span></span>
<span class="line">                       client.getData().usingWatcher(watcher).forPath(previousSequencePath);</span>
<span class="line">                       <span class="keyword">if</span> ( millisToWait != <span class="keyword">null</span> )</span>
<span class="line">                       &#123;</span>
<span class="line">                           millisToWait -= (System.currentTimeMillis() - startMillis);</span>
<span class="line">                           startMillis = System.currentTimeMillis();</span>
<span class="line">                           <span class="keyword">if</span> ( millisToWait &lt;= <span class="number">0</span> )</span>
<span class="line">                           &#123;</span>
<span class="line">                               doDelete = <span class="keyword">true</span>;    <span class="comment">// timed out - delete our node</span></span>
<span class="line">                               <span class="keyword">break</span>;</span>
<span class="line">                           &#125;</span>
<span class="line">                            <span class="comment">// çº¿ç¨‹è¶…æ—¶ç­‰å¾…</span></span>
<span class="line">                           wait(millisToWait);</span>
<span class="line">                       &#125;</span>
<span class="line">                       <span class="keyword">else</span></span>
<span class="line">                       &#123;</span>
<span class="line">                          <span class="comment">// çº¿ç¨‹ç­‰å¾…(éœ€è¦å…¶å®ƒçº¿ç¨‹å”¤é†’ï¼Œå…¶å®ƒçº¿ç¨‹åœ¨é‡Šæ”¾é”æ—¶ä¼šè¿›è¡Œå”¤é†’)</span></span>
<span class="line">                           wait();</span>
<span class="line">                       &#125;</span>
<span class="line">                       </span>
<span class="line">                        <span class="comment">//  watcher çš„æ‰§è¡Œåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œä¼šå”¤é†’ç­‰å¾…é”çš„çº¿ç¨‹</span></span>
<span class="line">                   &#125;</span>
<span class="line">                   <span class="keyword">catch</span> ( KeeperException.NoNodeException e ) </span>
<span class="line">                   &#123;</span>
<span class="line">                       <span class="comment">// it has been deleted (i.e. lock released). Try to acquire again</span></span>
<span class="line">                   &#125;</span>
<span class="line">               &#125;</span>
<span class="line">           &#125;</span>
<span class="line">       &#125;</span>
<span class="line">   &#125;</span>
<span class="line">   <span class="keyword">catch</span> ( Exception e )</span>
<span class="line">   &#123;   </span>
<span class="line">        <span class="comment">// å¤„ç†çº¿ç¨‹ä¸­æ–­  </span></span>
<span class="line">       ThreadUtils.checkInterrupted(e);</span>
<span class="line">       doDelete = <span class="keyword">true</span>;</span>
<span class="line">       <span class="keyword">throw</span> e;</span>
<span class="line">   &#125;</span>
<span class="line">   <span class="keyword">finally</span></span>
<span class="line">   &#123;</span>
<span class="line">        <span class="comment">//è¢«ä¸­æ–­åï¼Œåˆ é™¤ç»“ç‚¹ï¼Œé‡Šæ”¾é”ï¼ˆä¸€ç‚¹ä¼šåˆ é™¤æˆåŠŸï¼Œå…·ä½“å®ç°æŸ¥è¯¢æºä»£ç ï¼‰</span></span>
<span class="line">       <span class="keyword">if</span> ( doDelete )</span>
<span class="line">       &#123;</span>
<span class="line">           deleteOurPath(ourPath);</span>
<span class="line">       &#125;</span>
<span class="line">   &#125;</span>
<span class="line">   <span class="keyword">return</span> haveTheLock;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h3 id="InterProcessSemaphoreMutex"><a href="#InterProcessSemaphoreMutex" class="headerlink" title="InterProcessSemaphoreMutex"></a>InterProcessSemaphoreMutex</h3><p>è¯¥åŠŸèƒ½çš„é”æ˜¯ç”±ï¼š<code>InterProcessSemaphoreMutex</code>å®ç°çš„ï¼Œå…·ä½“åŸç†å°±ä¸åˆ†æä»£ç ã€‚</p>
<p>æä¸€å¥ï¼šè¯¥é”çš„åŠŸèƒ½æ˜¯é€šè¿‡ï¼š<code>InterProcessMutex</code>å’Œ<code>InterProcessSemaphoreV2</code>å®ç°çš„ã€‚</p>
<p><code>InterProcessSemaphoreV2</code>ï¼šä»åç§°ä¸Šæ¥è¯´ï¼Œè¯¥ç±»æ˜¯ä¸€ä¸ªä¿¡å·é‡ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå¯ä»¥æä¾›Nä¸ªå¯ç”¨çš„è®¸å¯ï¼Œå¯ä»¥ç”¨æ¥ç®¡ç†åŒæ—¶è®¿é—®å…±äº«èµ„æºçš„å¹¶å‘æ•°ã€‚</p>
<blockquote>
<p>è®¸å¯æ•°é‡ä¸º:1çš„ä¿¡å·é‡å¯ä»¥å½“åšé”æ¥ç”¨ã€‚</p>
</blockquote>
<h3 id="InterProcessReadWriteLock"><a href="#InterProcessReadWriteLock" class="headerlink" title="InterProcessReadWriteLock"></a>InterProcessReadWriteLock</h3><p>è¯»å†™é”å’ŒJDKæä¾›çš„ï¼š<code>ReadWriteLock</code>åŠŸèƒ½æ˜¯ç±»ä¼¼çš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
</pre></td><td class="code"><pre><span class="line"> <span class="meta">@Test</span></span>
<span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testReadWriteLock</span><span class="params">()</span> </span>&#123;</span>
<span class="line">   String lockPath = <span class="string">"/config/lock/123"</span>;</span>
<span class="line">   InterProcessReadWriteLock readWriteLock = <span class="keyword">new</span> InterProcessReadWriteLock(client, lockPath);</span>
<span class="line"></span>
<span class="line">   InterProcessMutex readLock = readWriteLock.readLock();</span>
<span class="line">   InterProcessMutex writeLock = readWriteLock.writeLock();</span>
<span class="line"></span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>ç‰¹ç‚¹æ€»ç»“ï¼š</p>
<ol>
<li>å¯é‡å…¥ï¼Œè¯»é”å’Œå†™é”éƒ½æ˜¯å¯é‡å…¥çš„ã€‚</li>
<li>è¯»é”éäº’æ–¥ï¼Œå†™é”æ˜¯äº’æ–¥çš„ï¼Œåªèƒ½æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è·å–</li>
<li>è¯»å†™æ˜¯äº’æ–¥çš„</li>
<li>æ”¯æŒé”é™çº§ã€‚æ”¯æŒå†™é”é™çº§ä¸ºè¯»é”ï¼Œè¯»é”ä¸èƒ½å‡çº§ä¸ºå†™é”ã€‚</li>
</ol>
<h3 id="InterProcessMultiLock"><a href="#InterProcessMultiLock" class="headerlink" title="InterProcessMultiLock"></a>InterProcessMultiLock</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
</pre></td><td class="code"><pre><span class="line">InterProcessMultiLock lock = <span class="keyword">new</span> InterProcessMultiLock(List&lt;InterProcessLock&gt; locks);</span>
<span class="line"></span>
<span class="line">æˆ–</span>
<span class="line"></span>
<span class="line">InterProcessMultiLock lock = <span class="keyword">new</span> InterProcessMultiLock(CuratorFramework client,</span>
<span class="line">                             List&lt;String&gt; paths);</span>
</pre></td></tr></table></figure>
<p><code>InterProcessMultiLock</code>ç»´æŠ¤ä¸€ç»„é”ã€‚åœ¨è·å–é”æ—¶ï¼Œåªæœ‰è·å–æ‰€æœ‰çš„é”æ—¶æ‰è¿”å›ï¼Œé‡Šæ”¾æ—¶ä¼šé‡Šæ”¾æ‰€æœ‰çš„é”ã€‚</p>
<h2 id="Leaderé€‰ä¸¾"><a href="#Leaderé€‰ä¸¾" class="headerlink" title="Leaderé€‰ä¸¾"></a>Leaderé€‰ä¸¾</h2><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒLeaderé€‰ä¸¾æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€å’Œé‡è¦çš„èƒ½åŠ›ã€‚é€šè¿‡Zookeeperå’ŒCuratorèƒ½éå¸¸å®¹æ˜“çš„å®ç°Leaderé€‰ä¸¾ã€‚</p>
<p>Curatoræä¾›äº†ä¸¤ç§æœºåˆ¶æ¥å®ç°Leaderé€‰ä¸¾ï¼š</p>
<h3 id="æ–¹æ³•ä¸€ï¼šLeaderSelector"><a href="#æ–¹æ³•ä¸€ï¼šLeaderSelector" class="headerlink" title="æ–¹æ³•ä¸€ï¼šLeaderSelector"></a>æ–¹æ³•ä¸€ï¼šLeaderSelector</h3><p>ç›´æ¥ä¸Šä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
<span class="line">34</span>
<span class="line">35</span>
<span class="line">36</span>
<span class="line">37</span>
<span class="line">38</span>
<span class="line">39</span>
<span class="line">40</span>
<span class="line">41</span>
<span class="line">42</span>
<span class="line">43</span>
<span class="line">44</span>
<span class="line">45</span>
<span class="line">46</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String leaderSelectionPath = <span class="string">"/config/vip/db/master"</span>;</span>
<span class="line"></span>
<span class="line"><span class="meta">@Test</span></span>
<span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLeaderElection</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">   ExecutorService threadPool = Executors.newFixedThreadPool(<span class="number">5</span>);</span>
<span class="line"></span>
<span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span>
<span class="line">       threadPool.execute(<span class="keyword">new</span> Contender(buildLeaderSelectorListener()));</span>
<span class="line">   &#125;</span>
<span class="line"></span>
<span class="line">   Thread.sleep(<span class="number">1000</span> * <span class="number">1000</span>);</span>
<span class="line"></span>
<span class="line">   threadPool.shutdown();</span>
<span class="line">&#125;</span>
<span class="line"><span class="comment">/**</span>
<span class="line">* å…¬å¹³çš„é€‰ä¸¾ï¼ˆé¡ºåºæ€§ï¼‰</span>
<span class="line">*/</span></span>
<span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Contender</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span>
<span class="line">   <span class="keyword">private</span> LeaderSelectorListener listener;</span>
<span class="line"></span>
<span class="line">   Contender(LeaderSelectorListener listener) &#123;</span>
<span class="line">       <span class="keyword">this</span>.listener = listener;</span>
<span class="line">   &#125;</span>
<span class="line"></span>
<span class="line">   <span class="meta">@Override</span></span>
<span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span>
<span class="line">       LeaderSelector selector = <span class="keyword">new</span> LeaderSelector(client, leaderSelectionPath, listener);</span>
<span class="line">       <span class="comment">// è‡ªåŠ¨åŠ å…¥Leaderé€‰ä¸¾</span></span>
<span class="line">       selector.autoRequeue();</span>
<span class="line">       <span class="comment">//å¼€å§‹è¿›è¡Œé€‰ä¸¾ï¼Œä¸è¿‡è¯¥æ–¹æ³•ä¼šç«‹å³è¿”å›ã€‚é€‰ä¸¾çš„ç»“æœæ˜¯é€šè¿‡å¼‚æ­¥å›è°ƒå®ç°çš„</span></span>
<span class="line">       selector.start();</span>
<span class="line">   &#125;</span>
<span class="line">&#125;</span>
<span class="line"><span class="function"><span class="keyword">private</span> LeaderSelectorListener <span class="title">buildLeaderSelectorListener</span><span class="params">()</span> </span>&#123;</span>
<span class="line">   LeaderSelectorListener listener = <span class="keyword">new</span> LeaderSelectorListenerAdapter() &#123;</span>
<span class="line">        <span class="comment">//è¯¥æ–¹æ³•åªæœ‰åœ¨è¯¥å®¢æˆ·ç«¯è¢«é€‰ä¸ºLeaderæ‰ä¼šè¢«è°ƒç”¨ã€‚</span></span>
<span class="line">        <span class="comment">//æ–¹æ³•è¿”å›å°±è¡¨ç¤ºå®¢æˆ·ç«¯æ”¾å¼ƒLeaderè§’è‰²ã€‚</span></span>
<span class="line">       <span class="meta">@Override</span></span>
<span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">takeLeadership</span><span class="params">(CuratorFramework client)</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">          <span class="comment">// æ¨¡å¼ä¸šåŠ¡æ“ä½œ</span></span>
<span class="line">            System.out.println(<span class="string">"Current Leader is : "</span> + Thread.currentThread().getName());</span>
<span class="line">           Thread.sleep(<span class="number">5000</span>)</span>
<span class="line">       &#125;</span>
<span class="line">   &#125;;</span>
<span class="line">   <span class="keyword">return</span> listener;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h3 id="æ–¹æ³•äºŒï¼šLeaderLatch"><a href="#æ–¹æ³•äºŒï¼šLeaderLatch" class="headerlink" title="æ–¹æ³•äºŒï¼šLeaderLatch"></a>æ–¹æ³•äºŒï¼šLeaderLatch</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
<span class="line">34</span>
<span class="line">35</span>
<span class="line">36</span>
<span class="line">37</span>
<span class="line">38</span>
<span class="line">39</span>
<span class="line">40</span>
<span class="line">41</span>
<span class="line">42</span>
<span class="line">43</span>
<span class="line">44</span>
<span class="line">45</span>
<span class="line">46</span>
<span class="line">47</span>
<span class="line">48</span>
<span class="line">49</span>
<span class="line">50</span>
<span class="line">51</span>
<span class="line">52</span>
<span class="line">53</span>
<span class="line">54</span>
<span class="line">55</span>
<span class="line">56</span>
<span class="line">57</span>
</pre></td><td class="code"><pre><span class="line"> <span class="meta">@Test</span></span>
<span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLeaderRandomElection</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">   ExecutorService threadPool = Executors.newFixedThreadPool(<span class="number">5</span>);</span>
<span class="line"></span>
<span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span>
<span class="line">       LeaderLatch leaderLatch = <span class="keyword">new</span> LeaderLatch(client, leaderSelectionPath, String.valueOf(i));</span>
<span class="line">       threadPool.execute(<span class="keyword">new</span> RandomSelectLeader(leaderLatch));</span>
<span class="line">   &#125;</span>
<span class="line"></span>
<span class="line">   Thread.sleep(<span class="number">1000</span> * <span class="number">1000</span>);</span>
<span class="line"></span>
<span class="line">   threadPool.shutdown();</span>
<span class="line">&#125;</span>
<span class="line"></span>
<span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomSelectLeader</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">   <span class="keyword">private</span> LeaderLatch leaderLatch;</span>
<span class="line"></span>
<span class="line">   RandomSelectLeader(LeaderLatch leaderLatch) &#123;</span>
<span class="line">       <span class="keyword">this</span>.leaderLatch = leaderLatch;</span>
<span class="line">   &#125;</span>
<span class="line"></span>
<span class="line">   <span class="meta">@Override</span></span>
<span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span>
<span class="line">       <span class="keyword">try</span> &#123;</span>
<span class="line">           <span class="comment">//å¼ºçƒˆå»ºè®®æ·»åŠ Listeneræ¥ç›‘å¬é“¾æ¥å˜åŒ–ï¼Œã€€å¤„ç†Leaderä¸¢å¤±é—®é¢˜</span></span>
<span class="line">           leaderLatch.addListener(<span class="keyword">new</span> LeaderLatchListener() &#123;</span>
<span class="line">               <span class="meta">@Override</span></span>
<span class="line">               <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">isLeader</span><span class="params">()</span> </span>&#123;</span>
<span class="line">                   System.out.println(<span class="string">"I'am Selected to be a Leader"</span> + Thread.currentThread().getName());</span>
<span class="line">               &#125;</span>
<span class="line"></span>
<span class="line">               <span class="meta">@Override</span></span>
<span class="line">               <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notLeader</span><span class="params">()</span> </span>&#123;</span>
<span class="line">                   System.out.println(<span class="string">"I'am Not Leader"</span> + Thread.currentThread().getName());</span>
<span class="line">               &#125;</span>
<span class="line">           &#125;);</span>
<span class="line">           <span class="comment">//è°ƒç”¨è¯¥æ–¹æ³•åæ‰èƒ½å¼€å§‹å‚ä¸é€‰ä¸¾ï¼ˆéšæœºçš„ï¼‰</span></span>
<span class="line">           leaderLatch.start();</span>
<span class="line">           <span class="comment">//æ­»ç­‰ï¼Œã€€ç›´åˆ°è¢«é€‰ä¸ºLeader</span></span>
<span class="line">           leaderLatch.await();</span>
<span class="line"></span>
<span class="line">           System.out.println(<span class="string">"Current Leader is : "</span> + Thread.currentThread().getName());</span>
<span class="line"></span>
<span class="line">           Thread.sleep(<span class="number">2000</span>);</span>
<span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span>
<span class="line">           e.printStackTrace();</span>
<span class="line">       &#125; <span class="keyword">finally</span> &#123;</span>
<span class="line">           <span class="keyword">try</span> &#123;</span>
<span class="line">               <span class="comment">// é€€å‡ºé€‰ä¸¾ï¼Œå¦‚æœè‡ªå·±æ˜¯Leaderï¼Œåˆ™æ”¾å¼ƒLeaderä½ç½®ï¼Œå…¶å®ƒçš„æˆå‘˜å°±å¯ä»¥å†æ¬¡é€‰ä¸¾</span></span>
<span class="line">               leaderLatch.close();</span>
<span class="line">           &#125; <span class="keyword">catch</span> (Exception e) &#123;</span>
<span class="line">               e.printStackTrace();</span>
<span class="line">           &#125;</span>
<span class="line">       &#125;</span>
<span class="line">   &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>æ¨èä½¿ç”¨<code>LeaderSelector</code>æ¥å®ç°Leaderé€‰ä¸¾ï¼Œå› ä¸ºå‚åŠ é€‰ä¸¾çš„ç»“ç‚¹ä»£ç ç¼–å†™ç®€å•ï¼Œèƒ½è‡ªåŠ¨å®Œæˆä¸¢å¤±Leaderè§’è‰²åä»æ–°å‚åŠ é€‰ä¸¾çš„åŠŸèƒ½ï¼Œè€Œä¸”èƒ½çµæ´»çš„æ§åˆ¶é‡Šæ”¾Leaderè§’è‰²çš„æ—¶æœºã€‚</p>
<h2 id="åˆ†å¸ƒå¼æ …æ "><a href="#åˆ†å¸ƒå¼æ …æ " class="headerlink" title="åˆ†å¸ƒå¼æ …æ "></a>åˆ†å¸ƒå¼æ …æ </h2><h3 id="DistributedBarrier"><a href="#DistributedBarrier" class="headerlink" title="DistributedBarrier"></a>DistributedBarrier</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
<span class="line">34</span>
<span class="line">35</span>
<span class="line">36</span>
<span class="line">37</span>
<span class="line">38</span>
<span class="line">39</span>
<span class="line">40</span>
</pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span>
<span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDistributedBarrier</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">   String barrierPath = <span class="string">"/config/barriers"</span>;</span>
<span class="line">   DistributedBarrier barrier = <span class="keyword">new</span> DistributedBarrier(client, barrierPath);</span>
<span class="line"></span>
<span class="line">   ExecutorService executorService = Executors.newCachedThreadPool();</span>
<span class="line"></span>
<span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span>
<span class="line">       executorService.execute(<span class="keyword">new</span> Worker(barrier));</span>
<span class="line">   &#125;</span>
<span class="line"></span>
<span class="line">   Thread.sleep(<span class="number">1000</span> * <span class="number">5</span>);</span>
<span class="line"></span>
<span class="line">   <span class="comment">//ä¸»çº¿ç¨‹è®¾ç½®ç»“ç‚¹ï¼Œworkerçº¿ç¨‹ç­‰å¾…</span></span>
<span class="line">   barrier.setBarrier();</span>
<span class="line"></span>
<span class="line">   Thread.sleep(<span class="number">1000</span> * <span class="number">10</span>);</span>
<span class="line">   System.out.println(<span class="string">"ALL Done!"</span>);</span>
<span class="line"></span>
<span class="line">   barrier.removeBarrier();</span>
<span class="line">&#125;</span>
<span class="line"></span>
<span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Worker</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">   <span class="keyword">private</span> DistributedBarrier barrier;</span>
<span class="line"></span>
<span class="line">   Worker(DistributedBarrier barrier) &#123;</span>
<span class="line">       <span class="keyword">this</span>.barrier = barrier;</span>
<span class="line">   &#125;</span>
<span class="line"></span>
<span class="line">   <span class="meta">@Override</span></span>
<span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span>
<span class="line">       <span class="keyword">try</span> &#123;</span>
<span class="line">           barrier.waitOnBarrier();</span>
<span class="line">           System.out.println(Thread.currentThread().getName() + <span class="string">" &gt;&gt;&gt;&gt; Finished"</span>);</span>
<span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span>
<span class="line">           e.printStackTrace();</span>
<span class="line">       &#125;</span>
<span class="line">   &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h3 id="DistributedDoubleBarrier"><a href="#DistributedDoubleBarrier" class="headerlink" title="DistributedDoubleBarrier"></a>DistributedDoubleBarrier</h3><p>åŒæ …æ å…è®¸å®¢æˆ·ç«¯åœ¨è®¡ç®—çš„å¼€å§‹å’Œç»“æŸæ—¶åŒæ­¥ã€‚å½“è¶³å¤Ÿçš„è¿›ç¨‹åŠ å…¥åˆ°åŒæ …æ æ—¶ï¼Œè¿›ç¨‹å¼€å§‹è®¡ç®—ï¼Œ å½“è®¡ç®—å®Œæˆæ—¶ï¼Œç¦»å¼€æ …æ ã€‚</p>
<p>æ„é€ å‡½æ•°ä¸ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
</pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DistributedDoubleBarrier</span><span class="params">(CuratorFramework client,</span>
<span class="line">                                String barrierPath,</span>
<span class="line">                                <span class="keyword">int</span> memberQty)</span></span>
<span class="line">Creates the barrier abstraction. memberQty is the number of members in the barrier. When <span class="title">enter</span><span class="params">()</span> is called, it blocks until</span>
<span class="line">all members have entered. When <span class="title">leave</span><span class="params">()</span> is called, it blocks until all members have left.</span>
<span class="line">Parameters:</span>
<span class="line">client - the client</span>
<span class="line">barrierPath - path to use</span>
<span class="line">memberQty - the number of members in the barrier</span></span>
</pre></td></tr></table></figure>
<p><code>memberQty</code>æ˜¯æˆå‘˜æ•°é‡ï¼Œå½“<code>enter</code>æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œæˆå‘˜è¢«é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰çš„æˆå‘˜éƒ½è°ƒç”¨äº†<code>enter</code>ã€‚ å½“<code>leave</code>æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå®ƒä¹Ÿé˜»å¡è°ƒç”¨çº¿ç¨‹ï¼Œ ç›´åˆ°æ‰€æœ‰çš„æˆå‘˜éƒ½è°ƒç”¨äº†<code>leave</code>ã€‚</p>
<p><code>DistributedDoubleBarrier</code>ä¼šç›‘æ§è¿æ¥çŠ¶æ€ï¼Œå½“è¿æ¥æ–­æ‰æ—¶<code>enter</code>å’Œ<code>leave</code>æ–¹æ³•ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
<span class="line">34</span>
<span class="line">35</span>
<span class="line">36</span>
<span class="line">37</span>
<span class="line">38</span>
<span class="line">39</span>
<span class="line">40</span>
<span class="line">41</span>
<span class="line">42</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> QTY = <span class="number">5</span>;</span>
<span class="line"></span>
<span class="line"><span class="meta">@Test</span></span>
<span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDistributedDoubleBarrier</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">   String barrierPath = <span class="string">"/config/barriers"</span>;</span>
<span class="line"></span>
<span class="line">   ExecutorService executorService = Executors.newFixedThreadPool(QTY);</span>
<span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; QTY; i++) &#123;</span>
<span class="line">       <span class="keyword">final</span> DistributedDoubleBarrier barrier = <span class="keyword">new</span> DistributedDoubleBarrier(client, barrierPath, QTY);</span>
<span class="line">       executorService.execute(<span class="keyword">new</span> Worker(barrier));</span>
<span class="line">   &#125;</span>
<span class="line"></span>
<span class="line">   Thread.sleep(<span class="number">1000</span> * <span class="number">5</span>);</span>
<span class="line">   System.out.println(<span class="string">"ALL Done!"</span>);</span>
<span class="line"></span>
<span class="line">   executorService.shutdown();</span>
<span class="line">   executorService.awaitTermination(<span class="number">10</span>, TimeUnit.MINUTES);</span>
<span class="line">&#125;</span>
<span class="line"></span>
<span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Worker</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">   DistributedDoubleBarrier doubleBarrier;</span>
<span class="line"></span>
<span class="line">   Worker(DistributedDoubleBarrier doubleBarrier) &#123;</span>
<span class="line">       <span class="keyword">this</span>.doubleBarrier = doubleBarrier;</span>
<span class="line">   &#125;</span>
<span class="line"></span>
<span class="line">   <span class="meta">@Override</span></span>
<span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span>
<span class="line">       <span class="keyword">try</span> &#123;</span>
<span class="line">           <span class="comment">//ç­‰å¾…æ‰€æœ‰å®¢æˆ·ç«¯éƒ½åˆ°è¾¾</span></span>
<span class="line">           doubleBarrier.enter();</span>
<span class="line">           System.out.println(<span class="string">"I'am arrival"</span>);</span>
<span class="line">           System.out.println(Thread.currentThread().getName() + <span class="string">" &gt;&gt;&gt;&gt; Finished"</span>);</span>
<span class="line">           <span class="comment">//ç­‰å¾…æ‰€æœ‰å®¢æˆ·ç«¯éƒ½åˆ°è¾¾</span></span>
<span class="line">           doubleBarrier.leave();</span>
<span class="line">           System.out.println(<span class="string">"I'am leave"</span>);</span>
<span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span>
<span class="line">           e.printStackTrace();</span>
<span class="line">       &#125;</span>
<span class="line">   &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h2 id="åˆ†å¸ƒå¼è®¡æ•°å™¨"><a href="#åˆ†å¸ƒå¼è®¡æ•°å™¨" class="headerlink" title="åˆ†å¸ƒå¼è®¡æ•°å™¨"></a>åˆ†å¸ƒå¼è®¡æ•°å™¨</h2><h3 id="SharedCount"><a href="#SharedCount" class="headerlink" title="SharedCount"></a>SharedCount</h3><p><code>SharedCount</code> ç®¡ç†ä¸€ä¸ªå…±äº«çš„æ•´å‹æ•°å­—ã€‚æ‰€æœ‰ç›‘å¬è¯¥åŒä¸€ä¸ªZookeeper Pathçš„å®¢æˆ·ç«¯éƒ½èƒ½è·å–åˆ°è¯¥æ•´å‹æ•°å­—çš„æœ€æ–°å€¼ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
<span class="line">34</span>
<span class="line">35</span>
<span class="line">36</span>
<span class="line">37</span>
<span class="line">38</span>
<span class="line">39</span>
<span class="line">40</span>
<span class="line">41</span>
<span class="line">42</span>
<span class="line">43</span>
<span class="line">44</span>
<span class="line">45</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SharedCountTest</span> <span class="keyword">extends</span> <span class="title">BaseTest</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String COUNTER_PATH = <span class="string">"/config/conunter/total"</span>;</span>
<span class="line"></span>
<span class="line">    <span class="meta">@Test</span></span>
<span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSharedCount</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">        SharedCount sharedCount = <span class="keyword">new</span> SharedCount(client, COUNTER_PATH, <span class="number">0</span>);</span>
<span class="line">        sharedCount.start();</span>
<span class="line"></span>
<span class="line">        ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">3</span>);</span>
<span class="line"></span>
<span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span>
<span class="line">            <span class="keyword">final</span> SharedCount count = <span class="keyword">new</span> SharedCount(client, COUNTER_PATH, <span class="number">0</span>);</span>
<span class="line">            count.start();</span>
<span class="line">            executorService.execute(<span class="keyword">new</span> Runnable() &#123;</span>
<span class="line">                <span class="meta">@Override</span></span>
<span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span>
<span class="line">                    count.addListener(<span class="keyword">new</span> SharedCountListener() &#123;</span>
<span class="line">                        <span class="meta">@Override</span></span>
<span class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">countHasChanged</span><span class="params">(SharedCountReader sharedCount, <span class="keyword">int</span> newCount)</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">                            System.out.println(Thread.currentThread().getName() + <span class="string">"===="</span> + newCount);</span>
<span class="line">                        &#125;</span>
<span class="line"></span>
<span class="line">                        <span class="meta">@Override</span></span>
<span class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stateChanged</span><span class="params">(CuratorFramework client, ConnectionState newState)</span> </span>&#123;</span>
<span class="line">                            System.out.println(newState);</span>
<span class="line">                        &#125;</span>
<span class="line">                    &#125;);</span>
<span class="line"></span>
<span class="line">                    <span class="keyword">try</span> &#123;</span>
<span class="line">                        Thread.sleep(<span class="number">1000</span> * <span class="number">5</span>);</span>
<span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span>
<span class="line">                        e.printStackTrace();</span>
<span class="line">                    &#125;</span>
<span class="line">                &#125;</span>
<span class="line">            &#125;);</span>
<span class="line">        &#125;</span>
<span class="line">        Thread.sleep(<span class="number">1000</span> * <span class="number">3</span>);</span>
<span class="line">        sharedCount.setCount(<span class="number">123</span>);</span>
<span class="line">        Thread.sleep(<span class="number">1000</span> * <span class="number">3</span>);</span>
<span class="line">        sharedCount.setCount(<span class="number">456</span>);</span>
<span class="line">        Thread.sleep(<span class="number">1000</span> * <span class="number">20</span>);</span>
<span class="line">        sharedCount.close();</span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼š å¦‚æœè¿ç»­ä¸¤æ¬¡è°ƒç”¨<code>setCount</code>æ–¹æ³•ï¼Œåœ¨å®¢æˆ·ç«¯åªèƒ½è§‚å¯Ÿåˆ°æœ€åä¸€æ¬¡çš„ç»“æœã€‚<code>trySetCount</code> åªæœ‰å½“è¯¥å®¢æˆ·ç«¯çš„ç¼“å­˜çš„å€¼å’ŒæœåŠ¡ç«¯ä¿å­˜çš„å€¼ä¸€è‡´æ‰èƒ½è®¾ç½®æˆåŠŸï¼Œå¦åˆ™è¯¥å®¢æˆ·ç«¯çš„å€¼ä¼šè‡ªåŠ¨æ›´æ–°ï¼ˆ<code>trySetCount</code>è¿”å›falseï¼‰ã€‚</p>
</blockquote>
<h3 id="DistributedAtomicLong"><a href="#DistributedAtomicLong" class="headerlink" title="DistributedAtomicLong"></a>DistributedAtomicLong</h3><p><code>DistributedAtomicLong</code> æ˜¯ä¸€ä¸ªåŸå­æ›´æ–°çš„è®¡æ•°å™¨ã€‚å®ƒåœ¨æ›´æ–°å€¼æ—¶ï¼Œç¬¬ä¸€æ¬¡å°è¯•é‡‡ç”¨ä¹è§‚é”æœºåˆ¶ï¼Œå¦‚æœæ›´æ–°å¤±è´¥ï¼Œåˆ™ä½¿ç”¨<code>InterProcessMutex</code>æ¥å®ç°æ›´æ–°ã€‚ ä¸ç®¡é‡‡ç”¨å“ªç§æœºåˆ¶ï¼Œå®ƒéƒ½ä¼šé‡‡ç”¨é‡è¯•æœºåˆ¶ï¼Œç›´åˆ°æ›´æ–°æˆåŠŸã€‚</p>
<p>ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
<span class="line">34</span>
<span class="line">35</span>
<span class="line">36</span>
<span class="line">37</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDistributedAtomicLong</span> <span class="keyword">extends</span> <span class="title">BaseTest</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String COUNTER_PATH = <span class="string">"/config/conunter/123"</span>;</span>
<span class="line"></span>
<span class="line">    <span class="meta">@Test</span></span>
<span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDistributedAtomicLong</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">        RetryPolicy retryPolicy = <span class="keyword">new</span> RetryForever(<span class="number">10</span>);</span>
<span class="line">        DistributedAtomicLong atomicLong = <span class="keyword">new</span> DistributedAtomicLong(client, COUNTER_PATH, retryPolicy);</span>
<span class="line"></span>
<span class="line">        ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">10</span>);</span>
<span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span>
<span class="line">            <span class="keyword">final</span> RetryPolicy retryPolicyTmp = <span class="keyword">new</span> RetryForever(<span class="number">10</span>);</span>
<span class="line">            <span class="keyword">final</span> DistributedAtomicLong distCounter = <span class="keyword">new</span> DistributedAtomicLong(client, COUNTER_PATH, retryPolicyTmp);</span>
<span class="line"></span>
<span class="line">            executorService.execute(<span class="keyword">new</span> Runnable() &#123;</span>
<span class="line">                <span class="meta">@Override</span></span>
<span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span>
<span class="line">                    System.out.println(distCounter);</span>
<span class="line"></span>
<span class="line">                    AtomicValue&lt;Long&gt; result = <span class="keyword">null</span>;</span>
<span class="line">                    <span class="keyword">try</span> &#123;</span>
<span class="line">                        result = distCounter.increment();</span>
<span class="line">                        <span class="keyword">if</span> (result.succeeded()) &#123;</span>
<span class="line">                            System.out.println(Thread.currentThread().getName() + <span class="string">"===&gt; current value = "</span> + result.preValue());</span>
<span class="line">                        &#125;</span>
<span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span>
<span class="line">                        e.printStackTrace();</span>
<span class="line">                    &#125;</span>
<span class="line">                &#125;</span>
<span class="line">            &#125;);</span>
<span class="line">        &#125;</span>
<span class="line"></span>
<span class="line">        Thread.sleep(<span class="number">1000</span> * <span class="number">5</span>);</span>
<span class="line"></span>
<span class="line">        System.out.println(<span class="string">"After all current value is = "</span> + atomicLong.get().postValue());</span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨ä½¿ç”¨<code>DistributedAtomicLong</code>æ—¶ï¼Œä½ å¿…é¡»é¦–å…ˆæ£€æŸ¥<code>AtomicValue.succeeded()</code>çš„è¿”å›å€¼ã€‚å¦‚æœæ“ä½œæˆåŠŸåˆ™è¯¥æ–¹æ³•çš„è¿”å›<code>true</code>ï¼Œå¦åˆ™è¿”å›<code>false</code>ï¼Œè¡¨ç¤ºåŸå­æ›´æ–°å¤±è´¥ã€‚å¦‚æœæ›´æ–°æˆåŠŸï¼Œåˆ™å¯ä»¥é€šè¿‡<code>preValue</code>å’Œ<code>postValue</code>è·å–æ›´æ–°å‰åçš„å€¼ã€‚</p>
</blockquote>
<h2 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h2><h3 id="PathChildrenCache"><a href="#PathChildrenCache" class="headerlink" title="PathChildrenCache"></a>PathChildrenCache</h3><p><code>PathChildrenCache</code> ç”¨æ¥è§‚å¯Ÿä¸€ä¸ª<code>ZNode</code>ã€‚æ— è®ºè¯¥ç»“ç‚¹ä¸‹æ–°å¢å­èŠ‚ç‚¹ï¼Œåˆ é™¤å­èŠ‚ç‚¹è¿˜æ˜¯å­èŠ‚ç‚¹æ›´æ–°ï¼Œè·¯å¾„ç¼“å­˜éƒ½ä¼šæ›´æ–°å®ƒçš„çŠ¶æ€æ¥åŒ…å«å½“å‰çš„ç»“ç‚¹é›†åˆï¼ˆåŒ…æ‹¬çŠ¶æ€å’Œæ•°æ®ï¼‰ã€‚</p>
<p>ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PathChildrenCacheTest</span> <span class="keyword">extends</span> <span class="title">BaseTest</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CACHE_PATH = <span class="string">"/config/cache"</span>;</span>
<span class="line">    </span>
<span class="line">    <span class="meta">@Test</span></span>
<span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPathChildrenCache</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">        PathChildrenCache pathChildrenCache = <span class="keyword">new</span> PathChildrenCache(client, CACHE_PATH, <span class="keyword">true</span>);</span>
<span class="line">        pathChildrenCache.start(PathChildrenCache.StartMode.BUILD_INITIAL_CACHE);</span>
<span class="line"></span>
<span class="line">        pathChildrenCache.getListenable().addListener(<span class="keyword">new</span> PathChildrenCacheListener() &#123;</span>
<span class="line">            <span class="meta">@Override</span></span>
<span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">childEvent</span><span class="params">(CuratorFramework client, PathChildrenCacheEvent event)</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">                System.out.println(event);</span>
<span class="line">            &#125;</span>
<span class="line">        &#125;);</span>
<span class="line">        Thread.sleep(<span class="number">1000</span> * <span class="number">50</span>);</span>
<span class="line"></span>
<span class="line">        List&lt;ChildData&gt; childDataList = pathChildrenCache.getCurrentData();</span>
<span class="line">        <span class="keyword">for</span> (ChildData childData : childDataList) &#123;</span>
<span class="line">            System.out.println(childData);</span>
<span class="line">        &#125;</span>
<span class="line"></span>
<span class="line">        pathChildrenCache.close();</span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h3 id="NodeCache"><a href="#NodeCache" class="headerlink" title="NodeCache"></a>NodeCache</h3><p><code>NodeCache</code>ç”¨æ¥è§‚å¯Ÿä¸€ä¸ª<code>ZNode</code>ã€‚å½“è¯¥ç»“ç‚¹çš„æ•°æ®è¢«æ›´æ–°ï¼Œæˆ–è¢«åˆ é™¤ï¼Œ<code>NodeCache</code>ä¼šåŒæ­¥åˆ°ç»“ç‚¹å½“å‰æœ€æ–°çš„æ•°æ®ï¼Œå¦‚æœç»“ç‚¹è¢«åˆ é™¤ï¼Œåˆ™<code>NodeCache</code>åŒ…å«çš„æ•°æ®ä¸ºnullã€‚</p>
<p>ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NodeCacheTest</span> <span class="keyword">extends</span> <span class="title">BaseTest</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CACHE_NODE_PATH = <span class="string">"/config/cache/123"</span>;</span>
<span class="line"></span>
<span class="line">    <span class="meta">@Test</span></span>
<span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNodeCache</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">        <span class="keyword">final</span> NodeCache nodeCache = <span class="keyword">new</span> NodeCache(client, CACHE_NODE_PATH);</span>
<span class="line">        nodeCache.start(<span class="keyword">true</span>);</span>
<span class="line">        nodeCache.getListenable().addListener(<span class="keyword">new</span> NodeCacheListener() &#123;</span>
<span class="line">            <span class="meta">@Override</span></span>
<span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">nodeChanged</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">                System.out.println(<span class="keyword">new</span> String(nodeCache.getCurrentData().getData()));</span>
<span class="line">            &#125;</span>
<span class="line">        &#125;);</span>
<span class="line"></span>
<span class="line">        Thread.sleep(<span class="number">1000</span> * <span class="number">50</span>);</span>
<span class="line">        nodeCache.close();</span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h3 id="TreeCache"><a href="#TreeCache" class="headerlink" title="TreeCache"></a>TreeCache</h3><p><code>TreeCache</code>æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œå®ƒè¯•å›¾å°†æœåŠ¡ç«¯æŸä¸ª<code>Path</code>ä¸‹æ‰€æœ‰æ‰€æœ‰çš„ç»“ç‚¹æ•°æ®ç¼“å­˜åˆ°æœ¬åœ°ã€‚è¯¥ç±»ä¼šç›‘å¬æŒ‡å®šçš„ZKè·¯å¾„ï¼Œå¤„ç†<code>update</code>,<code>create</code>,<code>delete</code>äº‹ä»¶å¹¶æ‹‰å–æœåŠ¡ç«¯çš„æ•°æ®ã€‚ä½ å¯ä»¥é€šè¿‡æ³¨å†Œä¸€ä¸ªListeneræ¥è·å–æ•°æ®çš„å˜åŒ–é€šçŸ¥ã€‚</p>
<p>ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeCacheTest</span> <span class="keyword">extends</span> <span class="title">BaseTest</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CACHE_PATH = <span class="string">"/config/cache"</span>;</span>
<span class="line"></span>
<span class="line">    <span class="meta">@Test</span></span>
<span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTreeCache</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">        TreeCache treeCache = <span class="keyword">new</span> TreeCache(client, CACHE_PATH);</span>
<span class="line">        treeCache.getListenable().addListener(<span class="keyword">new</span> TreeCacheListener() &#123;</span>
<span class="line">            <span class="meta">@Override</span></span>
<span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">childEvent</span><span class="params">(CuratorFramework client, TreeCacheEvent event)</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">                System.out.println(event);</span>
<span class="line">            &#125;</span>
<span class="line">        &#125;);</span>
<span class="line">        treeCache.start();</span>
<span class="line"></span>
<span class="line">        Thread.sleep(<span class="number">1000</span> * <span class="number">50</span>);</span>
<span class="line"></span>
<span class="line">        Map&lt;String, ChildData&gt; dataMap = treeCache.getCurrentChildren(CACHE_PATH);</span>
<span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, ChildData&gt; entry : dataMap.entrySet()) &#123;</span>
<span class="line">            System.out.println(entry.getKey() + <span class="string">" =====ã€‹"</span> +  <span class="keyword">new</span> String(entry.getValue().getData()));</span>
<span class="line">        &#125;</span>
<span class="line">        treeCache.close();</span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h2 id="Nodes"><a href="#Nodes" class="headerlink" title="Nodes"></a>Nodes</h2><h3 id="Persistent-Node"><a href="#Persistent-Node" class="headerlink" title="Persistent Node"></a>Persistent Node</h3><p>æŒä¹…åŒ–ç»“ç‚¹æ˜¯æ•°æ®ä¿å­˜åœ¨ZookeeperæœåŠ¡ç«¯ï¼Œå¹¶ä¸”åœ¨è¿æ¥æ–­å¼€ï¼Œsessionè¿‡æœŸä»»ç„¶å­˜åœ¨çš„ç»“ç‚¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersistentNodeTest</span> <span class="keyword">extends</span> <span class="title">BaseTest</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String NODE_PATH = <span class="string">"/persons/sky"</span>;</span>
<span class="line"></span>
<span class="line">    <span class="meta">@Test</span></span>
<span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPersistentNode</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span>
<span class="line">        PersistentNode persistentNode = <span class="keyword">new</span> PersistentNode(</span>
<span class="line">            client,</span>
<span class="line">            CreateMode.PERSISTENT,</span>
<span class="line">            <span class="keyword">true</span>,</span>
<span class="line">            NODE_PATH,</span>
<span class="line">            <span class="string">"123"</span>.getBytes()</span>
<span class="line">        );</span>
<span class="line">        <span class="comment">//å¿…é¡»å…ˆè°ƒç”¨è¯¥æ–¹æ³•(è¯¥æ–¹æ³•ä¼šåˆ›å»ºç»“ç‚¹)</span></span>
<span class="line">        persistentNode.start();</span>
<span class="line"></span>
<span class="line">        System.out.println(persistentNode.getActualPath());</span>
<span class="line">        System.out.println(<span class="keyword">new</span> String(persistentNode.getData()));</span>
<span class="line">        <span class="comment">//ä¼šåˆ é™¤è¯¥ç»“ç‚¹</span></span>
<span class="line"><span class="comment">//        persistentNode.close();</span></span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h3 id="Persistent-TTL-Node"><a href="#Persistent-TTL-Node" class="headerlink" title="Persistent TTL Node"></a>Persistent TTL Node</h3><p><code>`åœ¨ä½ éœ€è¦åˆ›å»º</code>TTL<code>èŠ‚ç‚¹ï¼Œä½†ä¸æƒ³é€šè¿‡å®šæœŸè®¾ç½®æ•°æ®æ‰‹åŠ¨ä¿æŒå®ƒçš„æ´»åŠ¨çŠ¶æ€æ—¶éå¸¸æœ‰ç”¨ã€‚</code>PersistentTtlNode<code>å¯ä»¥ä¸ºä½ å®Œæˆæ­¤æ“ä½œã€‚ æ­¤å¤–ï¼Œä¿æŒæ´»åŠ¨çš„æ–¹å¼ä¸ä¼šåœ¨çˆ¶èŠ‚ç‚¹ä¸Šç”Ÿæˆç›‘è§†è§¦å‘å™¨ã€‚ å®ƒè¿˜æä¾›äº†ç±»ä¼¼</code>PersistentNode`çš„ä¿è¯ï¼Œå³ä½¿é€šè¿‡è¿æ¥å’Œä¼šè¯ä¸­æ–­ï¼ŒèŠ‚ç‚¹ä¹Ÿä¼šå°è¯•ä¿æŒåœ¨ZooKeeperä¸­ã€‚</p>
<h3 id="Group-Member"><a href="#Group-Member" class="headerlink" title="Group Member"></a>Group Member</h3><h2 id="åˆ†å¸ƒå¼é˜Ÿåˆ—"><a href="#åˆ†å¸ƒå¼é˜Ÿåˆ—" class="headerlink" title="åˆ†å¸ƒå¼é˜Ÿåˆ—"></a>åˆ†å¸ƒå¼é˜Ÿåˆ—</h2><p>ã€ã€ã€ã€</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;Apache &lt;a href=&quot;http://curator.apache.org/&quot;&gt;Curator&lt;/a&gt;æ˜¯Netflixå¼€æºçš„æ“ä½œZookeeperçš„ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§çš„å®¢æˆ·ç«¯ã€‚æä¾›äº†å¾ˆå¤šéå¸¸å¥½ç”¨çš„åŠŸèƒ½æ¥å¸®åŠ©æˆ‘ä»¬æ„å»ºåˆ†å¸ƒå¼åº”ç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åˆ†å¸ƒå¼é”&quot;&gt;&lt;a href=&quot;#åˆ†å¸ƒå¼é”&quot; class=&quot;headerlink&quot; title=&quot;åˆ†å¸ƒå¼é”&quot;&gt;&lt;/a&gt;åˆ†å¸ƒå¼é”&lt;/h2&gt;&lt;p&gt;Curator æä¾›çš„åˆ†å¸ƒå¼é”åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯é‡å…¥å…¬å¹³é” InterProcessMutex&lt;/li&gt;
&lt;li&gt;ä¸å¯é‡å…¥çš„éå…¬å¹³é” InterProcessSemaphoreMutex&lt;/li&gt;
&lt;li&gt;å¯é‡å…¥çš„è¯»å†™é” InterProcessReadWriteLock&lt;/li&gt;
&lt;li&gt;é”é›†åˆ InterProcessMultiLock&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="æ¶æ„" scheme="https://leokongwq.github.io/categories/%E6%9E%B6%E6%9E%84/"/>
    
    
      <category term="zookeeper" scheme="https://leokongwq.github.io/tags/zookeeper/"/>
    
      <category term="curator" scheme="https://leokongwq.github.io/tags/curator/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼ç³»ç»Ÿä¸€è‡´æ€§æ€»ç»“</title>
    <link href="https://leokongwq.github.io/2018/06/01/distributed-system-consitency.html"/>
    <id>https://leokongwq.github.io/2018/06/01/distributed-system-consitency.html</id>
    <published>2018-06-01T06:16:32.000Z</published>
    <updated>2018-06-01T06:19:46.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œé˜…è¯»äº†å¥½å¤šå…³äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸€è‡´æ€§çš„æ–‡ç« å’Œèµ„æ–™ï¼Œæ€»æ˜¯è¢«åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§å’Œåˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h3&gt;&lt;p&gt;åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œé˜…è¯»äº†å¥½å¤šå…³äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸€è‡´æ€§çš„æ–‡ç« å’Œèµ„æ–™ï¼Œæ€»æ˜¯è¢«åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§å’Œåˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§&lt;/p&gt;

    
    </summary>
    
      <category term="æ¶æ„" scheme="https://leokongwq.github.io/categories/%E6%9E%B6%E6%9E%84/"/>
    
    
  </entry>
  
  <entry>
    <title>springä¸­RestTemplateç®€ä»‹</title>
    <link href="https://leokongwq.github.io/2018/05/30/spring-RestTemplate.html"/>
    <id>https://leokongwq.github.io/2018/05/30/spring-RestTemplate.html</id>
    <published>2018-05-30T08:44:51.000Z</published>
    <updated>2018-05-30T09:29:42.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="RestTemplate-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#RestTemplate-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="RestTemplate æ˜¯ä»€ä¹ˆï¼Ÿ"></a>RestTemplate æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>RestTemplateæ˜¯Springæä¾›çš„ä¸€ä¸ªè®¿é—®HttpæœåŠ¡çš„å®¢æˆ·ç«¯ç±»ï¼Œéå¸¸ç±»ä¼¼JdbcTemplate, JmsTemplateã€‚å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆä¸€æ—¦åˆ›å»ºå®Œæˆï¼‰ã€‚ä»åç§°ä¸Šæ¥çœ‹ï¼Œè¯¥ç±»æ›´å¤šæ˜¯é’ˆå¯¹RESTFULé£æ ¼APIè®¾è®¡çš„ã€‚å½“ç„¶å¦‚æœä½ æƒ³é€šè¿‡å®ƒè°ƒç”¨æ™®é€šçš„Httpæ¥å£ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<h3 id="RestTemplate-çš„æ–¹æ³•"><a href="#RestTemplate-çš„æ–¹æ³•" class="headerlink" title="RestTemplate çš„æ–¹æ³•"></a>RestTemplate çš„æ–¹æ³•</h3><p>RestTemplateæä¾›çš„æ–¹æ³•éƒ½æ˜¯ä»¥Httpåè®®ä¸­çš„6ä¸ªåŠ¨è¯å¼€å¤´çš„ï¼š</p>
<img src="/2018/05/30/spring-RestTemplate/spring-template.png" alt="spring-template.png" title="">
<p>è¿™äº›æ–¹æ³•çš„åç§°æ¸…æ¥šåœ°è¡¨æ˜å®ƒä»¬è°ƒç”¨çš„æ˜¯å“ªä¸ªHTTPæ–¹æ³•ï¼Œè€Œåç§°çš„ç¬¬äºŒéƒ¨åˆ†è¡¨ç¤ºè¿”å›çš„å†…å®¹ã€‚ ä¾‹å¦‚ï¼Œ<code>getForObjectï¼ˆï¼‰</code>å°†æ‰§è¡ŒGETï¼Œå°†HTTPå“åº”è½¬æ¢ä¸ºä½ é€‰æ‹©çš„å¯¹è±¡ç±»å‹ï¼Œå¹¶è¿”å›è¯¥å¯¹è±¡ã€‚<code>postForLocation</code>å°†æ‰§è¡ŒPOSTï¼Œå°†ç»™å®šå¯¹è±¡è½¬æ¢ä¸ºHTTPè¯·æ±‚ï¼Œå¹¶è¿”å›å¯ä»¥æ‰¾åˆ°æ–°åˆ›å»ºå¯¹è±¡çš„å“åº”<code>HTTP Location</code>æ ‡å¤´ã€‚ å¦‚ä½ æ‰€è§ï¼Œè¿™äº›æ–¹æ³•è¯•å›¾å¼ºåˆ¶æ‰§è¡ŒRESTæœ€ä½³å®è·µã€‚</p>
<a id="more"></a>
<h3 id="URI-æ¨¡æ¿"><a href="#URI-æ¨¡æ¿" class="headerlink" title="URI æ¨¡æ¿"></a>URI æ¨¡æ¿</h3><p>è¿™äº›æ–¹æ³•ä¸­çš„æ¯ä¸€ä¸ªéƒ½å°†URIä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚ è¯¥URIå¯ä»¥æ˜¯URIæ¨¡æ¿ï¼Œå¯ä»¥ä½¿ç”¨å˜é‡å°†æ¨¡æ¿æ‰©å±•ä¸ºæ­£å¸¸çš„URIã€‚ æ¨¡æ¿å˜é‡å¯ä»¥ä»¥ä¸¤ç§å½¢å¼ä¼ é€’ï¼š<code>ä½œä¸ºStringå¯å˜å‚æ•°æ•°ç»„</code>ï¼Œæˆ–ä½œä¸º<code>Map &lt;Stringï¼ŒString&gt;</code>ã€‚ å­—ç¬¦ä¸²å¯å˜æ•°ç»„æŒ‰é¡ºåºå±•å¼€å¤åˆ¶ç»™æ¨¡æ¿å˜é‡ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">String result = restTemplate.getForObject(<span class="string">"http://example.com/hotels/&#123;hotel&#125;/bookings/&#123;booking&#125;"</span>, String.class, <span class="string">"42"</span>, <span class="string">"21"</span>);</span>
</pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç æœ€ç»ˆä¼šè¯·æ±‚ï¼š<a href="http://example.com/hotels/42/bookings/21" target="_blank" rel="external">http://example.com/hotels/42/bookings/21</a>ã€‚Mapç±»å‹çš„æ¨¡æ¿æ•°æ®ï¼Œåˆ™ä¼šä»¥æ¨¡æ¿å˜é‡çš„åç§°ä¸ºkey, æŸ¥è¯¢å¯¹åº”çš„å€¼æ¥åšæ›¿æ¢ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
</pre></td><td class="code"><pre><span class="line">Map&lt;String, String&gt; vars = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span>
<span class="line">vars.put(<span class="string">"hotel"</span>, <span class="string">"42"</span>);</span>
<span class="line">vars.put(<span class="string">"booking"</span>, <span class="string">"21"</span>);</span>
<span class="line">String result = restTemplate.getForObject(<span class="string">"http://example.com/hotels/&#123;hotel&#125;/bookings/&#123;booking&#125;"</span>, String.class, vars);</span>
</pre></td></tr></table></figure>
<p>æœ€ç»ˆåŒæ ·ä¼šå‘é€è¯·æ±‚ï¼š<a href="http://example.com/hotels/42/rooms/42" target="_blank" rel="external">http://example.com/hotels/42/rooms/42</a>ã€‚</p>
<h3 id="HttpMessageConverters"><a href="#HttpMessageConverters" class="headerlink" title="HttpMessageConverters"></a>HttpMessageConverters</h3><p>ä¼ é€’ç»™æ–¹æ³•<code>getForObject()</code>,<code>postForLocation()</code>,<code>put()</code>çš„æ•°æ®å¯¹è±¡ï¼Œæˆ–æ˜¯è¿™äº›æ–¹æ³•çš„è¿”å›æ•°æ®å¯¹è±¡éƒ½æ˜¯é€šè¿‡<code>HttpMessageConverter</code>è¿›è¡Œè½¬æ¢çš„ã€‚åœ¨å‘é€è¯·æ±‚æ—¶ï¼Œå°†æ•°æ®å¯¹è±¡è½¬ä¸ºHttpè¯·æ±‚æ•°æ®ï¼Œ æ¥æ”¶å“åº”æ—¶ï¼Œå°†Httpå“åº”æ•°æ®è½¬ä¸ºå¯¹åº”çš„æ•°æ®å¯¹è±¡ã€‚å…·ä½“å‚è€ƒä¸‹é¢çš„ä¾‹å­</p>
<h4 id="æœç´¢å›¾ç‰‡"><a href="#æœç´¢å›¾ç‰‡" class="headerlink" title="æœç´¢å›¾ç‰‡"></a>æœç´¢å›¾ç‰‡</h4><p>Flickrå…¬å¼€äº†å„ç§APIæ¥æ“çºµåºå¤§çš„ç…§ç‰‡åº“ã€‚<code>flickr.photos.search</code>æ–¹æ³•å…è®¸ä½ é€šè¿‡ä½¿ç”¨<code>GET</code>æ–¹æ³•è¯·æ±‚åœ°å€ï¼š<a href="http://www.flickr.com/services/rest?method=flickr.photos.search&amp;api+key=xxx&amp;tags=penguins" target="_blank" rel="external">http://www.flickr.com/services/rest?method=flickr.photos.search&amp;api+key=xxx&amp;tags=penguins</a>æ¥æœç´¢ç…§ç‰‡ï¼Œç»“æœä¼šä»¥xmlçš„å½¢å¼å±•ç¤º:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
</pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">photos</span> <span class="attr">page</span>=<span class="string">"2"</span> <span class="attr">pages</span>=<span class="string">"89"</span> <span class="attr">perpage</span>=<span class="string">"10"</span> <span class="attr">total</span>=<span class="string">"881"</span>&gt;</span></span>
<span class="line">	<span class="tag">&lt;<span class="name">photo</span> <span class="attr">id</span>=<span class="string">"2636"</span> <span class="attr">owner</span>=<span class="string">"47058503995@N01"</span> </span>
<span class="line">		<span class="attr">secret</span>=<span class="string">"a123456"</span> <span class="attr">server</span>=<span class="string">"2"</span> <span class="attr">title</span>=<span class="string">"test_04"</span></span>
<span class="line">		<span class="attr">ispublic</span>=<span class="string">"1"</span> <span class="attr">isfriend</span>=<span class="string">"0"</span> <span class="attr">isfamily</span>=<span class="string">"0"</span> /&gt;</span></span>
<span class="line">	<span class="tag">&lt;<span class="name">photo</span> <span class="attr">id</span>=<span class="string">"2635"</span> <span class="attr">owner</span>=<span class="string">"47058503995@N01"</span></span>
<span class="line">		<span class="attr">secret</span>=<span class="string">"b123456"</span> <span class="attr">server</span>=<span class="string">"2"</span> <span class="attr">title</span>=<span class="string">"test_03"</span></span>
<span class="line">		<span class="attr">ispublic</span>=<span class="string">"0"</span> <span class="attr">isfriend</span>=<span class="string">"1"</span> <span class="attr">isfamily</span>=<span class="string">"1"</span> /&gt;</span></span>
<span class="line">	<span class="tag">&lt;<span class="name">photo</span> <span class="attr">id</span>=<span class="string">"2633"</span> <span class="attr">owner</span>=<span class="string">"47058503995@N01"</span></span>
<span class="line">		<span class="attr">secret</span>=<span class="string">"c123456"</span> <span class="attr">server</span>=<span class="string">"2"</span> <span class="attr">title</span>=<span class="string">"test_01"</span></span>
<span class="line">		<span class="attr">ispublic</span>=<span class="string">"1"</span> <span class="attr">isfriend</span>=<span class="string">"0"</span> <span class="attr">isfamily</span>=<span class="string">"0"</span> /&gt;</span></span>
<span class="line">	<span class="tag">&lt;<span class="name">photo</span> <span class="attr">id</span>=<span class="string">"2610"</span> <span class="attr">owner</span>=<span class="string">"12037949754@N01"</span></span>
<span class="line">		<span class="attr">secret</span>=<span class="string">"d123456"</span> <span class="attr">server</span>=<span class="string">"2"</span> <span class="attr">title</span>=<span class="string">"00_tall"</span></span>
<span class="line">		<span class="attr">ispublic</span>=<span class="string">"1"</span> <span class="attr">isfriend</span>=<span class="string">"0"</span> <span class="attr">isfamily</span>=<span class="string">"0"</span> /&gt;</span></span>
<span class="line"><span class="tag">&lt;/<span class="name">photos</span>&gt;</span></span>
</pre></td></tr></table></figure>
<p>Javaä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> String photoSearchUrl =</span>
<span class="line">   <span class="string">"http://www.flickr.com/services/rest?method=flickr.photos.search&amp;api+key=&#123;api-key&#125;&amp;tags=&#123;tag&#125;&amp;per_page=10"</span>;</span>
<span class="line">Source photos = restTemplate.getForObject(photoSearchUrl, Source.class, apiKey, searchTerm);</span>
</pre></td></tr></table></figure>
<h3 id="ä»£ç å®ä¾‹"><a href="#ä»£ç å®ä¾‹" class="headerlink" title="ä»£ç å®ä¾‹"></a>ä»£ç å®ä¾‹</h3><h4 id="getXXX"><a href="#getXXX" class="headerlink" title="getXXX"></a>getXXX</h4><p>GETè¯·æ±‚çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line">public &lt;T&gt; T getForObject(String url, Class&lt;T&gt; responseType, Object... urlVariables) throws RestClientException </span>
<span class="line"></span>
<span class="line">public &lt;T&gt; T getForObject(String url, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; urlVariables) throws RestClientException</span>
<span class="line"></span>
<span class="line">public &lt;T&gt; T getForObject(URI url, Class&lt;T&gt; responseType) throws RestClientException</span>
</pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
</pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span>
<span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">helloGet</span><span class="params">()</span> </span>&#123;</span>
<span class="line">    ResponseEntity&lt;String&gt; responseEntity = restTemplate.getForEntity(<span class="string">"http://abc.com"</span>, String.class);</span>
<span class="line">    String body = responseEntity.getBody();</span>
<span class="line">    HttpStatus statusCode = responseEntity.getStatusCode();</span>
<span class="line">    <span class="keyword">int</span> statusCodeValue = responseEntity.getStatusCodeValue();</span>
<span class="line">    HttpHeaders headers = responseEntity.getHeaders();</span>
<span class="line">    <span class="keyword">return</span> body;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h3 id="postXXX"><a href="#postXXX" class="headerlink" title="postXXX"></a>postXXX</h3><p>POST è¯·æ±‚çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">postForObject</span><span class="params">(String url, Object request, Class&lt;T&gt; responseType, Object... uriVariables)</span> <span class="keyword">throws</span> RestClientException</span>
<span class="line"></span>
<span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title">postForObject</span><span class="params">(String url, Object request, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables)</span> <span class="keyword">throws</span> RestClientException</span>
<span class="line"></span>
<span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title">postForObject</span><span class="params">(URI url, Object request, Class&lt;T&gt; responseType)</span> <span class="keyword">throws</span> RestClientException</span></span>
</pre></td></tr></table></figure>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
</pre></td><td class="code"><pre><span class="line">HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();</span>
<span class="line">headers.add(<span class="string">"X-Auth-Token"</span>, <span class="string">"e348bc22-5efa-4299-9142-529f07a18ac9"</span>);</span>
<span class="line"></span>
<span class="line">MultiValueMap&lt;String, String&gt; postParameters = <span class="keyword">new</span> LinkedMultiValueMap&lt;String, String&gt;();</span>
<span class="line">postParameters.add(<span class="string">"owner"</span>, <span class="string">"11"</span>);</span>
<span class="line">postParameters.add(<span class="string">"subdomain"</span>, <span class="string">"aoa"</span>);</span>
<span class="line">postParameters.add(<span class="string">"comment"</span>, <span class="string">""</span>);</span>
<span class="line"></span>
<span class="line">HttpEntity&lt;MultiValueMap&lt;String, String&gt;&gt; requestEntity  = <span class="keyword">new</span> HttpEntity&lt;MultiValueMap&lt;String, String&gt;&gt;(postParameters, headers);</span>
<span class="line"></span>
<span class="line">WebResult&lt;Person&gt; result = <span class="keyword">null</span>;</span>
<span class="line"><span class="keyword">try</span> &#123;</span>
<span class="line">  result = restTemplate.postForObject(<span class="string">"è¯·æ±‚åœ°å€"</span>,  requestEntity, WebResult.class);</span>
<span class="line">  logger.info(result);</span>
<span class="line">&#125; <span class="keyword">catch</span> (RestClientException e) &#123;</span>
<span class="line">  logger.info(<span class="string">"error"</span>, e);</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h3 id="RestTemplateé…ç½®"><a href="#RestTemplateé…ç½®" class="headerlink" title="RestTemplateé…ç½®"></a>RestTemplateé…ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
</pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span>
<span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestTemplateConfig</span> </span>&#123;</span>
<span class="line"></span>
<span class="line">    <span class="meta">@Bean</span></span>
<span class="line">    <span class="meta">@ConditionalOnMissingBean</span>(&#123; RestOperations.class, RestTemplate.class &#125;)</span>
<span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">(ClientHttpRequestFactory factory)</span> </span>&#123;</span>
<span class="line">        RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate(factory);</span>
<span class="line"></span>
<span class="line">        List&lt;HttpMessageConverter&lt;?&gt;&gt; messageConverters = restTemplate.getMessageConverters();</span>
<span class="line">        Iterator&lt;HttpMessageConverter&lt;?&gt;&gt; iterator = messageConverters.iterator();</span>
<span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span>
<span class="line">            HttpMessageConverter&lt;?&gt; converter = iterator.next();</span>
<span class="line">            <span class="keyword">if</span> (converter <span class="keyword">instanceof</span> StringHttpMessageConverter) &#123;</span>
<span class="line">                iterator.remove();</span>
<span class="line">            &#125;</span>
<span class="line">        &#125;</span>
<span class="line">        messageConverters.add(<span class="keyword">new</span> StringHttpMessageConverter(Charset.forName(<span class="string">"UTF-8"</span>)));</span>
<span class="line">        restTemplate.getMessageConverters().add(<span class="keyword">new</span> MappingJackson2HttpMessageConverter());</span>
<span class="line">        <span class="keyword">return</span> restTemplate;</span>
<span class="line">    &#125;</span>
<span class="line"></span>
<span class="line">    <span class="meta">@Bean</span></span>
<span class="line">    <span class="meta">@ConditionalOnMissingBean</span>(&#123;ClientHttpRequestFactory.class&#125;)</span>
<span class="line">    <span class="function"><span class="keyword">public</span> ClientHttpRequestFactory <span class="title">simpleClientHttpRequestFactory</span><span class="params">()</span> </span>&#123;</span>
<span class="line">        SimpleClientHttpRequestFactory factory = <span class="keyword">new</span> SimpleClientHttpRequestFactory();</span>
<span class="line">        factory.setReadTimeout(<span class="number">15000</span>);<span class="comment">// ms</span></span>
<span class="line">        <span class="keyword">return</span> factory;</span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://spring.io/blog/2009/03/27/rest-in-spring-3-resttemplate" target="_blank" rel="external">https://spring.io/blog/2009/03/27/rest-in-spring-3-resttemplate</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;RestTemplate-æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;a href=&quot;#RestTemplate-æ˜¯ä»€ä¹ˆï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;RestTemplate æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;/a&gt;RestTemplate æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h3&gt;&lt;p&gt;RestTemplateæ˜¯Springæä¾›çš„ä¸€ä¸ªè®¿é—®HttpæœåŠ¡çš„å®¢æˆ·ç«¯ç±»ï¼Œéå¸¸ç±»ä¼¼JdbcTemplate, JmsTemplateã€‚å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆä¸€æ—¦åˆ›å»ºå®Œæˆï¼‰ã€‚ä»åç§°ä¸Šæ¥çœ‹ï¼Œè¯¥ç±»æ›´å¤šæ˜¯é’ˆå¯¹RESTFULé£æ ¼APIè®¾è®¡çš„ã€‚å½“ç„¶å¦‚æœä½ æƒ³é€šè¿‡å®ƒè°ƒç”¨æ™®é€šçš„Httpæ¥å£ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚&lt;/p&gt;
&lt;h3 id=&quot;RestTemplate-çš„æ–¹æ³•&quot;&gt;&lt;a href=&quot;#RestTemplate-çš„æ–¹æ³•&quot; class=&quot;headerlink&quot; title=&quot;RestTemplate çš„æ–¹æ³•&quot;&gt;&lt;/a&gt;RestTemplate çš„æ–¹æ³•&lt;/h3&gt;&lt;p&gt;RestTemplateæä¾›çš„æ–¹æ³•éƒ½æ˜¯ä»¥Httpåè®®ä¸­çš„6ä¸ªåŠ¨è¯å¼€å¤´çš„ï¼š&lt;/p&gt;
&lt;img src=&quot;/2018/05/30/spring-RestTemplate/spring-template.png&quot; alt=&quot;spring-template.png&quot; title=&quot;&quot;&gt;
&lt;p&gt;è¿™äº›æ–¹æ³•çš„åç§°æ¸…æ¥šåœ°è¡¨æ˜å®ƒä»¬è°ƒç”¨çš„æ˜¯å“ªä¸ªHTTPæ–¹æ³•ï¼Œè€Œåç§°çš„ç¬¬äºŒéƒ¨åˆ†è¡¨ç¤ºè¿”å›çš„å†…å®¹ã€‚ ä¾‹å¦‚ï¼Œ&lt;code&gt;getForObjectï¼ˆï¼‰&lt;/code&gt;å°†æ‰§è¡ŒGETï¼Œå°†HTTPå“åº”è½¬æ¢ä¸ºä½ é€‰æ‹©çš„å¯¹è±¡ç±»å‹ï¼Œå¹¶è¿”å›è¯¥å¯¹è±¡ã€‚&lt;code&gt;postForLocation&lt;/code&gt;å°†æ‰§è¡ŒPOSTï¼Œå°†ç»™å®šå¯¹è±¡è½¬æ¢ä¸ºHTTPè¯·æ±‚ï¼Œå¹¶è¿”å›å¯ä»¥æ‰¾åˆ°æ–°åˆ›å»ºå¯¹è±¡çš„å“åº”&lt;code&gt;HTTP Location&lt;/code&gt;æ ‡å¤´ã€‚ å¦‚ä½ æ‰€è§ï¼Œè¿™äº›æ–¹æ³•è¯•å›¾å¼ºåˆ¶æ‰§è¡ŒRESTæœ€ä½³å®è·µã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="web" scheme="https://leokongwq.github.io/categories/web/"/>
    
    
      <category term="spring" scheme="https://leokongwq.github.io/tags/spring/"/>
    
  </entry>
  
  <entry>
    <title>Java è™šæ‹Ÿæœºçš„å…³æœºæ–¹å¼</title>
    <link href="https://leokongwq.github.io/2018/05/28/java-JVM-shutdown.html"/>
    <id>https://leokongwq.github.io/2018/05/28/java-JVM-shutdown.html</id>
    <published>2018-05-28T07:53:53.000Z</published>
    <updated>2018-05-28T07:57:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ–‡ç« è½¬è‡ª: <a href="https://zhuanlan.zhihu.com/p/37287644" target="_blank" rel="external">Java è™šæ‹Ÿæœºçš„å…³æœºæ–¹å¼</a></p>
<p>JVM æ˜¯ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œæ—¢ç„¶æ˜¯è™šæ‹Ÿçš„æœºå™¨ï¼Œå°±å¿…ç„¶æ¶‰åŠåˆ°å…³æœºæ“ä½œã€‚JVM å…³é—­æ—¶ï¼Œé¦–å…ˆè°ƒç”¨å…³é—­é’©å­ï¼Œæ‰€æœ‰é’©å­æ‰§è¡Œå®Œæ¯•åï¼Œå¦‚æœéœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶å°±è°ƒç”¨ finalize æ–¹æ³•ï¼Œå¦åˆ™ç›´æ¥å…³é—­è™šæ‹Ÿæœºã€‚JVM å…³é—­è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šä¸­æ–­æˆ–åœæ­¢ä»»ä½•çº¿ç¨‹ï¼Œåœ¨æœ€ç»ˆå…³é—­è™šæ‹Ÿæœºæ—¶å¼ºåˆ¶å…³é—­æ‰€æœ‰çº¿ç¨‹ã€‚</p>
<a id="more"></a>
<h3 id="å…³é—­é’©å­"><a href="#å…³é—­é’©å­" class="headerlink" title="å…³é—­é’©å­"></a>å…³é—­é’©å­</h3><p>å…³é—­é’©å­æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨ JVM å…³é—­æ—¶æ‰§è¡Œçš„å›è°ƒï¼Œå¯ä»¥é€šè¿‡ Runtime.addShutdownHook è¿›è¡Œæ³¨å†Œã€‚JVM å…³é—­æ—¶é¦–å…ˆä¼šè°ƒç”¨è¿™äº›å…³é—­é’©å­ï¼Œä½†ä¸ä¼šä¿è¯å…³é—­é’©å­æ‰§è¡Œçš„é¡ºåºã€‚å…³é—­é’©å­çš„æ‰§è¡Œæ—¶é—´è¦å°½å¯èƒ½çŸ­ï¼Œä¸åº”è¯¥å†åšè€—æ—¶çš„æ“ä½œï¼Œå› ä¸ºè¿™ä¼šå½±å“ JVM çš„å…³é—­æ—¶é—´ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">Runtime.getRuntime().addShutdownHook(<span class="keyword">new</span> Thread()&#123;    <span class="comment">//TODO&#125;);</span></span>
</pre></td></tr></table></figure>
<p>å¦‚æœè°ƒç”¨å…³é—­é’©å­æ—¶è¿˜æœ‰çº¿ç¨‹åœ¨è¿è¡Œï¼Œé‚£ä¹ˆå…³é—­é’©å­å°†å’Œè¿™äº›çº¿ç¨‹åŒæ—¶è¿è¡Œã€‚å› æ­¤ï¼Œå…³é—­é’©å­çš„æ“ä½œå¿…é¡»ä¿è¯æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè®¿é—®æ•°æ®éœ€è¦ä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼Œè¦é¿å…æ­»é”ã€‚åŒæ—¶ï¼Œå…³é—­é’©å­éœ€è¦è€ƒè™‘ JVM å…³é—­çš„æ‰€æœ‰å¯èƒ½æ€§ï¼Œä¸èƒ½å‡è®¾å…³é—­çš„åŸå› ï¼Œä¹Ÿä¸åº”è¯¥å°è¯•å»åˆ†æ JVM å…³é—­çš„åŸå› ã€‚å…³é—­é’©å­é€šå¸¸ç”¨äºæœåŠ¡çš„æ¸…ç†å·¥ä½œï¼Œå¦‚ dubbo ä½¿ç”¨å…³é—­é’©å­æ¥å…³é—­è¿æ¥å¹¶é€šçŸ¥æ³¨å†Œä¸­å¿ƒæ³¨é”€æœåŠ¡ã€‚ä½†å…³é—­é’©å­æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œéœ€è¦è€ƒè™‘å¤šä¸ªé’©å­ä¹‹é—´çš„ç›¸äº’å½±å“ï¼Œå¦‚æå‰å…³é—­æ—¥å¿—æœåŠ¡å¯èƒ½å¯¼è‡´å…¶ä»–é’©å­æˆ–çº¿ç¨‹æ— æ³•å†ä½¿ç”¨æ—¥å¿—ã€‚å»ºè®®åªä½¿ç”¨ä¸€ä¸ªå…³é—­é’©å­æ¥å¤„ç†æ‰€æœ‰çš„äº‹æƒ…ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä»»åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œä»è€Œé¿å…å¤šä¸ªé’©å­ä¹‹é—´çš„ç«äº‰å’Œæ­»é”ã€‚</p>
<h3 id="å®ˆæŠ¤çº¿ç¨‹"><a href="#å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="å®ˆæŠ¤çº¿ç¨‹"></a>å®ˆæŠ¤çº¿ç¨‹</h3><p>Java ä¸­çš„çº¿ç¨‹åˆ†ä¸ºæ™®é€šçº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ã€‚ä¸€ä¸ªçº¿ç¨‹è¢«åˆ›å»ºæ—¶ä¼šç»§æ‰¿åˆ›å»ºå®ƒçš„é‚£ä¸ªçº¿ç¨‹çš„å®ˆæŠ¤çŠ¶æ€ã€‚JVM å¯åŠ¨æ—¶åˆ›å»ºçš„çº¿ç¨‹é™¤äº†ä¸»çº¿ç¨‹æ˜¯æ™®é€šçº¿ç¨‹ï¼Œå…¶ä»–çº¿ç¨‹ï¼ˆå¦‚ GC ç­‰ï¼‰éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚å½“çº¿ç¨‹é€€å‡ºæ—¶ï¼ŒJVM ä¼šæ£€æŸ¥å‰©ä½™çº¿ç¨‹çš„çŠ¶æ€ï¼Œå¦‚æœå‰©ä½™çš„çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹å·²ç»æ²¡æœ‰æ™®é€šçº¿ç¨‹ï¼Œé‚£ä¹ˆ JVM ä¼šè¿›è¡Œå…³é—­æ“ä½œã€‚JVM æœ€ç»ˆå…³é—­æ—¶ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¼šè¢«ç›´æ¥æŠ›å¼ƒï¼Œæ—¢ä¸ä¼šæ‰§è¡Œ finally ä¹Ÿä¸ä¼šæ‰§è¡Œå›å·æ ˆã€‚å› æ­¤åº”è¯¥å°½é‡ä¸è¦ä½¿ç”¨å®ˆæŠ¤çº¿ç¨‹ï¼Œä½¿ç”¨æ—¶ä¹Ÿåº”è¯¥è¿›è¡Œç®€å•çš„æ“ä½œã€‚</p>
<h3 id="åƒåœ¾å›æ”¶JVM"><a href="#åƒåœ¾å›æ”¶JVM" class="headerlink" title="åƒåœ¾å›æ”¶JVM"></a>åƒåœ¾å›æ”¶JVM</h3><p>å…³é—­çš„æœ€åä¸€æ­¥æ˜¯è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œä¸»è¦æ˜¯æ–‡ä»¶æˆ–å¥—æ¥å­—èµ„æºã€‚è¿™ä¸€æ­¥ä¸»è¦æ˜¯è°ƒç”¨ finalize æ–¹æ³•è¿›è¡Œæœ€åçš„èµ„æºé‡Šæ”¾ã€‚finalize æ–¹æ³•è®¿é—®çš„æ•°æ®å¯èƒ½ä¼šè¢«å…¶ä»–çº¿ç¨‹å¹¶å‘è®¿é—®ï¼Œå¿…é¡»å¯¹è®¿é—®è¿›è¡ŒåŒæ­¥æ§åˆ¶ã€‚JVM ä¸ä¿è¯ä½•æ—¶è°ƒç”¨ finalize æ–¹æ³•ï¼Œç”šè‡³æ— æ³•ä¿è¯æ˜¯å¦è°ƒç”¨ finalize æ–¹æ³•ã€‚å› æ­¤å°½é‡ä¸è¦ä½¿ç”¨ finalize æ¥é‡Šæ”¾èµ„æºï¼Œè€Œåº”è¯¥åœ¨ finally ä¸­æ˜¾å¼è°ƒç”¨ close æ–¹æ³•æ¥å…³é—­èµ„æºã€‚</p>
<h3 id="å¼ºè¡Œå…³é—­"><a href="#å¼ºè¡Œå…³é—­" class="headerlink" title="å¼ºè¡Œå…³é—­"></a>å¼ºè¡Œå…³é—­</h3><p>å¦‚æœ JVM é‡åˆ°é—®é¢˜æˆ–è€…æ— æ³•å…³é—­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ kill å‘½ä»¤æˆ–å…¶ä»–è™šæ‹Ÿæœºè‡ªå·±å®ç°çš„æ–¹æ³•è¿›è¡Œå¼ºè¡Œå…³é—­ã€‚å¼ºè¡Œå…³é—­ä»…ä»…æ˜¯å…³é—­ JVMï¼Œä¸ä¼šè¿è¡Œå…³é—­é’©å­ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ–‡ç« è½¬è‡ª: &lt;a href=&quot;https://zhuanlan.zhihu.com/p/37287644&quot;&gt;Java è™šæ‹Ÿæœºçš„å…³æœºæ–¹å¼&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;JVM æ˜¯ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œæ—¢ç„¶æ˜¯è™šæ‹Ÿçš„æœºå™¨ï¼Œå°±å¿…ç„¶æ¶‰åŠåˆ°å…³æœºæ“ä½œã€‚JVM å…³é—­æ—¶ï¼Œé¦–å…ˆè°ƒç”¨å…³é—­é’©å­ï¼Œæ‰€æœ‰é’©å­æ‰§è¡Œå®Œæ¯•åï¼Œå¦‚æœéœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶å°±è°ƒç”¨ finalize æ–¹æ³•ï¼Œå¦åˆ™ç›´æ¥å…³é—­è™šæ‹Ÿæœºã€‚JVM å…³é—­è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šä¸­æ–­æˆ–åœæ­¢ä»»ä½•çº¿ç¨‹ï¼Œåœ¨æœ€ç»ˆå…³é—­è™šæ‹Ÿæœºæ—¶å¼ºåˆ¶å…³é—­æ‰€æœ‰çº¿ç¨‹ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="java" scheme="https://leokongwq.github.io/categories/java/"/>
    
    
      <category term="jvm" scheme="https://leokongwq.github.io/tags/jvm/"/>
    
  </entry>
  
  <entry>
    <title>Zookeeperç®€ä»‹</title>
    <link href="https://leokongwq.github.io/2018/05/24/zookeeper-learning-summary.html"/>
    <id>https://leokongwq.github.io/2018/05/24/zookeeper-learning-summary.html</id>
    <published>2018-05-24T12:46:53.000Z</published>
    <updated>2018-05-30T08:43:53.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="zookeeper-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#zookeeper-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="zookeeper æ˜¯ä»€ä¹ˆï¼Ÿ"></a>zookeeper æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>å®˜æ–¹è§£é‡Šå¦‚ä¸‹</p>
<blockquote>
<p>ZooKeeperæ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œä¸“é—¨æœåŠ¡äºåˆ†å¸ƒå¼åº”ç”¨çš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ã€‚ å®ƒæä¾›äº†ä¸€ç»„ç®€å•çš„<code>åŸè¯­</code>ï¼Œåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨è¿™äº›<code>åŸè¯­</code>æ¥å®ç°æ›´é«˜çº§åˆ«çš„æœåŠ¡ï¼Œä»¥å®ç°åŒæ­¥ï¼Œé…ç½®ç»´æŠ¤ä»¥åŠç»„å’Œå‘½åã€‚ å®ƒè¢«è®¾è®¡ä¸ºæ˜“äºç¼–ç¨‹ï¼Œå¹¶ä½¿ç”¨ç±»ä¼¼å¤§å®¶æ‰€ç†Ÿæ‚‰çš„æ–‡ä»¶ç³»ç»Ÿç›®å½•æ ‘ç»“æ„çš„æ•°æ®æ¨¡å‹ã€‚</p>
</blockquote>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œåè°ƒæœåŠ¡å¾ˆéš¾æ­£ç¡®å®ç°ã€‚ å®ƒä»¬ç‰¹åˆ«å®¹æ˜“å‡ºç°è¯¸å¦‚ç«æ€æ¡ä»¶å’Œæ­»é”ç­‰é”™è¯¯ã€‚ ZooKeeperèƒŒåçš„åŠ¨æœºæ˜¯å‡è½»åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä»å¤´å¼€å§‹å®æ–½åè°ƒæœåŠ¡çš„è´£ä»»ã€‚</p>
<a id="more"></a>
<h3 id="è®¾è®¡ç›®æ ‡"><a href="#è®¾è®¡ç›®æ ‡" class="headerlink" title="è®¾è®¡ç›®æ ‡"></a>è®¾è®¡ç›®æ ‡</h3><h4 id="ç®€å•"><a href="#ç®€å•" class="headerlink" title="ç®€å•"></a>ç®€å•</h4><p>ZooKeeperå…è®¸åˆ†å¸ƒå¼è¿›ç¨‹é€šè¿‡ä¸æ ‡å‡†æ–‡ä»¶ç³»ç»Ÿç»„ç»‡ç›¸ä¼¼çš„å…±äº«åˆ†å±‚å‘½åç©ºé—´ç›¸äº’åè°ƒã€‚ å‘½åç©ºé—´ç”±ç§°ä¸ºznodeçš„æ•°æ®èŠ‚ç‚¹ç»„æˆï¼ŒæŒ‰ZooKeeperçš„è¯´æ³• - è¿™äº›èŠ‚ç‚¹ç±»ä¼¼äºæ–‡ä»¶å’Œç›®å½•ã€‚ ä¸å…¸å‹çš„ä¸“ä¸ºå­˜å‚¨åŠŸèƒ½è€Œè®¾è®¡çš„æ–‡ä»¶ç³»ç»Ÿä¸åŒï¼ŒZooKeeperä¸­çš„æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè¿™æ„å‘³ç€ZooKeeperå¯ä»¥å®ç°é«˜ååé‡å’Œä½å»¶è¿Ÿã€‚</p>
<p>ZooKeeperçš„å®ç°å…³æ³¨ä¸é«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨æ€§ï¼Œå’Œä¸¥æ ¼æœ‰åºçš„è®¿é—®ã€‚ ZooKeeperçš„é«˜æ€§èƒ½æ„å‘³ç€å®ƒå¯ä»¥ç”¨äºå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿã€‚ å¯é æ€§ä½¿å®ƒä¸ä¼šé€ æˆå•ç‚¹æ•…éšœã€‚ ä¸¥æ ¼çš„é¡ºåºæ„å‘³ç€å¯ä»¥åœ¨å®¢æˆ·ç«¯å®ç°å¤æ‚çš„åŒæ­¥åŸè¯­ã€‚</p>
<h4 id="å¤šå‰¯æœ¬"><a href="#å¤šå‰¯æœ¬" class="headerlink" title="å¤šå‰¯æœ¬"></a>å¤šå‰¯æœ¬</h4><p>åƒZooKeeperæ‰€åè°ƒçš„åˆ†å¸ƒå¼è¿›ç¨‹ä¸€æ ·ï¼ŒZooKeeperæœ¬èº«ä¹Ÿå€¾å‘äºéƒ¨ç½²å¤šä¸ªå®ä¾‹ï¼Œç»„æˆä¸€ä¸ªæ•´ä½“ã€‚</p>
<img src="/2018/05/24/zookeeper-learning-summary/zkservice.jpg" alt="zkservice.jpg" title="">
<p>ç»„æˆZooKeeperæœåŠ¡çš„æœåŠ¡å™¨å¿…é¡»å…¨éƒ½å½¼æ­¤äº†è§£ã€‚å®ƒä»¬ä¿æŒçŠ¶æ€çš„å†…å­˜æ˜ åƒï¼Œä»¥åŠæŒä¹…å­˜å‚¨ä¸­çš„äº‹åŠ¡æ—¥å¿—å’Œå¿«ç…§ã€‚ åªè¦å¤§éƒ¨åˆ†æœåŠ¡å™¨éƒ½å¯ç”¨ï¼ŒZooKeeperæœåŠ¡å°†å¯ç”¨ã€‚</p>
<p>å®¢æˆ·ç«¯åªä¼šè¿æ¥åˆ°æ•´ä¸ªé›†ç¾¤ä¸­çš„ä¸€å°ZooKeeperæœåŠ¡å™¨ã€‚ å®¢æˆ·ç«¯ä¼šç»´æŠ¤ä¸€ä¸ªTCPè¿æ¥ï¼Œé€šè¿‡è¯¥è¿æ¥å‘é€è¯·æ±‚ï¼Œè·å–å“åº”ï¼Œè·å–ç›‘è§†äº‹ä»¶å¹¶å‘é€å¿ƒè·³ã€‚ å¦‚æœåˆ°æœåŠ¡å™¨çš„TCPè¿æ¥ä¸­æ–­ï¼Œåˆ™å®¢æˆ·ç«¯å°†è¿æ¥åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚</p>
<h4 id="é¡ºåºæ€§"><a href="#é¡ºåºæ€§" class="headerlink" title="é¡ºåºæ€§"></a>é¡ºåºæ€§</h4><p>ZooKeeperä½¿ç”¨ä¸€ä¸ªåæ˜ æ‰€æœ‰ZooKeeperäº‹åŠ¡é¡ºåºçš„æ•°å­—æ¥æ ‡è®°æ¯ä¸ªæ›´æ–°ã€‚ åç»­æ“ä½œå¯ä»¥ä½¿ç”¨è¯¥é¡ºåºæ¥å®ç°æ›´é«˜çº§åˆ«çš„æŠ½è±¡ï¼Œä¾‹å¦‚åŒæ­¥åŸè¯­ã€‚</p>
<h4 id="é«˜æ€§èƒ½"><a href="#é«˜æ€§èƒ½" class="headerlink" title="é«˜æ€§èƒ½"></a>é«˜æ€§èƒ½</h4><p>zookeeperåœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸‹é€Ÿåº¦éå¸¸å¿«ã€‚ZooKeeper æœåŠ¡å¯ä»¥è¿è¡Œåœ¨æ•°åƒå°æœºå™¨ä¸Šï¼Œåœ¨è¯»å–æ“ä½œè¿œå¤šäºå†™æ“ä½œçš„åœºæ™¯ä¸‹æ€§èƒ½è¡¨ç°å¾ˆå¥½ã€‚è¯»çš„æ€§èƒ½å¯èƒ½10å€äºå†™æ€§èƒ½</p>
<h4 id="æ•°æ®æ¨¡å‹å’Œç»§æ‰¿ç»“æ„çš„å‘½åç©ºé—´"><a href="#æ•°æ®æ¨¡å‹å’Œç»§æ‰¿ç»“æ„çš„å‘½åç©ºé—´" class="headerlink" title="æ•°æ®æ¨¡å‹å’Œç»§æ‰¿ç»“æ„çš„å‘½åç©ºé—´"></a>æ•°æ®æ¨¡å‹å’Œç»§æ‰¿ç»“æ„çš„å‘½åç©ºé—´</h4><p>ZooKeeperæä¾›çš„åç§°ç©ºé—´éå¸¸ç±»ä¼¼äºæ ‡å‡†æ–‡ä»¶ç³»ç»Ÿã€‚ åç§°æ˜¯ç”±æ–œçº¿<code>/</code>åˆ†éš”çš„ä¸€ç³»åˆ—è·¯å¾„å…ƒç´ ã€‚ ZooKeeperåç§°ç©ºé—´ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ç”±ä¸€ä¸ªè·¯å¾„æ ‡è¯†ã€‚</p>
<img src="/2018/05/24/zookeeper-learning-summary/zknamespace.jpg" alt="zknamespace.jpg" title="">
<h4 id="èŠ‚ç‚¹å’Œä¸´æ—¶èŠ‚ç‚¹"><a href="#èŠ‚ç‚¹å’Œä¸´æ—¶èŠ‚ç‚¹" class="headerlink" title="èŠ‚ç‚¹å’Œä¸´æ—¶èŠ‚ç‚¹"></a>èŠ‚ç‚¹å’Œä¸´æ—¶èŠ‚ç‚¹</h4><p>ä¸æ ‡å‡†æ–‡ä»¶ç³»ç»Ÿä¸åŒï¼ŒZooKeeperå‘½åç©ºé—´ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æ‹¥æœ‰ä¸å…¶ç›¸å…³çš„æ•°æ®ã€‚ è¿™å°±åƒæœ‰ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå…è®¸ä¸€ä¸ªèŠ‚ç‚¹æ—¢æ˜¯æ–‡ä»¶ä¹Ÿæ˜¯ç›®å½•ã€‚ ï¼ˆZooKeeperè¢«è®¾è®¡ç”¨äºå­˜å‚¨åè°ƒæ•°æ®ï¼šçŠ¶æ€ä¿¡æ¯ï¼Œé…ç½®ï¼Œä½ç½®ä¿¡æ¯ç­‰ï¼Œå› æ­¤å­˜å‚¨åœ¨æ¯ä¸ªèŠ‚ç‚¹çš„æ•°æ®é€šå¸¸å¾ˆå°ï¼Œåœ¨å­—èŠ‚åˆ°åƒå­—èŠ‚èŒƒå›´å†…ã€‚ï¼‰æˆ‘ä»¬ä½¿ç”¨æœ¯è¯­znodeæ¥è¯´æ˜æˆ‘ä»¬æ­£åœ¨è°ˆè®ºZooKeeperæ•°æ®èŠ‚ç‚¹ã€‚</p>
<p>Znodesç»´æŠ¤ä¸€ä¸ªç»Ÿè®¡ç»“æ„ï¼ŒåŒ…æ‹¬æ•°æ®æ›´æ”¹çš„ç‰ˆæœ¬å·ï¼ŒACLæ›´æ”¹å’Œæ—¶é—´æˆ³ï¼Œä»¥å…è®¸ç¼“å­˜éªŒè¯å’Œåè°ƒæ›´æ–°ã€‚ æ¯æ¬¡znodeçš„æ•°æ®æ›´æ”¹æ—¶ï¼Œç‰ˆæœ¬å·éƒ½ä¼šå¢åŠ ã€‚ ä¾‹å¦‚ï¼Œæ¯å½“å®¢æˆ·ç«¯æ£€ç´¢æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯ä¹Ÿä¼šæ”¶åˆ°æ•°æ®çš„ç‰ˆæœ¬ã€‚</p>
<p>å­˜å‚¨åœ¨åç§°ç©ºé—´ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®éƒ½æ˜¯ä»¥åŸå­æ–¹å¼è¯»å–å’Œå†™å…¥çš„ã€‚ è¯»å–è·å–ä¸znodeå…³è”çš„æ‰€æœ‰æ•°æ®å­—èŠ‚ï¼Œå†™å…¥å°†æ›¿æ¢æ‰€æœ‰æ•°æ®ã€‚ æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰ï¼Œé™åˆ¶è°å¯ä»¥åšä»€ä¹ˆã€‚</p>
<p>ZooKeeperä¹Ÿæœ‰ä¸´æ—¶èŠ‚ç‚¹çš„æ¦‚å¿µã€‚ åªè¦åˆ›å»ºznodeçš„ä¼šè¯å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œè¿™äº›znodeå°±ä¼šå­˜åœ¨ã€‚ å½“ä¼šè¯ç»“æŸæ—¶ï¼Œznodeè¢«åˆ é™¤ã€‚ å½“ä½ æƒ³å®ç°[tbd]æ—¶ï¼Œä¸´æ—¶èŠ‚ç‚¹å¾ˆæœ‰ç”¨ã€‚</p>
<h4 id="æ¡ä»¶æ›´æ–°å’Œè§‚å¯Ÿè€…"><a href="#æ¡ä»¶æ›´æ–°å’Œè§‚å¯Ÿè€…" class="headerlink" title="æ¡ä»¶æ›´æ–°å’Œè§‚å¯Ÿè€…"></a>æ¡ä»¶æ›´æ–°å’Œè§‚å¯Ÿè€…</h4><p>ZooKeeperæ”¯æŒè§‚å¯Ÿè€…çš„æ¦‚å¿µã€‚ å®¢æˆ·å¯ä»¥åœ¨znodeä¸Šè®¾ç½®è§‚å¯Ÿè€…ã€‚ å½“znodeæ”¹å˜æ—¶ï¼Œè§‚å¯Ÿè€…å°†è¢«<code>è§¦å‘å¹¶ç§»é™¤</code>ã€‚ å½“è§‚å¯Ÿè€…è¢«è§¦å‘æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…ï¼Œè¯´æ˜znodeå·²ç»æ”¹å˜ã€‚ å¦‚æœå®¢æˆ·ç«¯å’Œå…¶ä¸­ä¸€ä¸ªZooKeeperæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥ä¸­æ–­ï¼Œå®¢æˆ·ç«¯å°†æ”¶åˆ°æœ¬åœ°é€šçŸ¥ã€‚ è¿™äº›å¯ç”¨äº[tbd]ã€‚</p>
<h4 id="ä¿è¯"><a href="#ä¿è¯" class="headerlink" title="ä¿è¯"></a>ä¿è¯</h4><p>ZooKeeperéå¸¸å¿«é€Ÿä¸”éå¸¸ç®€å•ã€‚ ç”±äºå…¶ç›®æ ‡æ˜¯æ„å»ºæ›´å¤æ‚çš„æœåŠ¡ï¼ˆå¦‚åŒæ­¥ï¼‰çš„åŸºç¡€ï¼Œå› æ­¤å®ƒæä¾›äº†ä¸€ç»„ä¿è¯ã€‚ è¿™äº›æ˜¯ï¼š</p>
<ul>
<li>é¡ºåºä¸€è‡´æ€§  æ¥è‡ªå®¢æˆ·ç«¯çš„æ›´æ–°å°†æŒ‰ç…§å®ƒä»¬å‘é€çš„é¡ºåºè¢«æ‰§è¡Œã€‚</li>
<li>åŸå­æ€§  æ›´æ–°æˆ–è€…æˆåŠŸæˆ–å¤±è´¥ï¼Œä¸å­˜åœ¨ä¸­é—´çŠ¶æ€</li>
<li>å•ç³»ç»Ÿæ˜ åƒ  æ— è®ºå®¢æˆ·ç«¯è¿æ¥åˆ°å“ªä¸ªæœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯éƒ½ä¼šçœ‹åˆ°ç›¸åŒçš„æœåŠ¡è§†å›¾ã€‚</li>
<li>å¯é æ€§ ä¸€æ—¦æ›´æ–°è¢«æˆåŠŸæ‰§è¡Œï¼Œåˆ™è¯¥æ›´æ–°ç»“æœä¼šä»è¯¥æ—¶åˆ»è¢«æŒä¹…åŒ–ï¼Œç›´åˆ°å®¢æˆ·ç«¯ä¸‹ä¸€æ¬¡æ›´æ–°å®ƒä¸ºæ­¢ã€‚</li>
<li>åŠæ—¶æ€§ - ç³»ç»Ÿçš„å®¢æˆ·è§†å›¾ä¿è¯åœ¨ä¸€å®šçš„æ—¶é—´èŒƒå›´å†…ä¿æŒæœ€æ–°çŠ¶æ€ã€‚</li>
</ul>
<h4 id="ç®€å•çš„-API"><a href="#ç®€å•çš„-API" class="headerlink" title="ç®€å•çš„ API"></a>ç®€å•çš„ API</h4><p>Zookeeperçš„ä¸€ä¸ªè®¾è®¡ç›®æ ‡å°±æ˜¯æä¾›éå¸¸ç®€å•çš„ç¼–ç¨‹æ¥å£ã€‚å› æ­¤ï¼Œå®ƒåªæä¾›äº†ä¸‹é¢çš„æ“ä½œï¼š</p>
<h5 id="create"><a href="#create" class="headerlink" title="create"></a>create</h5><p>åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹</p>
<h5 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h5><p>åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹</p>
<h5 id="exists"><a href="#exists" class="headerlink" title="exists"></a>exists</h5><p>åˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</p>
<h5 id="get-data"><a href="#get-data" class="headerlink" title="get data"></a>get data</h5><p>è·å–èŠ‚ç‚¹çš„æ•°æ®</p>
<h5 id="set-data"><a href="#set-data" class="headerlink" title="set data"></a>set data</h5><p>è®¾ç½®èŠ‚ç‚¹çš„æ•°æ®</p>
<h5 id="get-children"><a href="#get-children" class="headerlink" title="get children"></a>get children</h5><p>è·å–èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨</p>
<h5 id="sync"><a href="#sync" class="headerlink" title="sync"></a>sync</h5><p>ç­‰å¾…æ•°æ®ä¼ æ’­</p>
<h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>ZooKeeperç»„ä»¶æ˜¾ç¤ºäº†ZooKeeperæœåŠ¡çš„é«˜çº§ç»„ä»¶ã€‚ é™¤è¯·æ±‚å¤„ç†å™¨å¤–ï¼Œæ„æˆZooKeeperæœåŠ¡çš„æ¯ä¸ªæœåŠ¡å™¨éƒ½å¤åˆ¶å…¶å„ä¸ªç»„ä»¶çš„å‰¯æœ¬ã€‚</p>
<img src="/2018/05/24/zookeeper-learning-summary/zkcomponents.jpg" alt="zkcomponents.jpg" title="">
<p>å‰¯æœ¬é›†æ•°æ®åº“æ˜¯ä¸€ä¸ªåŒ…å«æ•´ä¸ªæ•°æ®æ ‘çš„å†…å­˜æ•°æ®åº“ã€‚æ›´æ–°æ“ä½œä¼šè¢«å†™å…¥ç£ç›˜ä»¥å®ç°æ•…éšœæ¢å¤ï¼Œå†™æ“ä½œä¼šå…ˆåºåˆ—åŒ–åˆ°ç£ç›˜ï¼Œç„¶ååœ¨å†…å­˜æ•°æ®åº“ä¸­æ‰§è¡Œã€‚</p>
<p>æ¯ä¸ªZooKeeperæœåŠ¡å™¨éƒ½ä¸ºå®¢æˆ·æä¾›æœåŠ¡ã€‚å®¢æˆ·ç«¯è¿æ¥è‡³ä¸€å°æœåŠ¡å™¨ä»¥æäº¤irequestã€‚è¯»è¯·æ±‚çš„æ•°æ®æ˜¯ä»æ¯ä¸ªæœåŠ¡å™¨æ•°æ®åº“çš„æœ¬åœ°å‰¯æœ¬è·å–ã€‚éœ€æ”¹æœåŠ¡çŠ¶æ€çš„è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯å†™è¯·æ±‚æ˜¯é€šè¿‡ä¸€è‡´æ€§åè®®è¿›è¡Œå¤„ç†çš„ã€‚</p>
<p>ä½œä¸ºä¸€è‡´æ€§åè®®çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€æœ‰æ¥è‡ªå®¢æˆ·ç«¯çš„å†™å…¥è¯·æ±‚éƒ½è¢«è½¬å‘åˆ°ä¸€å°ç§°ä¸º<code>Leader</code>çš„æœåŠ¡å™¨ã€‚ ZooKeeperæœåŠ¡çš„å…¶ä½™èŠ‚ç‚¹æœåŠ¡å™¨ï¼ˆç§°ä¸ºfollowerï¼‰æ¥æ”¶Leaderå‘å‡ºçš„æ¶ˆæ¯æè®®ï¼Œå¹¶å°±æ¶ˆæ¯ä¼ é€’è¾¾æˆä¸€è‡´ã€‚æ¶ˆæ¯ä¼ é€’å±‚è´Ÿè´£åœ¨Leaderå®•æœºåé€‰æ‹©æ–°çš„Leaderï¼Œå¹¶ä¸Leaderæ•°æ®ä¿å­˜åŒæ­¥ã€‚</p>
<p>ZooKeeperä½¿ç”¨è‡ªå®šä¹‰çš„åŸå­æ¶ˆæ¯ä¼ é€’åè®®<code>(ZAB)</code>ã€‚ç”±äºæ¶ˆæ¯ä¼ é€’å±‚æ˜¯åŸå­çš„ï¼Œå› æ­¤ZooKeeperå¯ä»¥ä¿è¯æœ¬åœ°æ•°æ®å‰¯æœ¬æ°¸ä¸è¿‡æœŸã€‚å½“Leaderæ¥æ”¶åˆ°ä¸€ä¸ªå†™è¯·æ±‚æ—¶ï¼Œå®ƒä¼šè®¡ç®—åœ¨å†™æ“ä½œè¢«æ‰§è¡Œæ—¶ç³»ç»Ÿæ‰€å¤„çš„çŠ¶æ€ï¼Œå¹¶å°†å…¶è½¬æ¢æˆä¸€ä¸ªæ•è·è¿™ä¸ªæ–°çŠ¶æ€çš„äº‹åŠ¡</p>
<h3 id="zookeeperçš„ä¸€è‡´æ€§å¦‚ä½•ä¿è¯"><a href="#zookeeperçš„ä¸€è‡´æ€§å¦‚ä½•ä¿è¯" class="headerlink" title="zookeeperçš„ä¸€è‡´æ€§å¦‚ä½•ä¿è¯"></a>zookeeperçš„ä¸€è‡´æ€§å¦‚ä½•ä¿è¯</h3><h3 id="zookeeperå¦‚ä½•é€‰ä¸»"><a href="#zookeeperå¦‚ä½•é€‰ä¸»" class="headerlink" title="zookeeperå¦‚ä½•é€‰ä¸»"></a>zookeeperå¦‚ä½•é€‰ä¸»</h3><h3 id="zookeeperå†™æ•°æ®çš„è¿‡ç¨‹"><a href="#zookeeperå†™æ•°æ®çš„è¿‡ç¨‹" class="headerlink" title="zookeeperå†™æ•°æ®çš„è¿‡ç¨‹"></a>zookeeperå†™æ•°æ®çš„è¿‡ç¨‹</h3><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="http://zookeeper.apache.org/doc/r3.5.4-beta/zookeeperOver.html" target="_blank" rel="external">zookeeperOver.html</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;zookeeper-æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;a href=&quot;#zookeeper-æ˜¯ä»€ä¹ˆï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;zookeeper æ˜¯ä»€ä¹ˆï¼Ÿ&quot;&gt;&lt;/a&gt;zookeeper æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h3&gt;&lt;p&gt;å®˜æ–¹è§£é‡Šå¦‚ä¸‹&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ZooKeeperæ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œä¸“é—¨æœåŠ¡äºåˆ†å¸ƒå¼åº”ç”¨çš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ã€‚ å®ƒæä¾›äº†ä¸€ç»„ç®€å•çš„&lt;code&gt;åŸè¯­&lt;/code&gt;ï¼Œåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨è¿™äº›&lt;code&gt;åŸè¯­&lt;/code&gt;æ¥å®ç°æ›´é«˜çº§åˆ«çš„æœåŠ¡ï¼Œä»¥å®ç°åŒæ­¥ï¼Œé…ç½®ç»´æŠ¤ä»¥åŠç»„å’Œå‘½åã€‚ å®ƒè¢«è®¾è®¡ä¸ºæ˜“äºç¼–ç¨‹ï¼Œå¹¶ä½¿ç”¨ç±»ä¼¼å¤§å®¶æ‰€ç†Ÿæ‚‰çš„æ–‡ä»¶ç³»ç»Ÿç›®å½•æ ‘ç»“æ„çš„æ•°æ®æ¨¡å‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¼—æ‰€å‘¨çŸ¥ï¼Œåè°ƒæœåŠ¡å¾ˆéš¾æ­£ç¡®å®ç°ã€‚ å®ƒä»¬ç‰¹åˆ«å®¹æ˜“å‡ºç°è¯¸å¦‚ç«æ€æ¡ä»¶å’Œæ­»é”ç­‰é”™è¯¯ã€‚ ZooKeeperèƒŒåçš„åŠ¨æœºæ˜¯å‡è½»åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä»å¤´å¼€å§‹å®æ–½åè°ƒæœåŠ¡çš„è´£ä»»ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="æ¶æ„" scheme="https://leokongwq.github.io/categories/%E6%9E%B6%E6%9E%84/"/>
    
    
      <category term="zookeeper" scheme="https://leokongwq.github.io/tags/zookeeper/"/>
    
  </entry>
  
  <entry>
    <title>å¸¸è§DNSè®°å½•è§£é‡Š</title>
    <link href="https://leokongwq.github.io/2018/05/24/common-dns-records.html"/>
    <id>https://leokongwq.github.io/2018/05/24/common-dns-records.html</id>
    <published>2018-05-24T06:18:58.000Z</published>
    <updated>2018-05-24T07:53:43.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Aè®°å½•"><a href="#Aè®°å½•" class="headerlink" title="Aè®°å½•"></a>Aè®°å½•</h3><p>Aè®°å½•ï¼Œåˆç§°IPæŒ‡å‘ï¼Œç”¨æˆ·å¯ä»¥è®¾ç½®åŸŸååˆ°ç›®æ ‡ä¸»æœºIPåœ°å€çš„æ˜ å°„ï¼Œä»è€Œå®ç°é€šè¿‡åŸŸåæ‰¾åˆ°æœåŠ¡å™¨ã€‚</p>
<h4 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h4><p>å¯ä»¥é…ç½®å¤šæ¡Aè®°å½•ï¼Œé€šè¿‡åŸŸåè§£ææ¥å®ç°<code>è½®è¯¢</code>è´Ÿè½½å‡è¡¡ã€‚</p>
<h4 id="æ³›åŸŸåè§£æ"><a href="#æ³›åŸŸåè§£æ" class="headerlink" title="æ³›åŸŸåè§£æ"></a>æ³›åŸŸåè§£æ</h4><p>æ³›åŸŸåè§£ææŒ‡çš„æ˜¯å°†ä¸€ä¸ªåŸŸåæ‰€æœ‰æœªæŒ‡å®šçš„å­åŸŸåç»Ÿä¸€è§£æåˆ°ä¸€ä¸ªåœ°å€ã€‚</p>
<p>åœ¨<code>ä¸»æœºå</code>ä¸­å¡«å…¥<code>*</code>ï¼Œç±»å‹ä¸º<code>A</code>ï¼Œ<code>IPåœ°å€/ä¸»æœºå</code>ä¸­å¡«å…¥webæœåŠ¡å™¨çš„IPåœ°å€ï¼Œç‚¹å‡»â€œæ–°å¢â€æŒ‰é’®å³å¯ã€‚</p>
<a id="more"></a>
<h3 id="NS-è®°å½•"><a href="#NS-è®°å½•" class="headerlink" title="NS è®°å½•"></a>NS è®°å½•</h3><p>åŸŸåæœåŠ¡å™¨ (NS) è®°å½•ç”¨äºç¡®å®šç”±å“ªäº›æœåŠ¡å™¨æ¥è§£æåŸŸåã€‚</p>
<p>ä¾‹å¦‚ç”¨æˆ·å¸Œæœ›ç”±12.34.56.78è¿™å°æœåŠ¡å™¨è§£ænews.mydomain.comï¼Œåˆ™éœ€è¦è®¾ç½®<code>news.mydomain.com</code>çš„NSè®°å½•ã€‚</p>
<p>è¯´æ˜ï¼š<code>ä¼˜å…ˆçº§</code>ä¸­çš„æ•°å­—è¶Šå°è¡¨ç¤ºçº§åˆ«è¶Šé«˜ï¼›<code>IPåœ°å€/ä¸»æœºå</code>ä¸­æ—¢å¯ä»¥å¡«å†™IPåœ°å€ï¼Œä¹Ÿå¯ä»¥å¡«å†™åƒ<code>ns.mydomain.com</code>è¿™æ ·çš„ä¸»æœºåœ°å€ï¼Œä½†å¿…é¡»ä¿è¯è¯¥ä¸»æœºåœ°å€æœ‰æ•ˆã€‚</p>
<p>å¦‚å°†<code>news.mydomain.com</code>çš„NSè®°å½•æŒ‡å‘åˆ°<code>ns.mydomain.com</code>ï¼Œåœ¨è®¾ç½®NSè®°å½•çš„åŒæ—¶è¿˜éœ€è¦è®¾ç½®<code>ns.mydomain.com</code>çš„æŒ‡å‘ï¼ˆå› ä¸º<code>ns.mydomain.com</code>ä¹Ÿæ˜¯ä¸€ä¸ªåŸŸåï¼Œéœ€è¦è§£æï¼‰ã€‚</p>
<p>å¦åˆ™NSè®°å½•å°†æ— æ³•æ­£å¸¸è§£æï¼›NSè®°å½•ä¼˜å…ˆäºAè®°å½•ã€‚å³ï¼Œå¦‚æœä¸€ä¸ªä¸»æœºåœ°å€åŒæ—¶å­˜åœ¨NSè®°å½•å’ŒAè®°å½•ï¼Œåˆ™Aè®°å½•ä¸ç”Ÿæ•ˆã€‚è¿™é‡Œçš„NSè®°å½•åªå¯¹å­åŸŸåç”Ÿæ•ˆã€‚ </p>
<h3 id="MXè®°å½•"><a href="#MXè®°å½•" class="headerlink" title="MXè®°å½•"></a>MXè®°å½•</h3><p>MXè®°å½•: é‚®ä»¶äº¤æ¢è®°å½•ã€‚ç”¨äºå°†ä»¥è¯¥åŸŸåä¸ºç»“å°¾çš„ç”µå­é‚®ä»¶æŒ‡å‘å¯¹åº”çš„é‚®ä»¶æœåŠ¡å™¨ä»¥è¿›è¡Œå¤„ç†ã€‚å¦‚ï¼šç”¨æˆ·æ‰€ç”¨çš„é‚®ä»¶æ˜¯ä»¥åŸŸå<code>mydomain.com</code>ä¸ºç»“å°¾çš„ï¼Œåˆ™éœ€è¦åœ¨ç®¡ç†ç•Œé¢ä¸­æ·»åŠ è¯¥åŸŸåçš„MXè®°å½•æ¥å¤„ç†æ‰€æœ‰ä»¥<code>@mydomain.com</code>ç»“å°¾çš„é‚®ä»¶ã€‚ </p>
<p>è¯´æ˜ï¼šMXè®°å½•å¯ä»¥ä½¿ç”¨ä¸»æœºåæˆ–IPåœ°å€ï¼›MXè®°å½•å¯ä»¥é€šè¿‡è®¾ç½®ä¼˜å…ˆçº§å®ç°ä¸»è¾…æœåŠ¡å™¨è®¾ç½®ï¼Œâ€œä¼˜å…ˆçº§â€ä¸­çš„æ•°å­—è¶Šå°è¡¨ç¤ºçº§åˆ«è¶Šé«˜ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒä¼˜å…ˆçº§è¾¾åˆ°è´Ÿè½½å‡è¡¡çš„ç›®çš„ï¼›å¦‚æœåœ¨<code>ä¸»æœºå</code>ä¸­å¡«å…¥å­åŸŸååˆ™æ­¤MXè®°å½•åªå¯¹è¯¥å­åŸŸåç”Ÿæ•ˆã€‚</p>
<h3 id="CNAME-è®°å½•"><a href="#CNAME-è®°å½•" class="headerlink" title="CNAME è®°å½•"></a>CNAME è®°å½•</h3><p><code>CNAME</code>(Canonical Name)é€šå¸¸ç§°åˆ«åæŒ‡å‘ã€‚ä½ å¯ä»¥ä¸ºä¸€ä¸ªä¸»æœºè®¾ç½®åˆ«åã€‚æ¯”å¦‚è®¾ç½®test.mydomain.comï¼Œç”¨æ¥æŒ‡å‘ä¸€ä¸ªä¸»æœºwww.rddns.comé‚£ä¹ˆä»¥åå°±å¯ä»¥ç”¨test.mydomain.comæ¥ä»£æ›¿è®¿é—®www.rddns.comäº†ã€‚</p>
<p>è¯´æ˜ï¼šCNAMEçš„ç›®æ ‡ä¸»æœºåœ°å€åªèƒ½ä½¿ç”¨ä¸»æœºåï¼Œä¸èƒ½ä½¿ç”¨IPåœ°å€ï¼›ä¸»æœºåå‰ä¸èƒ½æœ‰ä»»ä½•å…¶ä»–å‰ç¼€ï¼Œå¦‚ï¼š<code>http://</code>ç­‰æ˜¯ä¸è¢«å…è®¸çš„ï¼›Aè®°å½•ä¼˜å…ˆäºCNAMEè®°å½•ã€‚å³å¦‚æœä¸€ä¸ªä¸»æœºåœ°å€åŒæ—¶å­˜åœ¨Aè®°å½•å’ŒCNAMEè®°å½•ï¼Œåˆ™CNAMEè®°å½•ä¸ç”Ÿæ•ˆã€‚  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
</pre></td><td class="code"><pre><span class="line">nslookup  www.baidu.com</span>
<span class="line">Server:		10.1.30.51</span>
<span class="line">Address:	10.1.30.51#53</span>
<span class="line"></span>
<span class="line">Non-authoritative answer:</span>
<span class="line">www.baidu.com	canonical name = www.a.shifen.com.</span>
<span class="line">Name:	www.a.shifen.com</span>
<span class="line">Address: 61.135.169.121</span>
<span class="line">Name:	www.a.shifen.com</span>
<span class="line">Address: 61.135.169.125</span>
</pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„å‘½ä»¤è¾“å‡ºå¯ä»¥çŸ¥é“ï¼š<code>www.baidu.com</code>çš„åˆ«åæ˜¯<code>www.a.shifen.com.</code></p>
<p>ä½¿ç”¨ CNAME çš„å¥½å¤„å°±æ˜¯è§£è€¦äº†åŸŸåå’Œ IP çš„ç›´æ¥è”ç³», è¿™æ ·å‡å¦‚æœåŠ¡å™¨ IP å‘ç”Ÿå˜æ›´, åªéœ€è¦æ”¹å˜CNAMEè®°å½•ä¸­åˆ«åçš„Aè®°å½•ä¸­çš„IPã€‚</p>
<h3 id="TXTè®°å½•"><a href="#TXTè®°å½•" class="headerlink" title="TXTè®°å½•"></a>TXTè®°å½•</h3><p>TXTè®°å½•ä¸€èˆ¬æ˜¯ä¸ºæŸæ¡è®°å½•è®¾ç½®è¯´æ˜ï¼Œæ¯”å¦‚ä½ æ–°å»ºäº†ä¸€æ¡<code>a.ezloo.com</code>çš„TXTè®°å½•ï¼ŒTXTè®°å½•å†…å®¹â€this is a test TXT record.â€ï¼Œç„¶åä½ ç”¨ <code>nslookup -qt txt a.ezloo.com</code> ï¼Œä½ å°±èƒ½çœ‹åˆ°â€this is a test TXT recordâ€çš„å­—æ ·ã€‚</p>
<p>é™¤å¤–ï¼ŒTXTè¿˜å¯ä»¥ç”¨æ¥éªŒè¯åŸŸåçš„æ‰€æœ‰ï¼Œæ¯”å¦‚ä½ çš„åŸŸåä½¿ç”¨äº†Googleçš„æŸé¡¹æœåŠ¡ï¼ŒGoogleä¼šè¦æ±‚ä½ å»ºä¸€ä¸ªTXTè®°å½•ï¼Œç„¶åGoogleéªŒè¯ä½ å¯¹æ­¤åŸŸåæ˜¯å¦å…·å¤‡ç®¡ç†æƒé™ã€‚</p>
<p>åœ¨å‘½ä»¤è¡Œä¸‹å¯ä»¥ä½¿ç”¨<code>nslookup -qt=txt a.ezloo.com</code>æ¥æŸ¥çœ‹TXTè®°å½•ã€‚</p>
<h3 id="AAAAè®°å½•"><a href="#AAAAè®°å½•" class="headerlink" title="AAAAè®°å½•"></a>AAAAè®°å½•</h3><p>AAAAè®°å½•æ˜¯ä¸€ä¸ªæŒ‡å‘IPv6åœ°å€çš„è®°å½•ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨nslookup -qt=aaaa a.ezloo.comæ¥æŸ¥çœ‹AAAAè®°å½•ã€‚</p>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="https://support.google.com/a/answer/48090?hl=zh-Hans" target="_blank" rel="external">DNS åŸºç¡€çŸ¥è¯†</a></p>
<p><a href="https://support.dnsimple.com/categories/dns/" target="_blank" rel="external">DNS articles</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Aè®°å½•&quot;&gt;&lt;a href=&quot;#Aè®°å½•&quot; class=&quot;headerlink&quot; title=&quot;Aè®°å½•&quot;&gt;&lt;/a&gt;Aè®°å½•&lt;/h3&gt;&lt;p&gt;Aè®°å½•ï¼Œåˆç§°IPæŒ‡å‘ï¼Œç”¨æˆ·å¯ä»¥è®¾ç½®åŸŸååˆ°ç›®æ ‡ä¸»æœºIPåœ°å€çš„æ˜ å°„ï¼Œä»è€Œå®ç°é€šè¿‡åŸŸåæ‰¾åˆ°æœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;h4 id=&quot;è´Ÿè½½å‡è¡¡&quot;&gt;&lt;a href=&quot;#è´Ÿè½½å‡è¡¡&quot; class=&quot;headerlink&quot; title=&quot;è´Ÿè½½å‡è¡¡&quot;&gt;&lt;/a&gt;è´Ÿè½½å‡è¡¡&lt;/h4&gt;&lt;p&gt;å¯ä»¥é…ç½®å¤šæ¡Aè®°å½•ï¼Œé€šè¿‡åŸŸåè§£ææ¥å®ç°&lt;code&gt;è½®è¯¢&lt;/code&gt;è´Ÿè½½å‡è¡¡ã€‚&lt;/p&gt;
&lt;h4 id=&quot;æ³›åŸŸåè§£æ&quot;&gt;&lt;a href=&quot;#æ³›åŸŸåè§£æ&quot; class=&quot;headerlink&quot; title=&quot;æ³›åŸŸåè§£æ&quot;&gt;&lt;/a&gt;æ³›åŸŸåè§£æ&lt;/h4&gt;&lt;p&gt;æ³›åŸŸåè§£ææŒ‡çš„æ˜¯å°†ä¸€ä¸ªåŸŸåæ‰€æœ‰æœªæŒ‡å®šçš„å­åŸŸåç»Ÿä¸€è§£æåˆ°ä¸€ä¸ªåœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨&lt;code&gt;ä¸»æœºå&lt;/code&gt;ä¸­å¡«å…¥&lt;code&gt;*&lt;/code&gt;ï¼Œç±»å‹ä¸º&lt;code&gt;A&lt;/code&gt;ï¼Œ&lt;code&gt;IPåœ°å€/ä¸»æœºå&lt;/code&gt;ä¸­å¡«å…¥webæœåŠ¡å™¨çš„IPåœ°å€ï¼Œç‚¹å‡»â€œæ–°å¢â€æŒ‰é’®å³å¯ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="web" scheme="https://leokongwq.github.io/categories/web/"/>
    
    
  </entry>
  
  <entry>
    <title>JWTç®€ä»‹</title>
    <link href="https://leokongwq.github.io/2018/05/22/json-web-token.html"/>
    <id>https://leokongwq.github.io/2018/05/22/json-web-token.html</id>
    <published>2018-05-22T04:52:27.000Z</published>
    <updated>2018-06-24T13:48:31.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="What-is-JSON-Web-Token"><a href="#What-is-JSON-Web-Token" class="headerlink" title="What is JSON Web Token?"></a>What is JSON Web Token?</h3><p>JSON Web Tokenï¼ˆJWTï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾å¼æ ‡å‡†ï¼ˆ<a href="https://tools.ietf.org/html/rfc7519" target="_blank" rel="external">RFC 7519</a>ï¼‰ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘ä¸”è‡ªåŒ…å«çš„æ–¹å¼ï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´ä»¥JSONå¯¹è±¡å®‰å…¨çš„ä¼ è¾“ä¿¡æ¯ã€‚ è¿™äº›ä¿¡æ¯å¯ä»¥é€šè¿‡æ•°å­—ç­¾åè¿›è¡ŒéªŒè¯å’Œä¿¡ä»»ã€‚ JWTå¯ä»¥ä½¿ç”¨ä¸€ä¸ªç§˜é’¥ï¼ˆHMACç­¾åç®—æ³•ï¼‰æˆ–ä½¿ç”¨RSAçš„å…¬é’¥/ç§é’¥å¯¹å¯¹JWTè¿›è¡Œç­¾åã€‚</p>
<p>è™½ç„¶JWTå¯ä»¥åŠ å¯†ä»¥æä¾›å„æ–¹ä¹‹é—´æ•°æ®ä¼ é€’çš„ä¿å¯†æ€§ï¼Œä½†æˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨å·²ç­¾åçš„ä»¤ç‰Œã€‚ ç­¾åçš„ä»¤ç‰Œå¯ä»¥éªŒè¯å…¶ä¸­åŒ…å«çš„ä¿¡æ¯çš„å®Œæ•´æ€§ï¼Œè€ŒåŠ å¯†ä»¤ç‰Œéšè—æ¥è‡ªå…¶ä»–æ–¹çš„ä¿¡æ¯ã€‚ å½“ä»¤ç‰Œä½¿ç”¨å…¬é’¥/ç§é’¥å¯¹è¿›è¡Œç­¾åæ—¶ï¼Œç­¾åè¿˜è¯æ˜åªæœ‰æŒæœ‰ç§é’¥çš„æ–¹æ˜¯ç­¾åæ–¹ã€‚</p>
<p>ä¸‹é¢æ·±å…¥äº†è§£ä¸‹JWTä¸­çš„æ¦‚å¿µ</p>
<ul>
<li>ç´§å‡‘: å› ä¸ºJWTçš„å¤§å°æ¯”è¾ƒå°ï¼Œå› ä¸ºå®ƒå¯ä»¥é€šè¿‡URL, POSTå‚æ•° æˆ–è€…HTTPè¯·æ±‚å¤´æ¥è¿›è¡Œä¼ é€’ã€‚ä»å¦ä¸€æ–¹é¢æ¥è¯´è¯´ï¼Œå› ä¸ºå®ƒå°ï¼Œæ‰€ä»¥ä¼ é€’é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ï¼ˆå ç”¨å¸¦å®½å°ï¼‰ã€‚</li>
<li>è‡ªåŒ…å«: JWTçš„è´Ÿè½½åŒ…å«äº†è¯¥ç”¨æˆ·æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä»è€Œé¿å…äº†å¯¹DBçš„å¤šæ¬¡æŸ¥è¯¢ã€‚</li>
</ul>
<a id="more"></a>
<h3 id="When-should-you-use-JSON-Web-Tokens"><a href="#When-should-you-use-JSON-Web-Tokens" class="headerlink" title="When should you use JSON Web Tokens?"></a>When should you use JSON Web Tokens?</h3><p>ä»¥ä¸‹æ˜¯JSON Web Tokensæœ‰ç”¨çš„ä¸€äº›åœºæ™¯ï¼š</p>
<ul>
<li>è®¤è¯: è¿™æ˜¯ä½¿ç”¨JWTæœ€å¸¸è§çš„æƒ…å†µã€‚ ä¸€æ—¦ç”¨æˆ·ç™»å½•ï¼Œæ¯ä¸ªåç»­è¯·æ±‚éƒ½å°†åŒ…å«JWTï¼Œå…è®¸ç”¨æˆ·è®¿é—®è¯¥ä»¤ç‰Œå…è®¸çš„è·¯ç”±ï¼ŒæœåŠ¡å’Œèµ„æºã€‚ å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰æ˜¯å½“ä»Šå¹¿æ³›ä½¿ç”¨JWTçš„ä¸€é¡¹åŠŸèƒ½ï¼Œå› ä¸ºå®ƒçš„å¼€é”€å¾ˆå°ï¼Œå¹¶ä¸”èƒ½å¤Ÿè½»æ¾åœ°è·¨ä¸åŒåŸŸä½¿ç”¨.</li>
<li>ä¿¡æ¯äº¤æ¢: JWTä¹Ÿæ˜¯ä¸€ä¸ªåœ¨å„æ–¹ä¹‹é—´å®‰å…¨ä¼ è¾“ä¿¡æ¯çš„å¥½æ–¹æ³•ã€‚ å› ä¸ºJWTå¯ä»¥ç­¾å - ä¾‹å¦‚ä½¿ç”¨å…¬é’¥/ç§é’¥å¯¹ï¼Œæ‰€ä»¥å¯ä»¥ç¡®å®šå‘ä»¶äººæ˜¯ä»–ä»¬è‡ªç§°çš„äººã€‚ æ­¤å¤–ï¼Œç”±äºä½¿ç”¨è¯·æ±‚å¤´å’Œæœ‰æ•ˆè½½è·æ¥å‚åŠ ç­¾åçš„è®¡ç®—ï¼Œå› æ­¤ä½ è¿˜å¯ä»¥éªŒè¯å†…å®¹æ˜¯å¦æœªè¢«ç¯¡æ”¹ã€‚</li>
</ul>
<h3 id="What-is-the-JSON-Web-Token-structure"><a href="#What-is-the-JSON-Web-Token-structure" class="headerlink" title="What is the JSON Web Token structure?"></a>What is the JSON Web Token structure?</h3><p>åœ¨JWTçš„ç´§å‡‘æ ¼å¼ä¸­, JWTç”±ä¸‰éƒ¨åˆ†æ„æˆï¼Œæ¯ä¸ªéƒ¨åˆ†ä»¥<code>.</code>å·è¿›è¡Œåˆ†å‰²ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>Header</li>
<li>Payload</li>
<li>Signature</li>
</ul>
<p>å› æ­¤ä¸€ä¸ªå…¸å‹çš„JWTå¯èƒ½çœ‹èµ·æ¥æ˜¯ä¸‹é¢çš„æ ·å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">xxxxx.yyyyy.zzzzz</span>
</pre></td></tr></table></figure>
<h3 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h3><p>headeréƒ¨åˆ†é€šå¸¸åŒ…å«ä¸¤éƒ¨åˆ†ï¼šä»¤ç‰Œçš„ç±»å‹ï¼Œå’Œå…¶ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ï¼Œä¾‹å¦‚ï¼šHMACï¼ŒSHA256 æˆ– RSA.</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
</pre></td><td class="code"><pre><span class="line">&#123;</span>
<span class="line">  <span class="string">"alg"</span>: <span class="string">"HS256"</span>,</span>
<span class="line">  <span class="string">"typ"</span>: <span class="string">"JWT"</span></span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>ç„¶åï¼Œè¿™ä¸ªJSONè¢«Base64Urlç¼–ç ï¼Œå½¢æˆJWTçš„ç¬¬ä¸€éƒ¨åˆ†ã€‚</p>
<h3 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h3><p>ä»¤ç‰Œçš„ç¬¬äºŒéƒ¨åˆ†æ˜¯åŒ…å«å£°æ˜çš„æœ‰æ•ˆè´Ÿè½½ã€‚ å£°æ˜æ˜¯å…³äºå®ä½“ï¼ˆé€šå¸¸æ˜¯ç”¨æˆ·ï¼‰å’Œå…¶å®ƒå…ƒæ•°æ®çš„å£°æ˜ã€‚ æœ‰ä¸‰ç§ç±»å‹çš„claimï¼šæ³¨å†Œçš„claimï¼Œå…¬å¼€çš„claimå’Œç§æœ‰çš„claimã€‚</p>
<ul>
<li>å·²ç™»è®°çš„claimsï¼šè¿™äº›æ˜¯ä¸€ç»„é¢„å…ˆå®šä¹‰çš„claimsï¼Œè¿™äº›claimsä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä½†å»ºè®®æä¾›ä¸€å¥—æœ‰ç”¨çš„ï¼Œå¯äº’æ“ä½œçš„claimsã€‚ å…¶ä¸­ä¸€äº›æ˜¯ï¼šissï¼ˆå‘è¡Œè€…ï¼‰ï¼Œexpï¼ˆåˆ°æœŸæ—¶é—´ï¼‰ï¼Œsubï¼ˆä¸»é¢˜ï¼‰ï¼Œaudï¼ˆå—ä¼—ï¼‰ç­‰ã€‚</li>
</ul>
<blockquote>
<p>Notice that the claim names are only three characters long as JWT is meant to be compact.</p>
</blockquote>
<ul>
<li>å…¬å…±çš„claims: è¿™äº›å¯ä»¥ç”±ä½¿ç”¨JWTçš„äººå‘˜éšæ„å®šä¹‰ã€‚ ä½†ä¸ºé¿å…å†²çªï¼Œåº”åœ¨<a href="https://www.iana.org/assignments/jwt/jwt.xhtml" target="_blank" rel="external">IANA JSON Webä»¤ç‰Œæ³¨å†Œè¡¨</a>ä¸­å®šä¹‰å®ƒä»¬ï¼Œæˆ–å°†å…¶å®šä¹‰ä¸ºåŒ…å«é˜²å†²çªå‘½åç©ºé—´çš„URIã€‚</li>
<li>ç§æœ‰çš„claims: è¿™äº›æ˜¯ä¸ºäº†åŒæ„ä½¿ç”¨å®ƒä»¬å¹¶ä¸”æ—¢æ²¡æœ‰ç™»è®°ä¹Ÿæ²¡æœ‰å…¬å¼€å£°æ˜çš„å„æ–¹ä¹‹é—´å…±äº«ä¿¡æ¯è€Œåˆ›å»ºçš„å®šåˆ¶å£°æ˜ã€‚</li>
</ul>
<p>ä¸€ä¸ªæœ‰æ•ˆçš„è´Ÿè½½å¯ä»¥æ˜¯:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line">&#123;</span>
<span class="line">  &quot;sub&quot;: &quot;1234567890&quot;,</span>
<span class="line">  &quot;name&quot;: &quot;John Doe&quot;,</span>
<span class="line">  &quot;admin&quot;: true</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<p>ç„¶åå°†æœ‰æ•ˆè½½è·Base64Urlè¿›è¡Œç¼–ç ä»¥å½¢æˆJSON Webä»¤ç‰Œçš„ç¬¬äºŒéƒ¨åˆ†ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œå¯¹äºå·²ç­¾åçš„ä»¤ç‰Œï¼Œæ­¤ä¿¡æ¯å°½ç®¡å—åˆ°ç¯¡æ”¹ä¿æŠ¤ï¼Œä½†ä»»ä½•äººéƒ½å¯ä»¥é˜…è¯»ã€‚ é™¤éåŠ å¯†ï¼Œå¦åˆ™ä¸è¦å°†å…³é”®ä¿¡æ¯æ”¾åœ¨JWTçš„payloadæˆ–headerä¸­ã€‚</p>
</blockquote>
<h4 id="ç­¾å"><a href="#ç­¾å" class="headerlink" title="ç­¾å"></a>ç­¾å</h4><p>è¦åˆ›å»ºç­¾åéƒ¨åˆ†ï¼Œä½ å¿…é¡»æ‹¥ç”¨å·²ç»ç¼–ç çš„headerï¼Œç¼–ç çš„æœ‰æ•ˆè½½è·ï¼Œç§˜é’¥ï¼Œheaderä¸­æŒ‡å®šçš„ç®—æ³•å¹¶ç­¾åã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨HMAC SHA256ç®—æ³•ï¼Œç­¾åå°†æŒ‰ç…§ä»¥ä¸‹æ–¹å¼åˆ›å»ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload), secret)</span>
</pre></td></tr></table></figure>
<p>è¯¥ç­¾åç”¨äºéªŒè¯æ¶ˆæ¯åœ¨ä¸€è·¯ä¸Šæ²¡æœ‰æ”¹å˜ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨ç§é’¥ç­¾åçš„ä»¤ç‰Œçš„æƒ…å†µä¸‹ï¼Œå®ƒè¿˜å¯ä»¥éªŒè¯JWTçš„å‘ä»¶äººæ˜¯è°è¯´çš„ã€‚</p>
<h4 id="ç»„åˆèµ·æ¥"><a href="#ç»„åˆèµ·æ¥" class="headerlink" title="ç»„åˆèµ·æ¥"></a>ç»„åˆèµ·æ¥</h4><p>è¾“å‡ºæ˜¯ä¸‰ä¸ªç”±<code>.</code>å·åˆ†éš”çš„Base64-URLå­—ç¬¦ä¸²ï¼Œå¯ä»¥åœ¨HTMLå’ŒHTTPç¯å¢ƒä¸­è½»æ¾ä¼ é€’ï¼Œè€Œä¸åŸºäºXMLçš„æ ‡å‡†ï¼ˆå¦‚SAMLï¼‰ç›¸æ¯”ï¼Œå®ƒæ›´åŠ ç´§å‡‘ã€‚</p>
<p>ä»¥ä¸‹æ˜¾ç¤ºäº†ä¸€ä¸ªJWTï¼Œå®ƒå…·æœ‰ç­¾åé€šè¿‡ç¼–ç çš„headerå’Œæœ‰æ•ˆè´Ÿè½½ï¼Œå¹¶ä¸”ä½¿ç”¨ç§˜é’¥è¿›è¡Œç­¾åã€‚</p>
<img src="/2018/05/22/json-web-token/encoded-jwt3.png" alt="encoded-jwt3.png" title="">
<p>å¦‚æœä½ æƒ³è¦ä½¿ç”¨JWTå¹¶å°†è¿™äº›æ¦‚å¿µä»˜è¯¸å®è·µï¼Œåˆ™å¯ä»¥ä½¿ç”¨<a href="https://link.jianshu.com/?t=https://jwt.io/#debugger-io" target="_blank" rel="external">jwt.ioè°ƒè¯•å™¨</a>æ¥è§£ç ï¼ŒéªŒè¯å’Œç”ŸæˆJWTã€‚</p>
<h3 id="JWT-å¦‚ä½•å·¥ä½œ"><a href="#JWT-å¦‚ä½•å·¥ä½œ" class="headerlink" title="JWT å¦‚ä½•å·¥ä½œ"></a>JWT å¦‚ä½•å·¥ä½œ</h3><p>åœ¨è®¤è¯åœºæ™¯ä¸­ï¼Œç›¸è¾ƒäºä¼ ç»Ÿçš„æ¨¡å¼(åœ¨æœåŠ¡ç«¯ç”Ÿæˆä¼šè¯å¹¶è¿”å›ä¸€ä¸ªcookie)ï¼Œå½“ç”¨æˆ·ä½¿ç”¨ä»–ä»¬çš„å‡­æ®æˆåŠŸç™»å½•ä»¥åï¼Œä¸€ä¸ªJSON Web Tokenå°†ä¼šè¢«è¿”å›ï¼Œè¯¥ä»¤ç‰Œå¿…é¡»è¢«ä¿å­˜åœ¨æœ¬åœ°(å…¸å‹çš„åœºæ™¯æ˜¯ä¿å­˜åœ¨æœ¬åœ°å­˜å‚¨ä¸­ï¼Œä¸è¿‡cookieä¹Ÿå¸¸å¸¸ç”¨æ¥ä¿å­˜è¿™ä¸€ç±»ä¿¡æ¯)ã€‚</p>
<p>æ— è®ºä½•æ—¶ï¼Œå½“ç”¨æˆ·æƒ³è¦è®¿é—®ä¸€ä¸ªå—ä¿æŠ¤çš„èµ„æºï¼Œä»–å¿…é¡»å°†JWTå‘é€åˆ°æœåŠ¡ç«¯ï¼Œå…¸å‹çš„å‘é€æ–¹å¼æ˜¯é€šè¿‡ Authorization è¯·æ±‚å¤´å­—æ®µï¼Œå¹¶æŒ‡å®š Bearer æ¨¡å¼ã€‚è¯·æ±‚å¤´çš„å†…å®¹çœ‹èµ·æ¥ä¼šåƒä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">Authorization: Bearer &lt;token&gt;</span>
</pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„è®¤è¯æœºåˆ¶ï¼Œç”¨æˆ·ä¿¡æ¯æ°¸è¿œä¹Ÿä¸ä¼šä¿å­˜åœ¨æœåŠ¡å™¨çš„å†…å­˜ä¸­ã€‚æœåŠ¡å™¨å—ä¿æŠ¤çš„è·¯ç”±ä¼šæ£€æŸ¥é€šè¿‡Authorizationå¤´ä¼ é€’çš„ä»¤ç‰Œæ˜¯å¦æ˜¯ä¸€ä¸ªæ­£ç¡®çš„ä»¤ç‰Œï¼Œå¦‚æœæ£€æŸ¥é€šè¿‡ï¼Œç”¨æˆ·å°†è¢«å…è®¸è®¿é—®å—ä¿æŠ¤çš„èµ„æºã€‚ç”±äºJWTæ˜¯è‡ªåŒ…å«çš„ï¼Œæ‰€æœ‰å¿…è¦çš„ä¿¡æ¯éƒ½åŒ…å«åœ¨ä»¤ç‰Œä¸­ï¼Œè¿›è€Œå‡å°‘äº†æŸ¥è¯¢æ•°æ®åº“æ‰€éœ€è¦çš„æ—¶é—´ã€‚</p>
<p>æ­£å› ä¸ºå¦‚æ­¤ï¼ŒJWTå…è®¸ä½ çš„æœåŠ¡å®Œå…¨ä¾èµ–äºæ— çŠ¶æ€çš„æ•°æ®æ¥å£ã€‚å®ƒä¸å…³å¿ƒä½ çš„APIså¯„å®¿åœ¨å“ªä¸ªåŸŸåä¹‹ä¸‹ï¼Œå› æ­¤è·¨åŸŸè®¿é—®(CORS)å°†ä¸ä¼šæˆä¸ºä¸€ä¸ªé—®é¢˜(ä½¿ç”¨cookieå°±ä¸è¡Œ)</p>
<p>ä¸‹é¢çš„å›¾è¡¨å±•ç¤ºäº†æ•´ä¸ªå¤„ç†æµç¨‹</p>
<img src="/2018/05/22/json-web-token/jwt-diagram.png" alt="jwt-diagram.png" title="">
<h3 id="å®‰å…¨æ€»ç»“"><a href="#å®‰å…¨æ€»ç»“" class="headerlink" title="å®‰å…¨æ€»ç»“"></a>å®‰å…¨æ€»ç»“</h3><ol>
<li>é¢„é˜²XSSå¯ä»¥é€šè¿‡cookieå­˜å‚¨JWTï¼Œ http-only, secure</li>
<li>é¢„é˜²CSRFå¯ä»¥é€šè¿‡ç»™è¯·æ±‚æ·»åŠ CSRF tokenï¼Œ è¯¥tokenå¯ä»¥æ”¾åœ¨WebStorageä¸­ã€‚å¦‚æ­¤ï¼Œæ”»å‡»è€…ç½‘ç«™ä¸èƒ½è·å–è¯¥tokenã€‚</li>
</ol>
<p>å½“ç„¶äº†ï¼Œå¦‚æœæ”»å‡»è€…ç¬¬ä¸€æ­¥é€šè¿‡XSSè·å–äº†CSRF tokenï¼Œç¬¬äºŒæ­¥é€šè¿‡CSRFæ”»å‡»ï¼Œåˆ™æ¼æ´è¿˜æ˜¯å­˜åœ¨çš„ã€‚å•æ­¤ç§æƒ…å†µå‘ç”Ÿçš„æ¦‚ç‡èƒ½å°ä¸€ç‚¹ã€‚åªèƒ½é€šè¿‡ç¼©çŸ­tokençš„æ—¶é—´</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://mozillazg.com/2015/06/hello-jwt.html" target="_blank" rel="external">hello-jwt</a><br><a href="https://stormpath.com/blog/where-to-store-your-jwts-cookies-vs-html5-web-storage/" target="_blank" rel="external">where-to-store-your-jwts-cookies-vs-html5-web-storage</a><br><a href="https://stormpath.com/blog/jwt-the-right-way/" target="_blank" rel="external">jwt-the-right-way</a><br><a href="https://auth0.com/blog/2014/01/27/ten-things-you-should-know-about-tokens-and-cookies/" target="_blank" rel="external">ten-things-you-should-know-about-tokens-and-cookies</a><br><a href="http://stackoverflow.com/questions/27067251/where-to-store-jwt-in-browser-how-to-protect-against-csrf" target="_blank" rel="external">where-to-store-jwt-in-browser-how-to-protect-against-csrf</a><br><a href="http://hippoom.github.io/blogs/stoping-using-jwt-for-sessions.html" target="_blank" rel="external">åˆ«å†ä½¿ç”¨JWT</a><br><a href="https://bbs.huaweicloud.com/blogs/06607ea7b53211e7b8317ca23e93a891" target="_blank" rel="external">åŸºäºJWTçš„Tokenè®¤è¯æœºåˆ¶åŠå®‰å…¨é—®é¢˜</a><br><a href="https://x-team.com/blog/my-experience-with-json-web-tokens/" target="_blank" rel="external">My Experience with JSON Web Tokens</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;What-is-JSON-Web-Token&quot;&gt;&lt;a href=&quot;#What-is-JSON-Web-Token&quot; class=&quot;headerlink&quot; title=&quot;What is JSON Web Token?&quot;&gt;&lt;/a&gt;What is JSON Web Token?&lt;/h3&gt;&lt;p&gt;JSON Web Tokenï¼ˆJWTï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾å¼æ ‡å‡†ï¼ˆ&lt;a href=&quot;https://tools.ietf.org/html/rfc7519&quot;&gt;RFC 7519&lt;/a&gt;ï¼‰ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘ä¸”è‡ªåŒ…å«çš„æ–¹å¼ï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´ä»¥JSONå¯¹è±¡å®‰å…¨çš„ä¼ è¾“ä¿¡æ¯ã€‚ è¿™äº›ä¿¡æ¯å¯ä»¥é€šè¿‡æ•°å­—ç­¾åè¿›è¡ŒéªŒè¯å’Œä¿¡ä»»ã€‚ JWTå¯ä»¥ä½¿ç”¨ä¸€ä¸ªç§˜é’¥ï¼ˆHMACç­¾åç®—æ³•ï¼‰æˆ–ä½¿ç”¨RSAçš„å…¬é’¥/ç§é’¥å¯¹å¯¹JWTè¿›è¡Œç­¾åã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶JWTå¯ä»¥åŠ å¯†ä»¥æä¾›å„æ–¹ä¹‹é—´æ•°æ®ä¼ é€’çš„ä¿å¯†æ€§ï¼Œä½†æˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨å·²ç­¾åçš„ä»¤ç‰Œã€‚ ç­¾åçš„ä»¤ç‰Œå¯ä»¥éªŒè¯å…¶ä¸­åŒ…å«çš„ä¿¡æ¯çš„å®Œæ•´æ€§ï¼Œè€ŒåŠ å¯†ä»¤ç‰Œéšè—æ¥è‡ªå…¶ä»–æ–¹çš„ä¿¡æ¯ã€‚ å½“ä»¤ç‰Œä½¿ç”¨å…¬é’¥/ç§é’¥å¯¹è¿›è¡Œç­¾åæ—¶ï¼Œç­¾åè¿˜è¯æ˜åªæœ‰æŒæœ‰ç§é’¥çš„æ–¹æ˜¯ç­¾åæ–¹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ·±å…¥äº†è§£ä¸‹JWTä¸­çš„æ¦‚å¿µ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç´§å‡‘: å› ä¸ºJWTçš„å¤§å°æ¯”è¾ƒå°ï¼Œå› ä¸ºå®ƒå¯ä»¥é€šè¿‡URL, POSTå‚æ•° æˆ–è€…HTTPè¯·æ±‚å¤´æ¥è¿›è¡Œä¼ é€’ã€‚ä»å¦ä¸€æ–¹é¢æ¥è¯´è¯´ï¼Œå› ä¸ºå®ƒå°ï¼Œæ‰€ä»¥ä¼ é€’é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ï¼ˆå ç”¨å¸¦å®½å°ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;è‡ªåŒ…å«: JWTçš„è´Ÿè½½åŒ…å«äº†è¯¥ç”¨æˆ·æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä»è€Œé¿å…äº†å¯¹DBçš„å¤šæ¬¡æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="web" scheme="https://leokongwq.github.io/categories/web/"/>
    
    
  </entry>
  
  <entry>
    <title>ActiveMQ æ¶ˆæ¯é‡å‘ç­–ç•¥</title>
    <link href="https://leokongwq.github.io/2018/05/19/activemq-redelivery-policy-config.html"/>
    <id>https://leokongwq.github.io/2018/05/19/activemq-redelivery-policy-config.html</id>
    <published>2018-05-19T01:24:28.000Z</published>
    <updated>2018-05-19T02:21:05.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>åœ¨ä½¿ç”¨ActiveMQæ—¶ï¼Œé…ç½®äº†æ¶ˆæ¯é‡å‘ç­–ç•¥ã€‚ ä½†å› ä¸ºå¯¹é…ç½®é¡¹çš„ç†è§£ä¸å¤Ÿæ·±åˆ»ï¼Œå¯¼è‡´è™½ç„¶æ¶ˆæ¯é‡æ–°è¢«æŠ•é€’äº†ï¼Œå•å› ä¸ºæ—¶é—´é—´éš”å¤ªå°ï¼Œæœ€ç»ˆè¢«æ”¾å…¥DLQä¸­ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š æˆ‘ä½¿ç”¨çš„ActiveMQç‰ˆæœ¬æ˜¯5.8</p>
</blockquote>
<h3 id="é”™è¯¯é…ç½®"><a href="#é”™è¯¯é…ç½®" class="headerlink" title="é”™è¯¯é…ç½®"></a>é”™è¯¯é…ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
</pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span>
<span class="line"><span class="function"><span class="keyword">public</span> RedeliveryPolicy <span class="title">redeliveryPolicy</span><span class="params">()</span> </span>&#123;</span>
<span class="line">   RedeliveryPolicy redeliveryPolicy = <span class="keyword">new</span> RedeliveryPolicy();</span>
<span class="line">   <span class="comment">//æ˜¯å¦åœ¨æ¯æ¬¡å°è¯•é‡æ–°å‘é€å¤±è´¥å,å¢é•¿è¿™ä¸ªç­‰å¾…æ—¶é—´</span></span>
<span class="line">   redeliveryPolicy.setUseExponentialBackOff(<span class="keyword">true</span>);</span>
<span class="line">   <span class="comment">//é‡å‘æ¬¡æ•°,é»˜è®¤ä¸º6æ¬¡   è¿™é‡Œè®¾ç½®ä¸º10æ¬¡</span></span>
<span class="line">   redeliveryPolicy.setMaximumRedeliveries(<span class="number">10</span>);</span>
<span class="line">   <span class="comment">//é‡å‘æ—¶é—´é—´éš”,é»˜è®¤ä¸º1ç§’</span></span>
<span class="line">   redeliveryPolicy.setInitialRedeliveryDelay(<span class="number">1</span>);</span>
<span class="line">   <span class="comment">//ç¬¬ä¸€æ¬¡å¤±è´¥åé‡æ–°å‘é€ä¹‹å‰ç­‰å¾…1ç§’,ç¬¬äºŒæ¬¡å¤±è´¥å†ç­‰å¾…1 * 2ç§’,è¿™é‡Œçš„2å°±æ˜¯value</span></span>
<span class="line">   redeliveryPolicy.setBackOffMultiplier(<span class="number">2</span>);</span>
<span class="line">   <span class="comment">//æ˜¯å¦é¿å…æ¶ˆæ¯ç¢°æ’</span></span>
<span class="line">   redeliveryPolicy.setUseCollisionAvoidance(<span class="keyword">false</span>);</span>
<span class="line">   <span class="comment">//è®¾ç½®é‡å‘æœ€å¤§æ‹–å»¶æ—¶é—´-1 è¡¨ç¤ºæ²¡æœ‰æ‹–å»¶åªæœ‰UseExponentialBackOff(true)ä¸ºtrueæ—¶ç”Ÿæ•ˆ</span></span>
<span class="line">   redeliveryPolicy.setMaximumRedeliveryDelay(-<span class="number">1</span>);</span>
<span class="line">   <span class="keyword">return</span> redeliveryPolicy;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<a id="more"></a>
<p>ä¸Šé¢é…ç½®æœ‰å¦‚ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li>ç¬¬ä¸€æ¬¡æŠ•é€’å»¶æ—¶<code>(initialRedeliveryDelay)</code>ä¸º1æ¯«ç§’, è€Œä¸æ˜¯æ³¨é‡Šé‡Œé¢è¯´çš„1ç§’ã€‚è¿™æ˜¯ç¬¬ä¸€ä¸ªè‡´å‘½é”™è¯¯</li>
<li>æœ€å¤§é‡æŠ•æ¬¡æ•°<code>(maximumRedeliveries)</code> ä¸º10ã€‚ åŠ ä¸Šç¬¬ä¸€ä¸ªé…ç½®ï¼Œå¯¼è‡´çŸ­æ—¶é—´å†…æ¶ˆæ¯è¢«é‡æ–°æŠ•é€’å¤šæ¬¡ï¼Œä¸€èˆ¬æ¥è¯´æ¶ˆè´¹è€…è‚¯å®šä¸èƒ½æˆåŠŸæ¶ˆè´¹çš„ã€‚å› æ­¤ä¼šå¯¼è‡´æ¶ˆæ¯è¢«æ”¾å…¥DLQä¸­ï¼Œä¸šåŠ¡ä¸¢å¤±äº†æ¶ˆæ¯ã€‚<br>è¿™æ˜¯ç¬¬äºŒä¸ªé”™è¯¯ï¼Œé‡æŠ•æ¬¡æ•°æœ‰ç‚¹å°ã€‚å¯¹äºéå¸¸é‡è¦çš„æ¶ˆæ¯ï¼Œå¯ä»¥é€‚å½“è°ƒå¤§è¯¥é…ç½®å€¼ã€‚</li>
<li>æ˜¯å¦å¯ç”¨é‡æŠ•æ—¶å»¶æŒ‡æ•°å¢é•¿ç­–ç•¥<code>(useExponentialBackOff) é»˜è®¤æ˜¯false</code>ã€‚å¦‚ä½•ç†è§£å‘¢ï¼ŸActiveMQ ä¼šåœ¨å»¶è¿Ÿ<code>initialRedeliveryDelay</code> æŒ‡å®šçš„æ—¶é—´åå‘èµ·<strong>ç¬¬ä¸€æ¬¡</strong>é‡æ–°æŠ•é€’ï¼Œä¹‹åæ ¹æ®æ˜¯å¦è®¾ç½®äº†<code>useExponentialBackOff=true</code>æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦é€’å¢æ¯æ¬¡æŠ•é€’çš„æ—¶å»¶ã€‚å¦‚æœè®¾ç½®äº†<code>useExponentialBackOff=true</code>ï¼Œé‚£ä¹ˆæ¯æ¬¡é‡æ–°æŠ•é€’çš„æ—¶é—´ä¼šå»¶è¿Ÿ<code>redeliveryDelay * backOffMultiplier</code></li>
</ol>
<p>ç”±æ­¤å¯ä»¥é€€å‡ºæ¯æ¬¡æ¶ˆæ¯é‡æ–°æŠ•é€’çš„å»¶æ—¶ä¸ºï¼š</p>
<table>
<thead>
<tr>
<th>æ¬¡æ•°</th>
<th>å»¶æ—¶</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1æ¯«ç§’</td>
</tr>
<tr>
<td>2</td>
<td>2 æ¯«ç§’</td>
</tr>
<tr>
<td>3</td>
<td>4 æ¯«ç§’</td>
</tr>
<tr>
<td>4</td>
<td>8 æ¯«ç§’</td>
</tr>
<tr>
<td>5</td>
<td>16 æ¯«ç§’</td>
</tr>
<tr>
<td>6</td>
<td>32 æ¯«ç§’</td>
</tr>
<tr>
<td>7</td>
<td>64 æ¯«ç§’</td>
</tr>
<tr>
<td>8</td>
<td>128 æ¯«ç§’</td>
</tr>
<tr>
<td>9</td>
<td>256 æ¯«ç§’</td>
</tr>
<tr>
<td>10</td>
<td>512 æ¯«ç§’</td>
</tr>
</tbody>
</table>
<p>ä»ä¸Šè¡¨å¯ä»¥çœ‹å‡ºï¼Œå®Œå…¨æ²¡æœ‰è¾¾åˆ°éœ€è¦çš„æ•ˆæœã€‚ç—›å®šæ€ç—›ï¼Œç¿»çœ‹å®˜æ–¹æ–‡æ¡£å’Œæºä»£ç ï¼Œå°†ActiveMQæ¶ˆæ¯é‡å¤ç­–ç•¥æ€»ç»“å¦‚ä¸‹ï¼š</p>
<h3 id="æ¶ˆæ¯é‡å‘æ—¶æœº"><a href="#æ¶ˆæ¯é‡å‘æ—¶æœº" class="headerlink" title="æ¶ˆæ¯é‡å‘æ—¶æœº"></a>æ¶ˆæ¯é‡å‘æ—¶æœº</h3><p>1ï¼åœ¨ä½¿ç”¨äº‹åŠ¡çš„Sessionä¸­ï¼Œè°ƒç”¨rollback()æ–¹æ³•ï¼›<br>2ï¼åœ¨ä½¿ç”¨äº‹åŠ¡çš„Sessionä¸­ï¼Œè°ƒç”¨commit()æ–¹æ³•ä¹‹å‰å°±å…³é—­äº†Session;<br>3ï¼åœ¨Sessionä¸­ä½¿ç”¨CLIENT_ACKNOWLEDGEç­¾æ”¶æ¨¡å¼ï¼Œå¹¶ä¸”è°ƒç”¨äº†<code>recover()</code>æ–¹æ³•ã€‚</p>
<p>å¯ä»¥é€šè¿‡è®¾ç½®<code>ActiveMQConnectionFactory</code>å’Œ<code>ActiveMQConnection</code>æ¥å®šåˆ¶æƒ³è¦çš„å†æ¬¡ä¼ é€ç­–ç•¥ã€‚</p>
<h3 id="æ¶ˆæ¯é‡å‘é…ç½®é¡¹"><a href="#æ¶ˆæ¯é‡å‘é…ç½®é¡¹" class="headerlink" title="æ¶ˆæ¯é‡å‘é…ç½®é¡¹"></a>æ¶ˆæ¯é‡å‘é…ç½®é¡¹</h3><h4 id="collisionAvoidanceFactor"><a href="#collisionAvoidanceFactor" class="headerlink" title="collisionAvoidanceFactor"></a>collisionAvoidanceFactor</h4><p>é»˜è®¤å€¼ 0.15     </p>
<p>è®¾ç½®é˜²æ­¢å†²çªèŒƒå›´çš„æ­£è´Ÿç™¾åˆ†æ¯”ï¼Œåªæœ‰å¯ç”¨useCollisionAvoidanceå‚æ•°æ—¶æ‰ç”Ÿæ•ˆã€‚</p>
<h4 id="maximumRedeliveries"><a href="#maximumRedeliveries" class="headerlink" title="maximumRedeliveries"></a>maximumRedeliveries</h4><p>é»˜è®¤å€¼ï¼š6</p>
<p>æœ€å¤§é‡ä¼ æ¬¡æ•°ã€‚ è¾¾åˆ°æœ€å¤§é‡è¿æ¬¡æ•°åæŠ›å‡ºå¼‚å¸¸ã€‚ä¸º-1æ—¶ä¸é™åˆ¶æ¬¡æ•°ï¼Œä¸º0æ—¶è¡¨ç¤ºä¸è¿›è¡Œé‡ä¼ ã€‚</p>
<h4 id="maximumRedeliveryDelay"><a href="#maximumRedeliveryDelay" class="headerlink" title="maximumRedeliveryDelay"></a>maximumRedeliveryDelay</h4><p>é»˜è®¤å€¼ -1    </p>
<p>æœ€å¤§ä¼ é€å»¶è¿Ÿï¼Œåªåœ¨useExponentialBackOffä¸ºtrueæ—¶æœ‰æ•ˆï¼ˆV5.5ï¼‰ï¼Œå‡è®¾é¦–æ¬¡é‡è¿é—´éš”ä¸º10msï¼Œå€æ•°ä¸º2ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡é‡è¿æ—¶é—´é—´éš”ä¸º 20msï¼Œç¬¬ä¸‰æ¬¡é‡è¿æ—¶é—´é—´éš”ä¸º40msï¼Œå½“é‡è¿æ—¶é—´é—´éš”å¤§çš„æœ€å¤§é‡è¿æ—¶é—´é—´éš”æ—¶ï¼Œä»¥åæ¯æ¬¡é‡è¿æ—¶é—´é—´éš”éƒ½ä¸ºæœ€å¤§é‡è¿æ—¶é—´é—´éš”ã€‚</p>
<h4 id="initialRedeliveryDelay"><a href="#initialRedeliveryDelay" class="headerlink" title="initialRedeliveryDelay"></a>initialRedeliveryDelay</h4><p>é»˜è®¤å€¼ 1000L     </p>
<p>åˆå§‹é‡å‘å»¶è¿Ÿæ—¶é—´</p>
<h4 id="redeliveryDelay"><a href="#redeliveryDelay" class="headerlink" title="redeliveryDelay"></a>redeliveryDelay</h4><p>é»˜è®¤å€¼ï¼š1000L     </p>
<p>é‡å‘å»¶è¿Ÿæ—¶é—´ï¼Œå½“initialRedeliveryDelay=0æ—¶ç”Ÿæ•ˆï¼ˆv5.4ï¼‰</p>
<h4 id="useCollisionAvoidance"><a href="#useCollisionAvoidance" class="headerlink" title="useCollisionAvoidance"></a>useCollisionAvoidance</h4><p>é»˜è®¤å€¼ false     </p>
<p>å¯ç”¨é˜²æ­¢å†²çªåŠŸèƒ½ï¼Œå› ä¸ºæ¶ˆæ¯æ¥æ”¶æ—¶æ˜¯å¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹å¹¶å‘å¤„ç†çš„ï¼Œåº”è¯¥æ˜¯ä¸ºäº†é‡å‘çš„å®‰å…¨æ€§ï¼Œé¿å¼€æ‰€æœ‰å¹¶å‘çº¿ç¨‹éƒ½åœ¨åŒä¸€ä¸ªæ—¶é—´ç‚¹è¿›è¡Œæ¶ˆæ¯æ¥æ”¶å¤„ç†ã€‚æ‰€æœ‰çº¿ç¨‹åœ¨åŒä¸€ä¸ªæ—¶é—´ç‚¹å¤„ç†æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿåº”è¯¥æ²¡æœ‰é—®é¢˜ï¼Œåªæ˜¯ä¸ºäº†å¹³è¡¡brokerå¤„ç†æ€§èƒ½ï¼Œä¸ä¼šæœ‰æ—¶å¾ˆå¿™ï¼Œæœ‰æ—¶å¾ˆç©ºé—²ã€‚</p>
<h4 id="useExponentialBackOff"><a href="#useExponentialBackOff" class="headerlink" title="useExponentialBackOff"></a>useExponentialBackOff</h4><p>é»˜è®¤å€¼ false          </p>
<p>å¯ç”¨æŒ‡æ•°å€æ•°é€’å¢çš„æ–¹å¼å¢åŠ å»¶è¿Ÿæ—¶é—´ã€‚</p>
<h4 id="backOffMultiplier"><a href="#backOffMultiplier" class="headerlink" title="backOffMultiplier"></a>backOffMultiplier</h4><p>é»˜è®¤å€¼ 5    </p>
<p>é‡è¿æ—¶é—´é—´éš”é€’å¢å€æ•°ï¼Œåªæœ‰å€¼å¤§äº1å’Œå¯ç”¨<code>useExponentialBackOff</code>å‚æ•°æ—¶æ‰ç”Ÿæ•ˆã€‚</p>
<h3 id="é‡å‘æºç åˆ†æ"><a href="#é‡å‘æºç åˆ†æ" class="headerlink" title="é‡å‘æºç åˆ†æ"></a>é‡å‘æºç åˆ†æ</h3><h4 id="é‡å‘æ—¶æœº"><a href="#é‡å‘æ—¶æœº" class="headerlink" title="é‡å‘æ—¶æœº"></a>é‡å‘æ—¶æœº</h4><figure class="highlight java"><figcaption><span>ActiveMQMessageConsumer.rollback</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> currentRedeliveryCount = lastMd.getMessage().getRedeliveryCounter();</span>
<span class="line"> <span class="keyword">if</span> (currentRedeliveryCount &gt; <span class="number">0</span>) &#123;</span>
<span class="line">     <span class="comment">// è·å–ä¸‹æ¬¡è¢«é‡æ–°æŠ•é€’çš„å»¶è¿Ÿæ—¶é—´</span></span>
<span class="line">     redeliveryDelay = redeliveryPolicy.getNextRedeliveryDelay(redeliveryDelay);</span>
<span class="line"> &#125; <span class="keyword">else</span> &#123;</span>
<span class="line">     <span class="comment">//  ç¬¬ä¸€è¢«é‡æ–°æŠ•é€’çš„å»¶è¿Ÿæ—¶é—´ </span></span>
<span class="line">     redeliveryDelay = redeliveryPolicy.getInitialRedeliveryDelay();</span>
<span class="line"> &#125;</span>
<span class="line"> <span class="comment">// å½“å‰æ¶ˆæ¯è¢«é‡æ–°æŠ•é€’çš„æ­¤æ—¶å¤§äºé…ç½®çš„å€¼ï¼Œæ­¤æ—¶æ¶ˆæ¯ä¼šè¢«å‘é€åˆ°DLQ</span></span>
<span class="line"> <span class="keyword">if</span> (redeliveryPolicy.getMaximumRedeliveries() != RedeliveryPolicy.NO_MAXIMUM_REDELIVERIES</span>
<span class="line">                    &amp;&amp; lastMd.getMessage().getRedeliveryCounter() &gt; redeliveryPolicy.getMaximumRedeliveries()) &#123;</span>
<span class="line"><span class="comment">// We need to NACK the messages so that they get sent to the</span></span>
<span class="line"><span class="comment">// DLQ.</span></span>
<span class="line"><span class="comment">// Acknowledge the last message.</span></span>
<span class="line"></span>
<span class="line">MessageAck ack = <span class="keyword">new</span> MessageAck(lastMd, MessageAck.POSION_ACK_TYPE, deliveredMessages.size());</span>
<span class="line"> &#125; <span class="keyword">else</span> &#123;</span>
<span class="line">     <span class="comment">// only redelivery_ack after first delivery</span></span>
<span class="line">     <span class="keyword">if</span> (currentRedeliveryCount &gt; <span class="number">0</span>) &#123;</span>
<span class="line">         MessageAck ack = <span class="keyword">new</span> MessageAck(lastMd, MessageAck.REDELIVERED_ACK_TYPE, deliveredMessages.size());</span>
<span class="line">         ack.setFirstMessageId(firstMsgId);</span>
<span class="line">         session.sendAck(ack,<span class="keyword">true</span>);</span>
<span class="line">     &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h4 id="é‡æ–°æŠ•é€’çš„å»¶è¿Ÿæ—¶é—´è®¡ç®—"><a href="#é‡æ–°æŠ•é€’çš„å»¶è¿Ÿæ—¶é—´è®¡ç®—" class="headerlink" title="é‡æ–°æŠ•é€’çš„å»¶è¿Ÿæ—¶é—´è®¡ç®—"></a>é‡æ–°æŠ•é€’çš„å»¶è¿Ÿæ—¶é—´è®¡ç®—</h4><figure class="highlight java"><figcaption><span>RedeliveryPolicy.getNextRedeliveryDelay</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
</pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getNextRedeliveryDelay</span><span class="params">(<span class="keyword">long</span> previousDelay)</span> </span>&#123;</span>
<span class="line">   <span class="keyword">long</span> nextDelay = redeliveryDelay;</span>
<span class="line">   <span class="comment">//å¯ç”¨äº† æŒ‡æ•°çº§å»¶è¿Ÿæ—¶é—´é€’å¢ç­–ç•¥</span></span>
<span class="line">   <span class="keyword">if</span> (previousDelay &gt; <span class="number">0</span> &amp;&amp; useExponentialBackOff &amp;&amp; backOffMultiplier &gt; <span class="number">1</span>) &#123;</span>
<span class="line">       nextDelay = (<span class="keyword">long</span>) (previousDelay * backOffMultiplier);</span>
<span class="line">       <span class="keyword">if</span>(maximumRedeliveryDelay != -<span class="number">1</span> &amp;&amp; nextDelay &gt; maximumRedeliveryDelay) &#123;</span>
<span class="line">           <span class="comment">// in case the user made max redelivery delay less than redelivery delay for some reason.</span></span>
<span class="line">           nextDelay = Math.max(maximumRedeliveryDelay, redeliveryDelay);</span>
<span class="line">       &#125;</span>
<span class="line">   &#125;</span>
<span class="line">   <span class="comment">//  å¯ç”¨é˜²æ­¢å†²çªåŠŸèƒ½, è®¡ç®—ä¸€ä¸ªéšæœºçš„å»¶è¿Ÿæ—¶é—´</span></span>
<span class="line">   <span class="keyword">if</span> (useCollisionAvoidance) &#123;</span>
<span class="line">       <span class="comment">/*</span>
<span class="line">        * First random determines +/-, second random determines how far to</span>
<span class="line">        * go in that direction. -cgs</span>
<span class="line">        */</span></span>
<span class="line">       Random random = getRandomNumberGenerator();</span>
<span class="line">       <span class="keyword">double</span> variance = (random.nextBoolean() ? collisionAvoidanceFactor : -collisionAvoidanceFactor) * random.nextDouble();</span>
<span class="line">       nextDelay += nextDelay * variance;</span>
<span class="line">   &#125;</span>
<span class="line">   <span class="comment">//æ¯æ¬¡é‡æ–°æŠ•é€’çš„å»¶è¿Ÿæ—¶é—´æ˜¯å›ºå®šçš„ </span></span>
<span class="line">   <span class="keyword">return</span> nextDelay;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="http://activemq.apache.org/redelivery-policy.html" target="_blank" rel="external">http://activemq.apache.org/redelivery-policy.html</a></p>
<p><a href="http://activemq.apache.org/message-redelivery-and-dlq-handling.html" target="_blank" rel="external">http://activemq.apache.org/message-redelivery-and-dlq-handling.html</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h3&gt;&lt;p&gt;åœ¨ä½¿ç”¨ActiveMQæ—¶ï¼Œé…ç½®äº†æ¶ˆæ¯é‡å‘ç­–ç•¥ã€‚ ä½†å› ä¸ºå¯¹é…ç½®é¡¹çš„ç†è§£ä¸å¤Ÿæ·±åˆ»ï¼Œå¯¼è‡´è™½ç„¶æ¶ˆæ¯é‡æ–°è¢«æŠ•é€’äº†ï¼Œå•å› ä¸ºæ—¶é—´é—´éš”å¤ªå°ï¼Œæœ€ç»ˆè¢«æ”¾å…¥DLQä¸­ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼š æˆ‘ä½¿ç”¨çš„ActiveMQç‰ˆæœ¬æ˜¯5.8&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;é”™è¯¯é…ç½®&quot;&gt;&lt;a href=&quot;#é”™è¯¯é…ç½®&quot; class=&quot;headerlink&quot; title=&quot;é”™è¯¯é…ç½®&quot;&gt;&lt;/a&gt;é”™è¯¯é…ç½®&lt;/h3&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Bean&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; RedeliveryPolicy &lt;span class=&quot;title&quot;&gt;redeliveryPolicy&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;   RedeliveryPolicy redeliveryPolicy = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RedeliveryPolicy();&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//æ˜¯å¦åœ¨æ¯æ¬¡å°è¯•é‡æ–°å‘é€å¤±è´¥å,å¢é•¿è¿™ä¸ªç­‰å¾…æ—¶é—´&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;   redeliveryPolicy.setUseExponentialBackOff(&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//é‡å‘æ¬¡æ•°,é»˜è®¤ä¸º6æ¬¡   è¿™é‡Œè®¾ç½®ä¸º10æ¬¡&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;   redeliveryPolicy.setMaximumRedeliveries(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;);&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//é‡å‘æ—¶é—´é—´éš”,é»˜è®¤ä¸º1ç§’&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;   redeliveryPolicy.setInitialRedeliveryDelay(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//ç¬¬ä¸€æ¬¡å¤±è´¥åé‡æ–°å‘é€ä¹‹å‰ç­‰å¾…1ç§’,ç¬¬äºŒæ¬¡å¤±è´¥å†ç­‰å¾…1 * 2ç§’,è¿™é‡Œçš„2å°±æ˜¯value&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;   redeliveryPolicy.setBackOffMultiplier(&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;);&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//æ˜¯å¦é¿å…æ¶ˆæ¯ç¢°æ’&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;   redeliveryPolicy.setUseCollisionAvoidance(&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//è®¾ç½®é‡å‘æœ€å¤§æ‹–å»¶æ—¶é—´-1 è¡¨ç¤ºæ²¡æœ‰æ‹–å»¶åªæœ‰UseExponentialBackOff(true)ä¸ºtrueæ—¶ç”Ÿæ•ˆ&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;   redeliveryPolicy.setMaximumRedeliveryDelay(-&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; redeliveryPolicy;&lt;/span&gt;
&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="web" scheme="https://leokongwq.github.io/categories/web/"/>
    
    
      <category term="ActiveMQ" scheme="https://leokongwq.github.io/tags/ActiveMQ/"/>
    
  </entry>
  
  <entry>
    <title>REST API ç‰ˆæœ¬åŒ–</title>
    <link href="https://leokongwq.github.io/2018/05/15/rest-version.html"/>
    <id>https://leokongwq.github.io/2018/05/15/rest-version.html</id>
    <published>2018-05-15T12:46:21.000Z</published>
    <updated>2018-05-15T13:07:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¦ç®¡ç†åº”ç”¨æ¥å£ä¸šåŠ¡é€»è¾‘çš„å¤æ‚æ€§ï¼Œéœ€è¦ä½ å¯¹APIè¿›è¡Œç‰ˆæœ¬ç®¡ç†ã€‚ç‰ˆæœ¬æ§åˆ¶å¯å¸®åŠ©ä½ åœ¨éœ€è¦å˜æ›´æœåŠ¡é€»è¾‘æ—¶å¿«é€Ÿè¿­ä»£ã€‚</p>
<blockquote>
<p>éšç€ç³»ç»Ÿä¸šåŠ¡å‘å±•æˆ–é€»è¾‘å¤æ‚åº¦çš„ä¸æ–­æé«˜ï¼ŒAPIçš„å˜åŒ–æ˜¯ä¸å¯é¿å…çš„ã€‚ å½“å˜æ›´ä¼šç ´åç°æœ‰ç³»ç»Ÿå®¢æˆ·ç«¯çš„é›†æˆæ—¶ï¼Œç®¡ç†è¿™ç§å˜åŒ–çš„å½±å“å¯èƒ½æ˜¯ç›¸å½“å¤§çš„æŒ‘æˆ˜ã€‚</p>
</blockquote>
<h2 id="ä½•æ—¶å¯¹REST-APIè¿›è¡Œç‰ˆæœ¬åŒ–"><a href="#ä½•æ—¶å¯¹REST-APIè¿›è¡Œç‰ˆæœ¬åŒ–" class="headerlink" title="ä½•æ—¶å¯¹REST APIè¿›è¡Œç‰ˆæœ¬åŒ–"></a>ä½•æ—¶å¯¹REST APIè¿›è¡Œç‰ˆæœ¬åŒ–</h2><p>åªæœ‰åœ¨é‡å¤§ç ´åæ€§å˜æ›´å‘ç”Ÿæ—¶æ‰è€ƒè™‘å¯¹APIè¿›è¡Œç‰ˆæœ¬å‡çº§ã€‚ç ´åæ€§å˜æ›´åŒ…æ‹¬ï¼š</p>
<ul>
<li>ä¸€æ¬¡æˆ–å¤šæ¬¡è°ƒç”¨çš„å“åº”æ•°æ®æ ¼å¼å‘ç”Ÿäº†å˜åŒ–</li>
<li>å“åº”æ•°æ®ç±»å‹å‘ç”Ÿå˜åŒ–ï¼ˆä¾‹å¦‚ï¼Œå°†æ•´æ•°å˜ä¸ºæµ®ç‚¹æ•°ï¼‰</li>
<li>åˆ é™¤APIè¿”å›æ•°æ®çš„éƒ¨åˆ†å†…</li>
</ul>
<p>å‘ç”Ÿç ´åæ€§å˜æ›´æ—¶ï¼Œåº”è¯¥æ€»æ˜¯ä¿®æ”¹APIçš„ä¸»ç‰ˆæœ¬å·ã€‚</p>
<p>éç ´åæ€§å˜æ›´ï¼ˆå¦‚æ·»åŠ æ–°çš„RESTç«¯ç‚¹æˆ–æ–°çš„å“åº”å‚æ•°ï¼‰ä¸éœ€è¦æ›´æ”¹ä¸»ç‰ˆæœ¬å·ã€‚ </p>
<a id="more"></a>
<h2 id="REST-API-ç‰ˆæœ¬å·å¦‚ä½•å®šä¹‰"><a href="#REST-API-ç‰ˆæœ¬å·å¦‚ä½•å®šä¹‰" class="headerlink" title="REST API ç‰ˆæœ¬å·å¦‚ä½•å®šä¹‰"></a>REST API ç‰ˆæœ¬å·å¦‚ä½•å®šä¹‰</h2><p>REST æ²¡æœ‰æä¾›ä»»ä½•å…³äºAPIç‰ˆæœ¬ç®¡ç†çš„æŒ‡å¯¼è§„èŒƒï¼Œä½†æ˜¯å¸¸ç”¨çš„å®ç°æ–¹å¼æœ‰å¦‚ä¸‹ä¸‰ç§ï¼š</p>
<h3 id="åœ¨URIä¸ŠåŒ…å«ç‰ˆæœ¬å·"><a href="#åœ¨URIä¸ŠåŒ…å«ç‰ˆæœ¬å·" class="headerlink" title="åœ¨URIä¸ŠåŒ…å«ç‰ˆæœ¬å·"></a>åœ¨URIä¸ŠåŒ…å«ç‰ˆæœ¬å·</h3><p>ä½¿ç”¨URIæ˜¯æœ€ç›´æ¥çš„æ–¹æ³•ï¼ˆä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼‰ï¼Œå°½ç®¡å®ƒè¿èƒŒäº†URIåº”è¯¥å¼•ç”¨å”¯ä¸€èµ„æºçš„åŸåˆ™ã€‚ å½“ç‰ˆæœ¬æ›´æ–°æ—¶ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä¿è¯å®¢æˆ·ç«¯çš„é›†æˆã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">http://api.example.com/v1</span>
<span class="line">http://apiv1.example.com</span>
</pre></td></tr></table></figure>
<p>ç‰ˆæœ¬å·ä¸å¿…æ˜¯æ•°å­—ï¼Œä¹Ÿä¸å¿…ä½¿ç”¨<code>v[x]</code>è¿™æ ·è¯­æ³•æŒ‡å®šã€‚ æ›¿ä»£æ–¹æ¡ˆåŒ…æ‹¬æ—¥æœŸï¼Œé¡¹ç›®åç§°ï¼Œå­£èŠ‚æˆ–å…¶ä»–æ ‡è¯†ç¬¦ï¼Œè¿™äº›æ ‡è¯†ç¬¦å¯¹äºäº§ç”ŸAPIçš„å›¢é˜Ÿæ¥è¯´è¶³å¤Ÿæœ‰æ„ä¹‰ï¼Œå¹¶ä¸”éšç€ç‰ˆæœ¬çš„å˜åŒ–è¶³å¤Ÿçµæ´»åœ°è¿›è¡Œæ›´æ”¹ã€‚</p>
<h3 id="è‡ªå®šä¹‰è¯·æ±‚å¤´"><a href="#è‡ªå®šä¹‰è¯·æ±‚å¤´" class="headerlink" title="è‡ªå®šä¹‰è¯·æ±‚å¤´"></a>è‡ªå®šä¹‰è¯·æ±‚å¤´</h3><p>è‡ªå®šä¹‰è¯·æ±‚å¤´ï¼ˆä¾‹å¦‚<code>Accept-version</code>ï¼‰å…è®¸ä½ åœ¨ç‰ˆæœ¬ä¹‹é—´ä¿ç•™URIï¼Œå°½ç®¡å®ƒå®é™…ä¸Šæ˜¯ç°æœ‰<code>Accept</code>å¤´å®ç°çš„å†…å®¹åå•†è¡Œä¸ºçš„é‡å¤ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">Accept-version: v1</span>
<span class="line">Accept-version: v2</span>
</pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨è¯·æ±‚å¤´-Accept"><a href="#ä½¿ç”¨è¯·æ±‚å¤´-Accept" class="headerlink" title="ä½¿ç”¨è¯·æ±‚å¤´ Accept"></a>ä½¿ç”¨è¯·æ±‚å¤´ <code>Accept</code></h3><p>å†…å®¹åå•†å¯èƒ½è®©ä½ ä¿ç•™ä¸€ç»„å¹²å‡€çš„URLï¼Œä½†ä½ ä»ç„¶å¿…é¡»å¤„ç†åœ¨æŸå¤„æ”¾ç½®ä¸åŒç‰ˆæœ¬å†…å®¹çš„å¤æ‚æ€§ã€‚ è¿™ç§è´Ÿæ‹…å¾€å¾€ä¼šè¢«ä¸Šç§»åˆ°æ‚¨çš„APIæ§åˆ¶å™¨ï¼Œè¿™äº›æ§åˆ¶å™¨è´Ÿè´£ç¡®å®šè¦å‘é€çš„èµ„æºç‰ˆæœ¬ã€‚ æœ€ç»ˆç»“æœå¾€å¾€æ˜¯æ›´å¤æ‚çš„APIï¼Œå› ä¸ºå®¢æˆ·ç«¯åœ¨è¯·æ±‚èµ„æºä¹‹å‰å¿…é¡»çŸ¥é“æŒ‡å®šå“ªäº›å¤´ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
</pre></td><td class="code"><pre><span class="line">Accept: application/vnd.example.v1+json</span>
<span class="line">Accept: application/vnd.example+json;version=1.0</span>
</pre></td></tr></table></figure>
<p>åœ¨ç°å®ä¸–ç•Œä¸­ï¼ŒAPIæ°¸è¿œä¸ä¼šå˜çš„å®Œå…¨ç¨³å®šã€‚ å› æ­¤ï¼Œå¦‚ä½•ç®¡ç†è¿™ä¸€å˜åŒ–éå¸¸é‡è¦ã€‚ å¯¹äºå¤§å¤šæ•°APIè€Œè¨€ï¼Œè¯¦ç»†è®°å½•APIçš„å˜æ›´ä¿¡æ¯å’Œé€æ¸åºŸå¼ƒAPIæ˜¯å¯è¡Œçš„æ–¹æ³•ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¦ç®¡ç†åº”ç”¨æ¥å£ä¸šåŠ¡é€»è¾‘çš„å¤æ‚æ€§ï¼Œéœ€è¦ä½ å¯¹APIè¿›è¡Œç‰ˆæœ¬ç®¡ç†ã€‚ç‰ˆæœ¬æ§åˆ¶å¯å¸®åŠ©ä½ åœ¨éœ€è¦å˜æ›´æœåŠ¡é€»è¾‘æ—¶å¿«é€Ÿè¿­ä»£ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;éšç€ç³»ç»Ÿä¸šåŠ¡å‘å±•æˆ–é€»è¾‘å¤æ‚åº¦çš„ä¸æ–­æé«˜ï¼ŒAPIçš„å˜åŒ–æ˜¯ä¸å¯é¿å…çš„ã€‚ å½“å˜æ›´ä¼šç ´åç°æœ‰ç³»ç»Ÿå®¢æˆ·ç«¯çš„é›†æˆæ—¶ï¼Œç®¡ç†è¿™ç§å˜åŒ–çš„å½±å“å¯èƒ½æ˜¯ç›¸å½“å¤§çš„æŒ‘æˆ˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;ä½•æ—¶å¯¹REST-APIè¿›è¡Œç‰ˆæœ¬åŒ–&quot;&gt;&lt;a href=&quot;#ä½•æ—¶å¯¹REST-APIè¿›è¡Œç‰ˆæœ¬åŒ–&quot; class=&quot;headerlink&quot; title=&quot;ä½•æ—¶å¯¹REST APIè¿›è¡Œç‰ˆæœ¬åŒ–&quot;&gt;&lt;/a&gt;ä½•æ—¶å¯¹REST APIè¿›è¡Œç‰ˆæœ¬åŒ–&lt;/h2&gt;&lt;p&gt;åªæœ‰åœ¨é‡å¤§ç ´åæ€§å˜æ›´å‘ç”Ÿæ—¶æ‰è€ƒè™‘å¯¹APIè¿›è¡Œç‰ˆæœ¬å‡çº§ã€‚ç ´åæ€§å˜æ›´åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€æ¬¡æˆ–å¤šæ¬¡è°ƒç”¨çš„å“åº”æ•°æ®æ ¼å¼å‘ç”Ÿäº†å˜åŒ–&lt;/li&gt;
&lt;li&gt;å“åº”æ•°æ®ç±»å‹å‘ç”Ÿå˜åŒ–ï¼ˆä¾‹å¦‚ï¼Œå°†æ•´æ•°å˜ä¸ºæµ®ç‚¹æ•°ï¼‰&lt;/li&gt;
&lt;li&gt;åˆ é™¤APIè¿”å›æ•°æ®çš„éƒ¨åˆ†å†…&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‘ç”Ÿç ´åæ€§å˜æ›´æ—¶ï¼Œåº”è¯¥æ€»æ˜¯ä¿®æ”¹APIçš„ä¸»ç‰ˆæœ¬å·ã€‚&lt;/p&gt;
&lt;p&gt;éç ´åæ€§å˜æ›´ï¼ˆå¦‚æ·»åŠ æ–°çš„RESTç«¯ç‚¹æˆ–æ–°çš„å“åº”å‚æ•°ï¼‰ä¸éœ€è¦æ›´æ”¹ä¸»ç‰ˆæœ¬å·ã€‚ &lt;/p&gt;
    
    </summary>
    
      <category term="web" scheme="https://leokongwq.github.io/categories/web/"/>
    
    
      <category term="REST" scheme="https://leokongwq.github.io/tags/REST/"/>
    
  </entry>
  
  <entry>
    <title>SpringBootåº”ç”¨éƒ¨ç½²æ¨¡å¼</title>
    <link href="https://leokongwq.github.io/2018/05/15/spring-boot-deploy.html"/>
    <id>https://leokongwq.github.io/2018/05/15/spring-boot-deploy.html</id>
    <published>2018-05-15T09:32:00.000Z</published>
    <updated>2018-05-15T10:48:59.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>è¶Šæ¥è¶Šå¤šçš„äººå¼€å§‹ä½¿ç”¨SpringBootæ¥å®ç°é¡¹ç›®çš„å¿«é€Ÿå¼€å‘ã€‚æ¯ä¸ªå›¢é˜Ÿéƒ½ä¼šé¢ä¸´ä¸€ä¸ªåŒæ ·çš„é—®é¢˜ï¼šå¦‚ä½•éƒ¨ç½²SpringBootåº”ç”¨ï¼Ÿå¤§éƒ¨åˆ†äººä¼šæƒ³ï¼šè¿™è¿˜éœ€è¦è€ƒè™‘ï¼Ÿå½“ç„¶æ˜¯åŒæ­¥<code>Fat Jar</code>çš„æ–¹å¼éƒ¨ç½²å–½ã€‚ç°å®æ˜¯æ®‹é…·çš„ï¼å¯èƒ½çš„åŸå› æœ‰ï¼š</p>
<ul>
<li>å·²æœ‰çš„å‘å¸ƒç³»ç»Ÿä¸æ”¯æŒ</li>
<li>å›¢é˜Ÿæˆå‘˜ä¹ æƒ¯äº†waråŒ…çš„éƒ¨ç½²æ–¹å¼</li>
<li>å¤–ç½®çš„Servletå®¹å™¨æ›´å®¹æ˜“é…ç½®</li>
<li>æ–‡ä»¶è·¯å¾„ç›¸å…³çš„ä»£ç è°ƒæ•´</li>
<li>å…¶å®ƒåŸå› </li>
</ul>
<a id="more"></a>
<p>SpringBoot åº”ç”¨é»˜è®¤çš„æ‰“åŒ…ç»“æœæ˜¯ä¸€ä¸ªjaråŒ…ã€‚å¦‚æœéœ€è¦æŒ‰ç…§waråŒ…çš„å½¢å¼è¿›è¡Œéƒ¨ç½²ï¼Œæˆ‘ä»¬éœ€è¦åšå¦‚ä¸‹çš„é…ç½®å°±èƒ½å¤Ÿå®ç°ã€‚</p>
<h3 id="ç¬¬ä¸€æ­¥-æ‰©å±•-SpringBootServletInitializer"><a href="#ç¬¬ä¸€æ­¥-æ‰©å±•-SpringBootServletInitializer" class="headerlink" title="ç¬¬ä¸€æ­¥ æ‰©å±• SpringBootServletInitializer"></a>ç¬¬ä¸€æ­¥ æ‰©å±• SpringBootServletInitializer</h3><p><code>SpringBootServletInitializer</code>æ˜¯ä¸€ä¸ªå®ç°<code>WebApplicationInitializer</code>æ¥å£çš„æŠ½è±¡ç±»ï¼Œå®ƒæ˜¯servlet 3.0+ç¯å¢ƒçš„ä¸»è¦æŠ½è±¡ï¼Œä»¥ä¾¿ä»¥ç¼–ç¨‹æ–¹å¼é…ç½®ServletContextã€‚ å®ƒå°†Servletï¼ŒFilterå’ŒServletContextInitializer beanä»åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ç»‘å®šåˆ°servletå®¹å™¨ã€‚</p>
<h4 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
</pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.websystique.springboot;</span>
<span class="line"> </span>
<span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span>
<span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span>
<span class="line"><span class="keyword">import</span> org.springframework.boot.builder.SpringApplicationBuilder;</span>
<span class="line"><span class="keyword">import</span> org.springframework.boot.web.support.SpringBootServletInitializer;</span>
<span class="line"> </span>
<span class="line"><span class="meta">@SpringBootApplication</span>(scanBasePackages=&#123;<span class="string">"com.websystique.springboot"</span>&#125;)<span class="comment">// same as @Configuration @EnableAutoConfiguration @ComponentScan</span></span>
<span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBootStandAloneWarApp</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span></span>&#123;</span>
<span class="line"> </span>
<span class="line">     </span>
<span class="line">    <span class="meta">@Override</span></span>
<span class="line">    <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder application)</span> </span>&#123;</span>
<span class="line">        <span class="keyword">return</span> application.sources(SpringBootStandAloneWarApp .class);</span>
<span class="line">    &#125;</span>
<span class="line">     </span>
<span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span>
<span class="line">        SpringApplication.run(SpringBootStandAloneWarApp.class, args);</span>
<span class="line">    &#125;</span>
<span class="line">&#125;</span>
</pre></td></tr></table></figure>
<h3 id="ç¬¬äºŒæ­¥-ä¿®æ”¹-Mavenæ‰“åŒ…ç±»å‹ä¸ºâ€™warâ€™"><a href="#ç¬¬äºŒæ­¥-ä¿®æ”¹-Mavenæ‰“åŒ…ç±»å‹ä¸ºâ€™warâ€™" class="headerlink" title="ç¬¬äºŒæ­¥ ä¿®æ”¹ Mavenæ‰“åŒ…ç±»å‹ä¸ºâ€™warâ€™"></a>ç¬¬äºŒæ­¥ ä¿®æ”¹ Mavenæ‰“åŒ…ç±»å‹ä¸ºâ€™warâ€™</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
</pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"&lt;a class="</span><span class="attr">vglnk</span>" <span class="attr">href</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">rel</span>=<span class="string">"nofollow"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>http<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>://<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>maven<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>apache<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>org<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>POM<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>4<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>" xmlns:xsi="<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"vglnk"</span> <span class="attr">href</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">rel</span>=<span class="string">"nofollow"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>http<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>://<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>www<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>w3<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>org<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>2001<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>XMLSchema<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>-<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>instance<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>"</span>
<span class="line">    xsi:schemaLocation="<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"vglnk"</span> <span class="attr">href</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">rel</span>=<span class="string">"nofollow"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>http<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>://<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>maven<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>apache<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>org<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>POM<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>4<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"vglnk"</span> <span class="attr">href</span>=<span class="string">"http://maven.apache.org/xsd/maven-4.0.0.xsd"</span> <span class="attr">rel</span>=<span class="string">"nofollow"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>http<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>://<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>maven<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>apache<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>org<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>xsd<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>maven<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>-<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>4<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>xsd<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>"&gt;</span>
<span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span>
<span class="line"> </span>
<span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.websystique.springboot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>SpringBootStandAloneWarExample<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span>
<span class="line"> </span>
<span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span>
<span class="line"> </span>
<span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span>
<span class="line">......</span>
</pre></td></tr></table></figure>
<h3 id="ç¬¬ä¸‰æ­¥-æ’é™¤å†…åµŒçš„Servletå®¹å™¨"><a href="#ç¬¬ä¸‰æ­¥-æ’é™¤å†…åµŒçš„Servletå®¹å™¨" class="headerlink" title="ç¬¬ä¸‰æ­¥ æ’é™¤å†…åµŒçš„Servletå®¹å™¨"></a>ç¬¬ä¸‰æ­¥ æ’é™¤å†…åµŒçš„Servletå®¹å™¨</h3><p>eg.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
</pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span>
<span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span>
</pre></td></tr></table></figure>
<h3 id="å®Œæ•´çš„pomæ–‡ä»¶"><a href="#å®Œæ•´çš„pomæ–‡ä»¶" class="headerlink" title="å®Œæ•´çš„pomæ–‡ä»¶"></a>å®Œæ•´çš„pomæ–‡ä»¶</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
<span class="line">34</span>
<span class="line">35</span>
<span class="line">36</span>
<span class="line">37</span>
<span class="line">38</span>
<span class="line">39</span>
<span class="line">40</span>
<span class="line">41</span>
<span class="line">42</span>
<span class="line">43</span>
<span class="line">44</span>
<span class="line">45</span>
<span class="line">46</span>
<span class="line">47</span>
<span class="line">48</span>
<span class="line">49</span>
<span class="line">50</span>
<span class="line">51</span>
<span class="line">52</span>
<span class="line">53</span>
<span class="line">54</span>
</pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"&lt;a class="</span><span class="attr">vglnk</span>" <span class="attr">href</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">rel</span>=<span class="string">"nofollow"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>http<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>://<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>maven<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>apache<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>org<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>POM<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>4<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>" xmlns:xsi="<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"vglnk"</span> <span class="attr">href</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">rel</span>=<span class="string">"nofollow"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>http<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>://<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>www<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>w3<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>org<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>2001<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>XMLSchema<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>-<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>instance<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>"</span>
<span class="line">    xsi:schemaLocation="<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"vglnk"</span> <span class="attr">href</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">rel</span>=<span class="string">"nofollow"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>http<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>://<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>maven<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>apache<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>org<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>POM<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>4<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"vglnk"</span> <span class="attr">href</span>=<span class="string">"http://maven.apache.org/xsd/maven-4.0.0.xsd"</span> <span class="attr">rel</span>=<span class="string">"nofollow"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>http<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>://<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>maven<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>apache<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>org<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>xsd<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>maven<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>-<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>4<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>xsd<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>"&gt;</span>
<span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span>
<span class="line"> </span>
<span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.websystique.springboot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>SpringBootStandAloneWarExample<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span>
<span class="line"> </span>
<span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span>
<span class="line"> </span>
<span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span>
<span class="line"> </span>
<span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">startClass</span>&gt;</span>SpringBootStandAloneWarApp<span class="tag">&lt;/<span class="name">startClass</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span>
<span class="line"> </span>
<span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span>
<span class="line">        <span class="comment">&lt;!-- Add typical dependencies for a web application --&gt;</span></span>
<span class="line">        <span class="comment">&lt;!-- Adds Tomcat and Spring MVC, along others --&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span>
<span class="line"> </span>
<span class="line"> </span>
<span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span>
<span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span>
<span class="line">                        <span class="comment">&lt;!-- this will get rid of version info from war file name --&gt;</span></span>
<span class="line">                    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span>
<span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span>
<span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span>
</pre></td></tr></table></figure>
<h3 id="æ‰“åŒ…"><a href="#æ‰“åŒ…" class="headerlink" title="æ‰“åŒ…"></a>æ‰“åŒ…</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span>
</pre></td><td class="code"><pre><span class="line">mvn clean package</span>
</pre></td></tr></table></figure>
<p>ç„¶åå°†waråŒ…éƒ¨ç½²åˆ°å·²æœ‰çš„Servletå®¹å™¨ä¸­ã€‚</p>
<h3 id="åŒæ—¶æ”¯æŒjarå’Œwarç±»å‹"><a href="#åŒæ—¶æ”¯æŒjarå’Œwarç±»å‹" class="headerlink" title="åŒæ—¶æ”¯æŒjarå’Œwarç±»å‹"></a>åŒæ—¶æ”¯æŒjarå’Œwarç±»å‹</h3><p>ä¸Šé¢çš„pom.xmlé…ç½®èƒ½å¾ˆå¥½çš„æ”¯æŒwaråŒ…ç±»å‹çš„éƒ¨ç½²ï¼Œä½†æ˜¯åœ¨å¼€å‘é˜¶æ®µæˆ‘ä»¬è¿˜æ˜¯å¸Œæœ›é€šè¿‡Mainæ–¹æ³•çš„æ–¹å¼è¿›è¡Œè¿è¡Œã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡Mavençš„profileåŠŸèƒ½å®ç°ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span>
<span class="line">2</span>
<span class="line">3</span>
<span class="line">4</span>
<span class="line">5</span>
<span class="line">6</span>
<span class="line">7</span>
<span class="line">8</span>
<span class="line">9</span>
<span class="line">10</span>
<span class="line">11</span>
<span class="line">12</span>
<span class="line">13</span>
<span class="line">14</span>
<span class="line">15</span>
<span class="line">16</span>
<span class="line">17</span>
<span class="line">18</span>
<span class="line">19</span>
<span class="line">20</span>
<span class="line">21</span>
<span class="line">22</span>
<span class="line">23</span>
<span class="line">24</span>
<span class="line">25</span>
<span class="line">26</span>
<span class="line">27</span>
<span class="line">28</span>
<span class="line">29</span>
<span class="line">30</span>
<span class="line">31</span>
<span class="line">32</span>
<span class="line">33</span>
<span class="line">34</span>
<span class="line">35</span>
<span class="line">36</span>
<span class="line">37</span>
<span class="line">38</span>
<span class="line">39</span>
<span class="line">40</span>
<span class="line">41</span>
<span class="line">42</span>
<span class="line">43</span>
<span class="line">44</span>
<span class="line">45</span>
<span class="line">46</span>
<span class="line">47</span>
<span class="line">48</span>
<span class="line">49</span>
<span class="line">50</span>
<span class="line">51</span>
<span class="line">52</span>
<span class="line">53</span>
<span class="line">54</span>
<span class="line">55</span>
<span class="line">56</span>
<span class="line">57</span>
<span class="line">58</span>
<span class="line">59</span>
<span class="line">60</span>
<span class="line">61</span>
<span class="line">62</span>
<span class="line">63</span>
<span class="line">64</span>
<span class="line">65</span>
<span class="line">66</span>
<span class="line">67</span>
<span class="line">68</span>
<span class="line">69</span>
<span class="line">70</span>
<span class="line">71</span>
<span class="line">72</span>
<span class="line">73</span>
<span class="line">74</span>
<span class="line">75</span>
<span class="line">76</span>
<span class="line">77</span>
<span class="line">78</span>
<span class="line">79</span>
<span class="line">80</span>
<span class="line">81</span>
<span class="line">82</span>
<span class="line">83</span>
<span class="line">84</span>
<span class="line">85</span>
</pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"&lt;a class="</span><span class="attr">vglnk</span>" <span class="attr">href</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">rel</span>=<span class="string">"nofollow"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>http<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>://<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>maven<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>apache<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>org<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>POM<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>4<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>" xmlns:xsi="<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"vglnk"</span> <span class="attr">href</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">rel</span>=<span class="string">"nofollow"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>http<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>://<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>www<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>w3<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>org<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>2001<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>XMLSchema<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>-<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>instance<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>"</span>
<span class="line">    xsi:schemaLocation="<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"vglnk"</span> <span class="attr">href</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">rel</span>=<span class="string">"nofollow"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>http<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>://<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>maven<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>apache<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>org<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>POM<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>4<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"vglnk"</span> <span class="attr">href</span>=<span class="string">"http://maven.apache.org/xsd/maven-4.0.0.xsd"</span> <span class="attr">rel</span>=<span class="string">"nofollow"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>http<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>://<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>maven<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>apache<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>org<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>xsd<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>maven<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>-<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>4<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>0<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>xsd<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>"&gt;</span>
<span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span>
<span class="line"> </span>
<span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.websystique.springboot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>SpringBootStandAloneWarExample<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>$&#123;artifact-packaging&#125;<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span>
<span class="line"> </span>
<span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span>
<span class="line"> </span>
<span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span>
<span class="line"> </span>
<span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">startClass</span>&gt;</span>SpringBootStandAloneWarApp<span class="tag">&lt;/<span class="name">startClass</span>&gt;</span></span>
<span class="line">        <span class="comment">&lt;!-- Additionally, Please make sure that your JAVA_HOME is pointing to </span>
<span class="line">            1.8 when building on commandline --&gt;</span></span>
<span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span>
<span class="line"> </span>
<span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span>
<span class="line">        <span class="comment">&lt;!-- Add typical dependencies for a web application --&gt;</span></span>
<span class="line">        <span class="comment">&lt;!-- Adds Tomcat and Spring MVC, along others --&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span>
<span class="line"> </span>
<span class="line"> </span>
<span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span>
<span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span>
<span class="line"> </span>
<span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>local<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span>
<span class="line">                <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span>
<span class="line">                <span class="tag">&lt;<span class="name">artifact-packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">artifact-packaging</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>remote<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span>
<span class="line">                <span class="tag">&lt;<span class="name">artifact-packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">artifact-packaging</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span>
<span class="line">                <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span>
<span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">                    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span>
<span class="line">                <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;<span class="name">build</span>&gt;</span></span>
<span class="line">                <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span>
<span class="line">                    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span>
<span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span>
<span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span>
<span class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span>
<span class="line">                        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span>
<span class="line">                                   <span class="comment">&lt;!-- this will get rid of version info from war file name --&gt;</span></span>
<span class="line">                            <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span>
<span class="line">                        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span>
<span class="line">                    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span>
<span class="line">                <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span>
<span class="line">            <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span>
<span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span>
<span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span>
<span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span>
</pre></td></tr></table></figure>
<p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥åœ¨æœ¬åœ°ä»¥FAT jarçš„æ–¹å¼è¿è¡Œã€‚å½“å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ä»¥warçš„æ–¹å¼è¿›è¡Œéƒ¨ç½²äº†ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h3&gt;&lt;p&gt;è¶Šæ¥è¶Šå¤šçš„äººå¼€å§‹ä½¿ç”¨SpringBootæ¥å®ç°é¡¹ç›®çš„å¿«é€Ÿå¼€å‘ã€‚æ¯ä¸ªå›¢é˜Ÿéƒ½ä¼šé¢ä¸´ä¸€ä¸ªåŒæ ·çš„é—®é¢˜ï¼šå¦‚ä½•éƒ¨ç½²SpringBootåº”ç”¨ï¼Ÿå¤§éƒ¨åˆ†äººä¼šæƒ³ï¼šè¿™è¿˜éœ€è¦è€ƒè™‘ï¼Ÿå½“ç„¶æ˜¯åŒæ­¥&lt;code&gt;Fat Jar&lt;/code&gt;çš„æ–¹å¼éƒ¨ç½²å–½ã€‚ç°å®æ˜¯æ®‹é…·çš„ï¼å¯èƒ½çš„åŸå› æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å·²æœ‰çš„å‘å¸ƒç³»ç»Ÿä¸æ”¯æŒ&lt;/li&gt;
&lt;li&gt;å›¢é˜Ÿæˆå‘˜ä¹ æƒ¯äº†waråŒ…çš„éƒ¨ç½²æ–¹å¼&lt;/li&gt;
&lt;li&gt;å¤–ç½®çš„Servletå®¹å™¨æ›´å®¹æ˜“é…ç½®&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶è·¯å¾„ç›¸å…³çš„ä»£ç è°ƒæ•´&lt;/li&gt;
&lt;li&gt;å…¶å®ƒåŸå› &lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="web" scheme="https://leokongwq.github.io/categories/web/"/>
    
    
      <category term="spring" scheme="https://leokongwq.github.io/tags/spring/"/>
    
  </entry>
  
</feed>
